jQuery(function(b){console.log("initializing media meta box");b(window).on("dragover",function(a){a=a||event;a.preventDefault()});b(window).on("drop",function(a){a=a||event;a.preventDefault()});b("body").on("click",".dz-feature",function(a){if(!b(this).hasClass("fa-heart")){var c=this;a=b(".dz-feature").index(this);b.ajax({url:jc_data.ajaxurl,method:"post",data:{action:"jp_commerce_set_artwork_featured_image",nonce:f,name:Dropzone.instances[0].files[a].name,post_id:g,author_id:h}}).success(function(){b(".fa-heart").removeClass("fa-heart").addClass("fa-heart-o");
b(c).removeClass("fa-heart-o").addClass("fa-heart")}).error(function(){console.log("failed to set featured image on server.")})}});Dropzone.autoDiscover=!1;Dropzone.prototype.addFile=function(a){if(this.files.length){var c,b;c=0;for(b=this.files.length;c<b;c++)if(this.files[c].name===a.name&&this.files[c].size===a.size)return!1}a.upload={progress:0,total:a.size,bytesSent:0};this.files.push(a);a.status=Dropzone.ADDED;this.emit("addedfile",a);this._enqueueThumbnail(a);return this.accept(a,function(c){return function(b){b?
(a.accepted=!1,c._errorProcessing([a],b)):(a.accepted=!0,c.options.autoQueue&&c.enqueueFile(a));return c._updateMaxFilesReachedClass()}}(this))};var g=b("#media-upload-wrap").attr("data-post_id"),h=b("#media-upload-wrap").attr("data-author_id"),f=b("#media-upload-wrap").attr("data-nonce");b("#media-upload-wrap").dropzone({url:jc_data.ajaxurl,method:"post",maxFiles:5,acceptedFiles:"image/*",autoProcessQueue:!1,uploadMultiple:!1,previewTemplate:'<div class="dz-preview dz-file-preview">   <div class="dz-details">       <img data-dz-thumbnail />   </div>   <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>    <div class="controls">       <i class="dz-remove fa fa-close tiptip" data-dz-remove title="Delete"></i>   </div></div> ',
clickable:".dz-clickable",dictInvalidFileType:"Invalid file type.",dictResponseError:"Upload Failed. \nError Code: {{statusCode}}.",dictMaxFilesExceeded:"Exceeded number of files allowed."});var d=Dropzone.instances[0];d.on("addedfile",function(a){b("#media-upload-wrap").append(b("#upload-indicator-wrap"));console.log(a);if(this.files.length){var c,d;c=0;for(d=this.files.length;c<d-1;c++)this.files[c].name===a.name&&(this.files.splice(c,1),alert("Another file with the same name already exists!"))}b(".tiptip").tipTip({delay:200})});
d.on("maxfilesexceeded",function(a){this.removeFile(a)});d.on("removedfile",function(a){console.log(this.files.length);4==this.files.length&&this.enable();console.log(a);b.ajax({url:jc_data.ajaxurl,method:"post",data:{action:"jp_commerce_remove_artwork_media",nonce:f,name:a.name,post_id:g,author_id:h}}).fail(function(){alert("failed to delete file from server.")})});d.on("sending",function(a,c,b){b.append("action","jp_commerce_upload_artwork_media");b.append("post_id",g);b.append("author_id",h);b.append("nonce",
f)});d.on("success",function(a,b){b.success||alert(b.data)});var k=existing_thumbnails.length;console.log("file count: "+k);d.options.maxFiles-=k;for(var l,m=0;m<k;m++){l=existing_thumbnails[m];var e={name:l.name,size:123};console.log("mockFile: "+e.size);d.files.push(e);d.emit("addedfile",e);d.emit("thumbnail",e,l.url);d.emit("complete",e)}var n,p;b("#media-upload-wrap").sortable({items:".dz-preview",containment:"parent",distance:20,tolerance:"pointer",start:function(a,b){n=b.item.index(".dz-preview")},
update:function(a,b){p=b.item.index(".dz-preview");d.files.move(n,p)}});Array.prototype.move=function(a,b){this.splice(b,0,this.splice(a,1)[0])}});
