jQuery(function(c){console.log("initializing media meta box");c(window).on("dragover",function(b){b=b||event;b.preventDefault()});c(window).on("drop",function(b){b=b||event;b.preventDefault()});c("body").on("click",".dz-feature",function(b){if(!c(this).hasClass("fa-heart")){var e=this;b=c(".dz-feature").index(this);c.ajax({url:jc_data.ajaxurl,method:"post",data:{action:"jp_commerce_set_artwork_featured_image",nonce:f,name:Dropzone.instances[0].files[b].name,post_id:g,author_id:h}}).success(function(){c(".fa-heart").removeClass("fa-heart").addClass("fa-heart-o");
c(e).removeClass("fa-heart-o").addClass("fa-heart")}).error(function(){console.log("failed to set featured image on server.")})}});Dropzone.autoDiscover=!1;var g=c("#media-upload-wrap").attr("data-post_id"),h=c("#media-upload-wrap").attr("data-author_id"),f=c("#media-upload-wrap").attr("data-nonce");c("#media-upload-wrap").dropzone({url:jc_data.ajaxurl,method:"post",maxFiles:5,acceptedFiles:"image/*",uploadMultiple:!1,previewTemplate:'<div class="dz-preview dz-file-preview">   <div class="dz-details">       <img data-dz-thumbnail />   </div>   <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>    <div class="controls">       <i class="dz-remove fa fa-close" data-dz-remove></i>       <i class="dz-feature fa fa-heart-o"></i>   </div></div> ',
clickable:".dz-clickable",dictInvalidFileType:"Invalid file type.",dictResponseError:"Upload Failed. \nError Code: {{statusCode}}.",dictMaxFilesExceeded:"Exceeded number of files allowed."});var a=Dropzone.instances[0];a.on("addedfile",function(b){c("#media-upload-wrap").append(c("#upload-indicator-wrap"));if(this.files.length){var e,a;e=0;for(a=this.files.length;e<a-1;e++)this.files[e].name===b.name&&(this.files.splice(e,1),alert("Another file with the same name already exists!"))}});a.on("maxfilesexceeded",
function(b){this.removeFile(b)});a.on("removedfile",function(b){4==this.files.length&&this.enable();console.log(b);c.ajax({url:jc_data.ajaxurl,method:"post",data:{action:"jp_commerce_remove_artwork_media",nonce:f,name:b.name,post_id:g,author_id:h}}).done(function(){alert("file is successfully deleted.")}).fail(function(){alert("failed to delete file from server.")})});a.on("sending",function(b,c,a){a.append("action","jp_commerce_upload_artwork_media");a.append("post_id",g);a.append("author_id",h);
a.append("nonce",f)});a.on("success",function(b,a){console.log(b);console.log(a.data.filename);var d=c.inArray(b,this.files);a.success?(this.files[d].name=a.data.filename,console.log(this.files[d].name)):alert(a.data)});var k=existing_thumbnails.length;console.log("file count: "+k);a.options.maxFiles-=k;for(var l,m=0;m<k;m++){l=existing_thumbnails[m];var d={name:l.name,size:123};console.log("mockFile: "+d.size);a.files.push(d);a.emit("addedfile",d);a.emit("thumbnail",d,l.url);a.emit("complete",d)}});
