jQuery(function(b){console.log("initializing media meta box");b(window).on("dragover",function(a){a=a||event;a.preventDefault()});b(window).on("drop",function(a){a=a||event;a.preventDefault()});b("body").on("click",".dz-feature",function(a){if(!b(this).hasClass("fa-heart")){var d=this;a=b(".dz-feature").index(this);b.ajax({url:jc_data.ajaxurl,method:"post",data:{action:"jp_commerce_set_artwork_featured_image",nonce:f,name:Dropzone.instances[0].files[a].name,post_id:g,author_id:h}}).success(function(){b(".fa-heart").removeClass("fa-heart").addClass("fa-heart-o");
b(d).removeClass("fa-heart-o").addClass("fa-heart")}).error(function(){console.log("failed to set featured image on server.")})}});Dropzone.autoDiscover=!1;Dropzone.prototype.addFile=function(a){if(this.files.length){var d,b;d=0;for(b=this.files.length;d<b;d++)if(this.files[d].name===a.name&&this.files[d].size===a.size)return!1}a.upload={progress:0,total:a.size,bytesSent:0};this.files.push(a);a.status=Dropzone.ADDED;this.emit("addedfile",a);this._enqueueThumbnail(a);return this.accept(a,function(b){return function(d){d?
(a.accepted=!1,b._errorProcessing([a],d)):(a.accepted=!0,b.options.autoQueue&&b.enqueueFile(a));return b._updateMaxFilesReachedClass()}}(this))};var g=b("#media-upload-wrap").attr("data-post_id"),h=b("#media-upload-wrap").attr("data-author_id"),f=b("#media-upload-wrap").attr("data-nonce");b("#media-upload-wrap").dropzone({url:jc_data.ajaxurl,method:"post",maxFiles:5,acceptedFiles:"image/*",uploadMultiple:!1,previewTemplate:'<div class="dz-preview dz-file-preview">   <div class="dz-details">       <img data-dz-thumbnail />   </div>   <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>    <div class="controls">       <i class="dz-remove fa fa-close" data-dz-remove></i>       <i class="dz-feature fa fa-heart-o"></i>   </div></div> ',
clickable:".dz-clickable",dictInvalidFileType:"Invalid file type.",dictResponseError:"Upload Failed. \nError Code: {{statusCode}}.",dictMaxFilesExceeded:"Exceeded number of files allowed."});var c=Dropzone.instances[0];c.on("addedfile",function(a){b("#media-upload-wrap").append(b("#upload-indicator-wrap"));if(this.files.length){var d,c;d=0;for(c=this.files.length;d<c-1;d++)this.files[d].name===a.name&&(this.files.splice(d,1),alert("Another file with the same name already exists!"))}});c.on("maxfilesexceeded",
function(a){this.removeFile(a)});c.on("removedfile",function(a){console.log(this.files.length);4==this.files.length&&this.enable();console.log(a);b.ajax({url:jc_data.ajaxurl,method:"post",data:{action:"jp_commerce_remove_artwork_media",nonce:f,name:a.name,post_id:g,author_id:h}}).fail(function(){alert("failed to delete file from server.")})});c.on("sending",function(a,b,c){c.append("action","jp_commerce_upload_artwork_media");c.append("post_id",g);c.append("author_id",h);c.append("nonce",f)});c.on("success",
function(a,b){b.success||alert(b.data)});var k=existing_thumbnails.length;console.log("file count: "+k);c.options.maxFiles-=k;for(var l,m=0;m<k;m++){l=existing_thumbnails[m];var e={name:l.name,size:123};console.log("mockFile: "+e.size);c.files.push(e);c.emit("addedfile",e);c.emit("thumbnail",e,l.url);c.emit("complete",e)}});
