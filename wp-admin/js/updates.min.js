window.wp=window.wp||{};
(function(c,a,f){a.updates={};a.updates.ajaxNonce=window._wpUpdatesSettings.ajax_nonce;a.updates.l10n=window._wpUpdatesSettings.l10n;a.updates.shouldRequestFilesystemCredentials=null;a.updates.filesystemCredentials={ftp:{host:null,username:null,password:null,connectionType:null},ssh:{publicKey:null,privateKey:null}};a.updates.updateLock=!1;a.updates.updateDoneSuccessfully=!1;a.updates.updateQueue=[];a.updates.$elToReturnFocusToFromCredentialsModal=null;a.updates.decrementCount=function(a){var d,e,
f=c("#wp-admin-bar-updates .ab-label"),g=c('a[href="update-core.php"] .update-plugins'),k=c("#menu-plugins");d=f.text();d=parseInt(d,10)-1;0>d||isNaN(d)||(c("#wp-admin-bar-updates .ab-item").removeAttr("title"),f.text(d),g.each(function(a,b){b.className=b.className.replace(/count-\d+/,"count-"+d)}),g.removeAttr("title"),g.find(".update-count").text(d),"plugin"===a&&(e=k.find(".plugin-count").eq(0).text(),e=parseInt(e,10)-1,0>e||isNaN(e)||(k.find(".plugin-count").text(e),k.find(".update-plugins").each(function(a,
b){b.className=b.className.replace(/count-\d+/,"count-"+e)}),0<e?c(".subsubsub .upgrade .count").text("("+e+")"):c(".subsubsub .upgrade").remove())))};a.updates.updatePlugin=function(b,d){var e,h,g=c(".plugin-card-"+d);"plugins"===f||"plugins-network"===f?e=c('[data-slug="'+d+'"]').next().find(".update-message"):"plugin-install"===f&&(e=g.find(".update-now"),h=e.data("name"),e.attr("aria-label",a.updates.l10n.updatingLabel.replace("%s",h)),g.removeClass("plugin-card-update-failed").find(".notice.notice-error").remove());
e.addClass("updating-message");e.html()!==a.updates.l10n.updating&&e.data("originaltext",e.html());e.text(a.updates.l10n.updating);a.a11y.speak(a.updates.l10n.updatingMsg);a.updates.updateLock?a.updates.updateQueue.push({type:"update-plugin",data:{plugin:b,slug:d}}):(a.updates.updateLock=!0,a.ajax.post("update-plugin",{_ajax_nonce:a.updates.ajaxNonce,plugin:b,slug:d,username:a.updates.filesystemCredentials.ftp.username,password:a.updates.filesystemCredentials.ftp.password,hostname:a.updates.filesystemCredentials.ftp.hostname,
connection_type:a.updates.filesystemCredentials.ftp.connectionType,public_key:a.updates.filesystemCredentials.ssh.publicKey,private_key:a.updates.filesystemCredentials.ssh.privateKey}).done(a.updates.updateSuccess).fail(a.updates.updateError))};a.updates.updateSuccess=function(b){var d,e,h;"plugins"===f||"plugins-network"===f?(e=c('[data-slug="'+b.slug+'"]').first(),d=e.next().find(".update-message"),e.addClass("updated").removeClass("update"),h=e.find(".plugin-version-author-uri").html().replace(b.oldVersion,
b.newVersion),e.find(".plugin-version-author-uri").html(h),e.next().addClass("updated")):"plugin-install"===f&&(d=c(".plugin-card-"+b.slug).find(".update-now"),d.addClass("button-disabled"),e=d.data("name"),d.attr("aria-label",a.updates.l10n.updatedLabel.replace("%s",e)));d.removeClass("updating-message").addClass("updated-message");d.text(a.updates.l10n.updated);a.a11y.speak(a.updates.l10n.updatedMsg);a.updates.decrementCount("plugin");a.updates.updateDoneSuccessfully=!0;a.updates.updateLock=!1;
c(document).trigger("wp-plugin-update-success",b);a.updates.queueChecker()};a.updates.updateError=function(b){var d=c(".plugin-card-"+b.slug),e,h,g;a.updates.updateDoneSuccessfully=!1;b.errorCode&&"unable_to_connect_to_filesystem"==b.errorCode&&a.updates.shouldRequestFilesystemCredentials?a.updates.credentialError(b,"update-plugin"):(g=a.updates.l10n.updateFailed.replace("%s",b.error),"plugins"===f||"plugins-network"===f?(e=c('[data-slug="'+b.slug+'"]').next().find(".update-message"),e.html(g).removeClass("updating-message")):
"plugin-install"===f&&(e=d.find(".update-now"),h=e.data("name"),d.addClass("plugin-card-update-failed").append('<div class="notice notice-error is-dismissible"><p>'+g+"</p></div>"),e.attr("aria-label",a.updates.l10n.updateFailedLabel.replace("%s",h)).html(a.updates.l10n.updateFailedShort).removeClass("updating-message"),d.on("click",".notice.is-dismissible .notice-dismiss",function(){setTimeout(function(){d.removeClass("plugin-card-update-failed").find(".column-name a").focus()},200)})),a.a11y.speak(g,
"assertive"),a.updates.updateLock=!1,c(document).trigger("wp-plugin-update-error",b),a.updates.queueChecker())};a.updates.showErrorInCredentialsForm=function(a){var d=c(".notification-dialog");d.find(".error").remove();d.find("h3").after('<div class="error">'+a+"</div>")};a.updates.credentialError=function(b,c){a.updates.updateQueue.push({type:c,data:{plugin:b.plugin,slug:b.slug}});a.updates.showErrorInCredentialsForm(b.error);a.updates.requestFilesystemCredentials()};a.updates.queueChecker=function(){if(!(a.updates.updateLock||
0>=a.updates.updateQueue.length)){var b=a.updates.updateQueue.shift();a.updates.updatePlugin(b.data.plugin,b.data.slug)}};a.updates.requestFilesystemCredentials=function(b){!1===a.updates.updateDoneSuccessfully&&("plugin-install"===f&&b&&(a.updates.$elToReturnFocusToFromCredentialsModal=c(b.target)),a.updates.updateLock=!0,a.updates.requestForCredentialsModalOpen())};a.updates.keydown=function(b){27===b.keyCode?a.updates.requestForCredentialsModalCancel():9===b.keyCode&&("upgrade"!==b.target.id||
b.shiftKey?"hostname"===b.target.id&&b.shiftKey&&(c("#upgrade").focus(),b.preventDefault()):(c("#hostname").focus(),b.preventDefault()))};a.updates.requestForCredentialsModalOpen=function(){var b=c("#request-filesystem-credentials-dialog");c("body").addClass("modal-open");b.show();b.find("input:enabled:first").focus();b.keydown(a.updates.keydown)};a.updates.requestForCredentialsModalClose=function(){c("#request-filesystem-credentials-dialog").hide();c("body").removeClass("modal-open");a.updates.$elToReturnFocusToFromCredentialsModal.focus()};
a.updates.requestForCredentialsModalCancel=function(){var b,d;if(!1!==a.updates.updateLock||0!==a.updates.updateQueue.length)b=a.updates.updateQueue[0].data.slug,a.updates.updateLock=!1,a.updates.updateQueue=[],a.updates.requestForCredentialsModalClose(),"plugins"===f||"plugins-network"===f?d=c('[data-slug="'+b+'"]').next().find(".update-message"):"plugin-install"===f&&(d=c(".plugin-card-"+b).find(".update-now")),d.removeClass("updating-message"),d.html(d.data("originaltext")),a.a11y.speak(a.updates.l10n.updateCancel)};
a.updates.beforeunload=function(){if(a.updates.updateLock)return a.updates.l10n.beforeunload};c(document).ready(function(){a.updates.shouldRequestFilesystemCredentials=0>=c("#request-filesystem-credentials-dialog").length?!1:!0;c("#request-filesystem-credentials-dialog form").on("submit",function(){a.updates.filesystemCredentials.ftp.hostname=c("#hostname").val();a.updates.filesystemCredentials.ftp.username=c("#username").val();a.updates.filesystemCredentials.ftp.password=c("#password").val();a.updates.filesystemCredentials.ftp.connectionType=
c('input[name="connection_type"]:checked').val();a.updates.filesystemCredentials.ssh.publicKey=c("#public_key").val();a.updates.filesystemCredentials.ssh.privateKey=c("#private_key").val();a.updates.requestForCredentialsModalClose();a.updates.updateLock=!1;a.updates.queueChecker();return!1});c('#request-filesystem-credentials-dialog [data-js-action="close"], .notification-dialog-background').on("click",function(){a.updates.requestForCredentialsModalCancel()});c('#request-filesystem-credentials-dialog input[name="connection_type"]').on("change",
function(){c(this).parents("form").find("#private_key, #public_key").parents("label").toggle("ssh"==c(this).val())}).change();c(".plugin-update-tr").on("click",".update-link",function(b){b.preventDefault();a.updates.shouldRequestFilesystemCredentials&&!a.updates.updateLock&&a.updates.requestFilesystemCredentials(b);b=c(b.target).parents(".plugin-update-tr");a.updates.$elToReturnFocusToFromCredentialsModal=c("#"+b.data("slug")).find(".check-column input");a.updates.updatePlugin(b.data("plugin"),b.data("slug"))});
c(".plugin-card").on("click",".update-now",function(b){b.preventDefault();var d=c(b.target);a.updates.shouldRequestFilesystemCredentials&&!a.updates.updateLock&&a.updates.requestFilesystemCredentials(b);a.updates.updatePlugin(d.data("plugin"),d.data("slug"))});c("#plugin_update_from_iframe").on("click",function(a){var d;d=window.parent==window?null:window.parent;c.support.postMessage=!!window.postMessage;!1!==c.support.postMessage&&null!==d&&-1===window.parent.location.pathname.indexOf("update-core.php")&&
(a.preventDefault(),a={action:"updatePlugin",slug:c(this).data("slug")},d.postMessage(JSON.stringify(a),window.location.origin))})});c(window).on("message",function(b){b=b.originalEvent;var d=document.location;if(b.origin===d.protocol+"//"+d.hostname&&(b=c.parseJSON(b.data),"undefined"!==typeof b.action))switch(b.action){case "decrementUpdateCount":a.updates.decrementCount(b.upgradeType);break;case "updatePlugin":tb_remove(),"plugins"===f||"plugins-network"===f?(c("#"+b.slug).find(".check-column input").focus(),
c('.plugin-update-tr[data-slug="'+b.slug+'"]').find(".update-link").trigger("click")):"plugin-install"===f&&(c(".plugin-card-"+b.slug).find(".column-name a").focus(),c(".plugin-card-"+b.slug).find('[data-slug="'+b.slug+'"]').trigger("click"))}});c(window).on("beforeunload",a.updates.beforeunload)})(jQuery,window.wp,window.pagenow,window.ajaxurl);
