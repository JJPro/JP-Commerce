(function(a,c){c.wp=c.wp||{};c.wp.pressThis=new function(){function p(a){return a&&c.pressThisL10n?c.pressThisL10n[a]||a:a||""}function t(a){return(a||"").replace(/\x3c!--[\s\S]*?(--\x3e|$)/g,"").replace(/<(script|style)[^>]*>[\s\S]*?(<\/\1>|$)/ig,"").replace(/<\/?[a-z][\s\S]*?(>|$)/ig,"")}function O(a){a=t(a);try{C.innerHTML=a,a=t(C.value)}catch(b){}return a}function q(e){e=a.trim(e||"");return/^(?:https?:)?\/\//.test(e)?(e=t(e),e.replace(/["\\]+/g,"")):""}function u(a){if(!f||f.isHidden())(a="reset"===
a||v&&v>g.value.length)?(a=c.pageYOffset,g.style.height="auto",g.style.height=Math.max(g.scrollHeight,600)+"px",c.scrollTo(c.pageXOffset,a)):parseInt(g.style.height,10)<g.scrollHeight&&(g.style.height=g.scrollHeight+"px"),v=g.value.length}function P(a){var b=c.tinymce.util.VK;a=a.keyCode;47>=a&&a!==b.SPACEBAR&&a!==b.ENTER&&a!==b.DELETE&&a!==b.BACKSPACE&&a!==b.UP&&a!==b.LEFT&&a!==b.DOWN&&a!==b.UP||91<=a&&93>=a||112<=a&&123>=a||144===a||145===a||D(a)}function D(a){var b,d,k,m;if(f){b=f.selection.getNode();
if(f.wp&&f.wp.getView&&(k=f.wp.getView(b)))d=k.getBoundingClientRect();else{k=f.selection.getRng();try{d=k.getClientRects()[0]}catch(g){}d||(d=b.getBoundingClientRect())}m=d.height?d:!1}else m=!1;var w=c.tinymce.util.VK;m&&(b=m.top+f.iframeElement.getBoundingClientRect().top,d=b+m.height,b-=50,d+=65,k=E.height(),k<m.height||(0>b&&(a===w.UP||a===w.LEFT||a===w.BACKSPACE)?c.scrollTo(c.pageXOffset,b+c.pageYOffset):d>k&&c.scrollTo(c.pageXOffset,d+c.pageYOffset-k)))}function F(){var e=a("#title-container");
e.find("img.emoji").each(function(){var b=a(this);b.replaceWith(a("<span>").text(b.attr("alt")))});return O(e.text())}function G(){var e=a("#pressthis-form"),b=a('<input type="hidden" name="post_category[]" value="">');f&&f.save();a("#post_title").val(F());c.tagBox&&a("div.tagsdiv").each(function(){c.tagBox.flushTags(this,!1,1)});a(".categories-select .category").each(function(d,k){var c=a(k);c.hasClass("selected")&&e.append(b.clone().val(c.attr("data-term-id")||""))})}function x(e){r=!1;a(".spinner").addClass("is-active");
a(".post-actions button").attr("disabled","disabled");"publish"===e&&a("#post_status").val("publish");G();e=a("#pressthis-form").serialize();a.ajax({type:"post",url:c.ajaxurl,data:e}).always(function(){a(".spinner").removeClass("is-active");a(".post-actions button").removeAttr("disabled");a("div.alerts").empty();a(".publish-button").removeClass("is-saving")}).done(function(a){if(!a.success)n(a.data.errorMessage);else if(a.data.redirect)if(c.opener&&(Q.redirInParent||a.data.force))try{c.opener.location.href=
a.data.redirect,c.setTimeout(function(){c.self.close()},200)}catch(d){c.location.href=a.data.redirect}else c.location.href=a.data.redirect}).fail(function(){n(p("serverError"))})}function R(){var e;if(e=a("#new-category").val())e={action:"press-this-add-category",post_id:a("#post_ID").val()||0,name:e,new_cat_nonce:a("#_ajax_nonce-add-category").val()||"",parent:a("#new-category-parent").val()||0},a.post(c.ajaxurl,e,function(b){if(b.success){var d,e,c=a("ul.categories-select");a.each(b.data,function(b,
f){var g=a("<li>").append(a('<div class="category selected" tabindex="0" role="checkbox" aria-checked="true">').attr("data-term-id",f.term_id).text(f.name));f.parent?(e&&e.length||(d=c.find('div[data-term-id="'+f.parent+'"]').parent(),e=d.find("ul.children:first"),e.length||(e=a('<ul class="children">').appendTo(d))),e.prepend(g)):c.prepend(g);g.focus()});H()}else n(b.data.errorMessage)})}function I(e,b){a(".editor-wrapper div.alerts").append(a('<p class="alert '+(b?"is-error":"is-notice")+'">').text(e))}
function n(a){I(a,!0)}function S(){h.errors&&a.each(h.errors,function(a,b){n(b)})}function T(){var e=0;y=a("ul.media-list");z=a('<li class="suggested-media-thumbnail" tabindex="0"><span class="screen-reader-text"></span></li>');h._embeds&&a.each(h._embeds,function(a,d){var c="",f=z.clone().addClass("is-embed");d=q(d);-1<d.indexOf("youtube.com/")?c="https://i.ytimg.com/vi/"+d.replace(/.+v=([^&]+).*/,"$1")+"/hqdefault.jpg":-1<d.indexOf("youtu.be/")?c="https://i.ytimg.com/vi/"+d.replace(/\/([^\/])$/,
"$1")+"/hqdefault.jpg":-1<d.indexOf("dailymotion.com")?c=d.replace("/video/","/thumbnail/video/"):-1<d.indexOf("soundcloud.com")||d.indexOf("twitter.com");f.attr("data-wp-src",d).find("span").text(p("suggestedEmbedAlt").replace("%d",a+1));c&&f.css("background-image","url("+c+")");y.append(f);e++});h._images&&a.each(h._images,function(a,d){var c,f=new Image;d=q(d);c=d.replace(/^(http[^\?]+)(\?.*)?$/,"$1");c=-1<d.indexOf("files.wordpress.com/")?c.replace(/\?.*$/,"")+"?w=128":-1<d.indexOf("gravatar.com/")?
c.replace(/\?.*$/,"")+"?s=128":d;f.onload=function(){if(!(f.width&&256>f.width||f.height&&128>f.height)){var e=d,g=c,h=z.clone().addClass("is-image");h.attr("data-wp-src",e).css("background-image","url("+g+")").find("span").text(p("suggestedImgAlt").replace("%d",a+1));y.append(h)}};f.src=d;e++});e&&a(".media-list-container").addClass("has-media")}function U(){var e=a(".post-options"),b=a(".post-option"),d=a(".setting-modal"),c=a(".modal-close");b.on("click",function(){var b=a(this).index(),b=d.eq(b);
e.addClass("is-off-screen").one(l,function(){a(this).addClass("is-hidden")});b.removeClass("is-off-screen is-hidden").one(l,function(){a(this).find(".modal-close").focus()})});c.on("click",function(){var d=a(this).parent(),c=d.index();e.removeClass("is-off-screen is-hidden");d.addClass("is-off-screen");if(l)d.one(l,function(){a(this).addClass("is-hidden");b.eq(c-1).focus()});else setTimeout(function(){d.addClass("is-hidden");b.eq(c-1).focus()},350)})}function V(){A=!0;a(".options").removeClass("closed").addClass("open");
a(".press-this-actions, #scanbar").addClass("is-hidden");a(".options-panel-back").removeClass("is-hidden");a(".options-panel").removeClass("is-off-screen is-hidden").one(l,function(){a(".post-option:first").focus()})}function J(){A=!1;a(".options").removeClass("open").addClass("closed");a(".options-panel-back").addClass("is-hidden");a(".press-this-actions, #scanbar").removeClass("is-hidden");a(".options-panel").addClass("is-off-screen").one(l,function(){a(this).addClass("is-hidden");a(".post-options").removeClass("is-off-screen is-hidden");
a(".setting-modal").addClass("is-off-screen is-hidden")})}function W(){var e=a("#title-container"),b=a(".post-title-placeholder");e.on("focus",function(){b.addClass("is-hidden")}).on("blur",function(){e.text()||e.html()||b.removeClass("is-hidden")}).on("keyup",function(){r=!0}).on("paste",function(b){var f,g,h=b.originalEvent.clipboardData||c.clipboardData;if(h){try{if(f=h.getData("Text")||h.getData("text/plain"))if(f=a.trim(f.replace(/\s+/g," ")),c.getSelection){if(g=c.getSelection().getRangeAt(0))g.collapsed||
g.deleteContents(),g.insertNode(document.createTextNode(f))}else document.selection&&(g=document.selection.createRange())&&(g.text=f)}catch(l){}b.preventDefault()}r=!0;setTimeout(function(){e.text(F())},50)});(e.text()||e.html())&&b.addClass("is-hidden")}function X(){a(".categories-select").on("click.press-this keydown.press-this",function(c){var b=a(c.target);!b.is("div.category")||"keydown"===c.type&&32!==c.keyCode||(b.hasClass("selected")?b.removeClass("selected").attr("aria-checked","false"):
b.addClass("selected").attr("aria-checked","true"),c.preventDefault())})}function K(){a(".split-button").removeClass("is-open");a(".split-button-toggle").attr("aria-expanded","false")}function Y(){var e=a(".split-button");L.on("tinymce-editor-init",function(a,c){f=c;f.on("nodechange",function(){M=!0});f.on("focus",function(){K()});f.on("show",function(){setTimeout(function(){f.execCommand("wpAutoResize")},300)});f.on("hide",function(){setTimeout(function(){u("reset")},100)});f.on("keyup",P);f.on("undo redo",
D)}).on("click.press-this keypress.press-this",".suggested-media-thumbnail",function(b){if("click"===b.type||13===b.keyCode){b=a(this);var d,e;d="";d=q(b.attr("data-wp-src")||"");e=q(h.u);b.hasClass("is-image")?(e||(e=d),d='<a href="'+e+'"><img class="alignnone size-full" src="'+d+'" /></a>'):d="[embed]"+d+"[/embed]";f&&!f.isHidden()?M?f.execCommand("mceInsertContent",!1,d):f.setContent("<p>"+d+"</p>"+f.getContent()):c.QTags&&c.QTags.insertContent(d)}}).on("click.press-this",function(b){a(b.target).closest("button").hasClass("split-button-toggle")||
K()});a(".post-actions").on("click.press-this",function(b){b=a(b.target).closest("button");b.length&&(b.hasClass("draft-button")?(a(".publish-button").addClass("is-saving"),x("draft")):b.hasClass("publish-button")?(b.addClass("is-saving"),x("publish")):b.hasClass("preview-button")?(G(),c.opener&&c.opener.focus(),a("#wp-preview").val("dopreview"),a("#pressthis-form").attr("target","_blank").submit().attr("target",""),a("#wp-preview").val("")):b.hasClass("standard-editor-button")?(a(".publish-button").addClass("is-saving"),
a("#pt-force-redirect").val("true"),x("draft")):b.hasClass("split-button-toggle")&&(e.hasClass("is-open")?(e.removeClass("is-open"),b.attr("aria-expanded","false")):(e.addClass("is-open"),b.attr("aria-expanded","true"))))});U();W();X();a(".options").on("click.press-this",function(){a(this).hasClass("open")?J():V()});a(".options-panel, .options-panel-back").on("focusout.press-this",function(){setTimeout(function(){var b=document.activeElement,c=a(b);!A||!b||c.hasClass("options-panel-back")||"BODY"!==
b.nodeName&&(c.closest(".options-panel").length||c.closest(".options").length)||J()},50)});a("#post-formats-select input").on("change",function(){var b=a(this);b.is(":checked")&&a("#post-option-post-format").text(a('label[for="'+b.attr("id")+'"]').text()||"")});E.on("beforeunload.press-this",function(){if(r||f&&f.isDirty())return p("saveAlert")}).on("resize.press-this",function(){f&&!f.isHidden()||u("reset")});a("button.add-cat-toggle").on("click.press-this",function(){var b=a(this);b.toggleClass("is-toggled");
b.attr("aria-expanded","false"===b.attr("aria-expanded")?"true":"false");a(".setting-modal .add-category, .categories-search-wrapper").toggleClass("is-hidden")});a("button.add-cat-submit").on("click.press-this",R);a(".categories-search").on("keyup.press-this",function(){var b=a(this).val().toLowerCase()||"";/[\x20-\xFF]+/.test(b)&&2>b.length||(a.each(B,function(a,b){b.node.removeClass("is-hidden searched-parent")}),b&&a.each(B,function(a,c){-1===c.text.indexOf(b)?c.node.addClass("is-hidden"):c.parents.addClass("searched-parent")}))});
N.on("focus.press-this input.press-this propertychange.press-this",u);return!0}function H(){a(".categories-select").find("li").each(function(){var c=a(this);B.push({node:c,parents:c.parents("li"),text:c.children(".category").text().toLowerCase()})})}var f,y,z,E=a(c),L=a(document),r=!1,C=document.createElement("textarea"),A=!1,Q=c.wpPressThisConfig||{},h=c.wpPressThisData||{},M=!1,B=[],Z=/iPad|iPod|iPhone/.test(c.navigator.userAgent),N=a("#pressthis"),g=N[0],v=0,l=function(){var a=document.documentElement.style;
return"undefined"!==typeof a.transition?"transitionend":"undefined"!==typeof a.WebkitTransition?"webkitTransitionEnd":!1}();L.ready(function(){h.hasData&&a("#scanbar").hide();T();S();c.tagBox&&c.tagBox.init();Z&&a(document.body).css("cursor","pointer");Y();H()});return{renderNotice:I,renderError:n}}})(jQuery,window);
