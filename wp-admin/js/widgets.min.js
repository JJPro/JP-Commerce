var wpWidgets;
(function(a){var n=a(document);wpWidgets={hoveredSidebar:null,init:function(){var c,b,d=this,e=a(".widgets-chooser"),f=e.find(".widgets-chooser-sidebars"),g=a("div.widgets-sortables"),l=!("undefined"===typeof isRtl||!isRtl);a("#widgets-right .sidebar-name").click(function(){var m=a(this),h=m.closest(".widgets-holder-wrap");h.hasClass("closed")?(h.removeClass("closed"),m.parent().sortable("refresh")):h.addClass("closed");n.triggerHandler("wp-pin-menu")});a("#widgets-left .sidebar-name").click(function(){a(this).closest(".widgets-holder-wrap").toggleClass("closed");n.triggerHandler("wp-pin-menu")});
a(document.body).bind("click.widgets-toggle",function(m){var h=a(m.target),c={"z-index":100},b,d,e,f;h.parents(".widget-top").length&&!h.parents("#available-widgets").length?(b=h.closest("div.widget"),h=b.children(".widget-inside"),d=parseInt(b.find("input.widget-width").val(),10),e=b.parent().width(),h.is(":hidden")?(250<d&&d+30>e&&b.closest("div.widgets-sortables").length&&(f=b.closest("div.widget-liquid-right").length?l?"margin-right":"margin-left":l?"margin-left":"margin-right",c[f]=e-(d+30)+
"px",b.css(c)),b.addClass("open"),h.slideDown("fast")):h.slideUp("fast",function(){b.attr("style","");b.removeClass("open")}),m.preventDefault()):h.hasClass("widget-control-save")?(wpWidgets.save(h.closest("div.widget"),0,1,0),m.preventDefault()):h.hasClass("widget-control-remove")?(wpWidgets.save(h.closest("div.widget"),1,1,0),m.preventDefault()):h.hasClass("widget-control-close")?(b=h.closest("div.widget"),b.removeClass("open"),wpWidgets.close(b),m.preventDefault()):"inactive-widgets-control-remove"===
h.attr("id")&&(wpWidgets.removeInactiveWidgets(),m.preventDefault())});g.children(".widget").each(function(){var b=a(this);wpWidgets.appendTitle(this);b.find("p.widget-error").length&&b.find("a.widget-action").trigger("click")});a("#widget-list").children(".widget").draggable({connectToSortable:"div.widgets-sortables",handle:"> .widget-top > .widget-title",distance:2,helper:"clone",zIndex:100,containment:"#wpwrap",refreshPositions:!0,start:function(c,h){var p=a(this).find(".widgets-chooser");h.helper.find("div.widget-description").hide();
b=this.id;p.length&&(a("#wpbody-content").append(p.hide()),h.helper.find(".widgets-chooser").remove(),d.clearWidgetSelection())},stop:function(){c&&a(c).hide();c=""}});g.droppable({tolerance:"intersect",over:function(b){var c=a(b.target).parent();wpWidgets.hoveredSidebar&&!c.is(wpWidgets.hoveredSidebar)&&wpWidgets.closeSidebar(b);c.hasClass("closed")&&(wpWidgets.hoveredSidebar=c,c.removeClass("closed"));a(this).sortable("refresh")},out:function(a){wpWidgets.hoveredSidebar&&wpWidgets.closeSidebar(a)}});
g.sortable({placeholder:"widget-placeholder",items:"> .widget",handle:"> .widget-top > .widget-title",cursor:"move",distance:2,containment:"#wpwrap",tolerance:"pointer",refreshPositions:!0,start:function(b,c){var d,e=a(this);d=e.parent();var f=c.item.children(".widget-inside");"block"===f.css("display")&&(c.item.removeClass("open"),f.hide(),a(this).sortable("refreshPositions"));d.hasClass("closed")||(d=c.item.hasClass("ui-draggable")?e.height():1+e.height(),e.css("min-height",d+"px"))},stop:function(m,
h){var d,e,f,g,l,k=h.item;f=b;wpWidgets.hoveredSidebar=null;k.hasClass("deleting")?(wpWidgets.save(k,1,0,1),k.remove()):(d=k.find("input.add_new").val(),e=k.find("input.multi_number").val(),k.attr("style","").removeClass("ui-draggable"),b="",d&&("multi"===d?(k.html(k.html().replace(/<[^<>]+>/g,function(a){return a.replace(/__i__|%i%/g,e)})),k.attr("id",f.replace("__i__",e)),e++,a("div#"+f).find("input.multi_number").val(e)):"single"===d&&(k.attr("id","new-"+f),c="div#"+f),wpWidgets.save(k,0,0,1),
k.find("input.add_new").val(""),n.trigger("widget-added",[k])),f=k.parent(),f.parent().hasClass("closed")&&(f.parent().removeClass("closed"),g=f.children(".widget"),1<g.length&&(g=g.get(0),l=k.get(0),g.id&&l.id&&g.id!==l.id&&a(g).before(k))),d?k.find("a.widget-action").trigger("click"):wpWidgets.saveOrder(f.attr("id")))},activate:function(){a(this).parent().addClass("widget-hover")},deactivate:function(){a(this).css("min-height","").parent().removeClass("widget-hover")},receive:function(c,b){var d=
a(b.sender);-1<this.id.indexOf("orphaned_widgets")?d.sortable("cancel"):-1<d.attr("id").indexOf("orphaned_widgets")&&!d.children(".widget").length&&d.parents(".orphan-sidebar").slideUp(400,function(){a(this).remove()})}}).sortable("option","connectWith","div.widgets-sortables");a("#available-widgets").droppable({tolerance:"pointer",accept:function(c){return"widget-list"!==a(c).parent().attr("id")},drop:function(c,b){b.draggable.addClass("deleting");a("#removing-widget").hide().children("span").empty()},
over:function(c,b){b.draggable.addClass("deleting");a("div.widget-placeholder").hide();b.draggable.hasClass("ui-sortable-helper")&&a("#removing-widget").show().children("span").html(b.draggable.find("div.widget-title").children("h3").html())},out:function(b,c){c.draggable.removeClass("deleting");a("div.widget-placeholder").show();a("#removing-widget").hide().children("span").empty()}});a("#widgets-right .widgets-holder-wrap").each(function(b,c){var d=a(c),e=d.find(".sidebar-name h2").text(),d=d.find(".widgets-sortables").attr("id"),
e=a('<li tabindex="0">').text(a.trim(e));0===b&&e.addClass("widgets-chooser-selected");f.append(e);e.data("sidebarId",d)});a("#available-widgets .widget .widget-title").on("click.widgets-chooser",function(){var b=a(this).closest(".widget");b.hasClass("widget-in-question")||a("#widgets-left").hasClass("chooser")?d.closeChooser():(d.clearWidgetSelection(),a("#widgets-left").addClass("chooser"),b.addClass("widget-in-question").children(".widget-description").after(e),e.slideDown(300,function(){f.find(".widgets-chooser-selected").focus()}),
f.find("li").on("focusin.widgets-chooser",function(){f.find(".widgets-chooser-selected").removeClass("widgets-chooser-selected");a(this).addClass("widgets-chooser-selected")}))});e.on("click.widgets-chooser",function(b){b=a(b.target);b.hasClass("button-primary")?(d.addWidget(e),d.closeChooser()):b.hasClass("button-secondary")&&d.closeChooser()}).on("keyup.widgets-chooser",function(b){b.which===a.ui.keyCode.ENTER?(a(b.target).hasClass("button-secondary")||d.addWidget(e),d.closeChooser()):b.which===
a.ui.keyCode.ESCAPE&&d.closeChooser()})},saveOrder:function(c){var b={action:"widgets-order",savewidgets:a("#_wpnonce_widgets").val(),sidebars:[]};c&&a("#"+c).find(".spinner:first").addClass("is-active");a("div.widgets-sortables").each(function(){a(this).sortable&&(b["sidebars["+a(this).attr("id")+"]"]=a(this).sortable("toArray").join(","))});a.post(ajaxurl,b,function(){a("#inactive-widgets-control-remove").prop("disabled",!a("#wp_inactive_widgets .widget").length);a(".spinner").removeClass("is-active")})},
save:function(c,b,d,e){var f=c.closest("div.widgets-sortables").attr("id"),g=c.find("form").serialize(),l;c=a(c);a(".spinner",c).addClass("is-active");l={action:"save-widget",savewidgets:a("#_wpnonce_widgets").val(),sidebar:f};b&&(l.delete_widget=1);g+="&"+a.param(l);a.post(ajaxurl,g,function(g){var h;b?(a("input.widget_number",c).val()||(h=a("input.widget-id",c).val(),a("#available-widgets").find("input.widget-id").each(function(){a(this).val()===h&&a(this).closest("div.widget").show()})),d?(e=0,
c.slideUp("fast",function(){a(this).remove();wpWidgets.saveOrder()})):(c.remove(),"wp_inactive_widgets"===f&&a("#inactive-widgets-control-remove").prop("disabled",!a("#wp_inactive_widgets .widget").length))):(a(".spinner").removeClass("is-active"),g&&2<g.length&&(a("div.widget-content",c).html(g),wpWidgets.appendTitle(c),n.trigger("widget-updated",[c]),"wp_inactive_widgets"===f&&a("#inactive-widgets-control-remove").prop("disabled",!a("#wp_inactive_widgets .widget").length)));e&&wpWidgets.saveOrder()})},
removeInactiveWidgets:function(){var c=a(".remove-inactive-widgets"),b;a(".spinner",c).addClass("is-active");b={action:"delete-inactive-widgets",removeinactivewidgets:a("#_wpnonce_remove_inactive_widgets").val()};b=a.param(b);a.post(ajaxurl,b,function(){a("#wp_inactive_widgets .widget").remove();a("#inactive-widgets-control-remove").prop("disabled",!0);a(".spinner",c).removeClass("is-active")})},appendTitle:function(c){var b=a('input[id*="-title"]',c).val()||"";b&&(b=": "+b.replace(/<[^<>]+>/g,"").replace(/</g,
"&lt;").replace(/>/g,"&gt;"));a(c).children(".widget-top").children(".widget-title").children().children(".in-widget-title").html(b)},close:function(a){a.children(".widget-inside").slideUp("fast",function(){a.attr("style","")})},addWidget:function(c){var b,d,e,f,g;c=c.find(".widgets-chooser-selected").data("sidebarId");c=a("#"+c);b=a("#available-widgets").find(".widget-in-question").clone();d=b.attr("id");e=b.find("input.add_new").val();f=b.find("input.multi_number").val();b.find(".widgets-chooser").remove();
"multi"===e?(b.html(b.html().replace(/<[^<>]+>/g,function(a){return a.replace(/__i__|%i%/g,f)})),b.attr("id",d.replace("__i__",f)),f++,a("#"+d).find("input.multi_number").val(f)):"single"===e&&(b.attr("id","new-"+d),a("#"+d).hide());c.closest(".widgets-holder-wrap").removeClass("closed");c.append(b);c.sortable("refresh");wpWidgets.save(b,0,0,1);b.find("input.add_new").val("");n.trigger("widget-added",[b]);d=a(window).scrollTop();e=d+a(window).height();g=c.offset();g.bottom=g.top+c.outerHeight();(d>
g.bottom||e<g.top)&&a("html, body").animate({scrollTop:g.top-130},200);window.setTimeout(function(){b.find(".widget-title").trigger("click")},250)},closeChooser:function(){var c=this;a(".widgets-chooser").slideUp(200,function(){a("#wpbody-content").append(this);c.clearWidgetSelection()})},clearWidgetSelection:function(){a("#widgets-left").removeClass("chooser");a(".widget-in-question").removeClass("widget-in-question")},closeSidebar:function(c){this.hoveredSidebar.addClass("closed");a(c.target).css("min-height",
"");this.hoveredSidebar=null}};n.ready(function(){wpWidgets.init()})})(jQuery);
