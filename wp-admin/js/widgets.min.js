var wpWidgets;
(function(a){var n=a(document);wpWidgets={hoveredSidebar:null,init:function(){var b,c,d=this,g=a(".widgets-chooser"),h=g.find(".widgets-chooser-sidebars"),k=a("div.widgets-sortables"),p=!("undefined"===typeof isRtl||!isRtl);a("#widgets-right .sidebar-name").click(function(){var m=a(this),e=m.closest(".widgets-holder-wrap");e.hasClass("closed")?(e.removeClass("closed"),m.parent().sortable("refresh")):e.addClass("closed");n.triggerHandler("wp-pin-menu")});a("#widgets-left .sidebar-name").click(function(){a(this).closest(".widgets-holder-wrap").toggleClass("closed");n.triggerHandler("wp-pin-menu")});
a(document.body).bind("click.widgets-toggle",function(m){var e=a(m.target),b={"z-index":100},f,c,d,g;e.parents(".widget-top").length&&!e.parents("#available-widgets").length?(f=e.closest("div.widget"),e=f.children(".widget-inside"),c=parseInt(f.find("input.widget-width").val(),10),d=f.parent().width(),e.is(":hidden")?(250<c&&c+30>d&&f.closest("div.widgets-sortables").length&&(g=f.closest("div.widget-liquid-right").length?p?"margin-right":"margin-left":p?"margin-left":"margin-right",b[g]=d-(c+30)+
"px",f.css(b)),f.addClass("open"),e.slideDown("fast")):e.slideUp("fast",function(){f.attr("style","");f.removeClass("open")}),m.preventDefault()):e.hasClass("widget-control-save")?(wpWidgets.save(e.closest("div.widget"),0,1,0),m.preventDefault()):e.hasClass("widget-control-remove")?(wpWidgets.save(e.closest("div.widget"),1,1,0),m.preventDefault()):e.hasClass("widget-control-close")&&(f=e.closest("div.widget"),f.removeClass("open"),wpWidgets.close(f),m.preventDefault())});k.children(".widget").each(function(){var b=
a(this);wpWidgets.appendTitle(this);b.find("p.widget-error").length&&b.find("a.widget-action").trigger("click")});a("#widget-list").children(".widget").draggable({connectToSortable:"div.widgets-sortables",handle:"> .widget-top > .widget-title",distance:2,helper:"clone",zIndex:100,containment:"#wpwrap",refreshPositions:!0,start:function(b,e){var q=a(this).find(".widgets-chooser");e.helper.find("div.widget-description").hide();c=this.id;q.length&&(a("#wpbody-content").append(q.hide()),e.helper.find(".widgets-chooser").remove(),
d.clearWidgetSelection())},stop:function(){b&&a(b).hide();b=""}});k.droppable({tolerance:"intersect",over:function(b){var e=a(b.target).parent();wpWidgets.hoveredSidebar&&!e.is(wpWidgets.hoveredSidebar)&&wpWidgets.closeSidebar(b);e.hasClass("closed")&&(wpWidgets.hoveredSidebar=e,e.removeClass("closed"));a(this).sortable("refresh")},out:function(a){wpWidgets.hoveredSidebar&&wpWidgets.closeSidebar(a)}});k.sortable({placeholder:"widget-placeholder",items:"> .widget",handle:"> .widget-top > .widget-title",
cursor:"move",distance:2,containment:"#wpwrap",tolerance:"pointer",refreshPositions:!0,start:function(b,e){var c,f=a(this);c=f.parent();var d=e.item.children(".widget-inside");"block"===d.css("display")&&(d.hide(),a(this).sortable("refreshPositions"));c.hasClass("closed")||(c=e.item.hasClass("ui-draggable")?f.height():1+f.height(),f.css("min-height",c+"px"))},stop:function(m,e){var d,f,g,h,k,l=e.item;g=c;wpWidgets.hoveredSidebar=null;l.hasClass("deleting")?(wpWidgets.save(l,1,0,1),l.remove()):(d=
l.find("input.add_new").val(),f=l.find("input.multi_number").val(),l.attr("style","").removeClass("ui-draggable"),c="",d&&("multi"===d?(l.html(l.html().replace(/<[^<>]+>/g,function(a){return a.replace(/__i__|%i%/g,f)})),l.attr("id",g.replace("__i__",f)),f++,a("div#"+g).find("input.multi_number").val(f)):"single"===d&&(l.attr("id","new-"+g),b="div#"+g),wpWidgets.save(l,0,0,1),l.find("input.add_new").val(""),n.trigger("widget-added",[l])),g=l.parent(),g.parent().hasClass("closed")&&(g.parent().removeClass("closed"),
h=g.children(".widget"),1<h.length&&(h=h.get(0),k=l.get(0),h.id&&k.id&&h.id!==k.id&&a(h).before(l))),d?l.find("a.widget-action").trigger("click"):wpWidgets.saveOrder(g.attr("id")))},activate:function(){a(this).parent().addClass("widget-hover")},deactivate:function(){a(this).css("min-height","").parent().removeClass("widget-hover")},receive:function(b,e){var c=a(e.sender);-1<this.id.indexOf("orphaned_widgets")?c.sortable("cancel"):-1<c.attr("id").indexOf("orphaned_widgets")&&!c.children(".widget").length&&
c.parents(".orphan-sidebar").slideUp(400,function(){a(this).remove()})}}).sortable("option","connectWith","div.widgets-sortables");a("#available-widgets").droppable({tolerance:"pointer",accept:function(b){return"widget-list"!==a(b).parent().attr("id")},drop:function(b,c){c.draggable.addClass("deleting");a("#removing-widget").hide().children("span").empty()},over:function(b,c){c.draggable.addClass("deleting");a("div.widget-placeholder").hide();c.draggable.hasClass("ui-sortable-helper")&&a("#removing-widget").show().children("span").html(c.draggable.find("div.widget-title").children("h4").html())},
out:function(b,c){c.draggable.removeClass("deleting");a("div.widget-placeholder").show();a("#removing-widget").hide().children("span").empty()}});a("#widgets-right .widgets-holder-wrap").each(function(b,c){var d=a(c),f=d.find(".sidebar-name h3").text(),d=d.find(".widgets-sortables").attr("id"),f=a('<li tabindex="0">').text(a.trim(f));0===b&&f.addClass("widgets-chooser-selected");h.append(f);f.data("sidebarId",d)});a("#available-widgets .widget .widget-title").on("click.widgets-chooser",function(){var b=
a(this).closest(".widget");b.hasClass("widget-in-question")||a("#widgets-left").hasClass("chooser")?d.closeChooser():(d.clearWidgetSelection(),a("#widgets-left").addClass("chooser"),b.addClass("widget-in-question").children(".widget-description").after(g),g.slideDown(300,function(){h.find(".widgets-chooser-selected").focus()}),h.find("li").on("focusin.widgets-chooser",function(){h.find(".widgets-chooser-selected").removeClass("widgets-chooser-selected");a(this).addClass("widgets-chooser-selected")}))});
g.on("click.widgets-chooser",function(b){b=a(b.target);b.hasClass("button-primary")?(d.addWidget(g),d.closeChooser()):b.hasClass("button-secondary")&&d.closeChooser()}).on("keyup.widgets-chooser",function(b){b.which===a.ui.keyCode.ENTER?(a(b.target).hasClass("button-secondary")||d.addWidget(g),d.closeChooser()):b.which===a.ui.keyCode.ESCAPE&&d.closeChooser()})},saveOrder:function(b){var c={action:"widgets-order",savewidgets:a("#_wpnonce_widgets").val(),sidebars:[]};b&&a("#"+b).find(".spinner:first").addClass("is-active");
a("div.widgets-sortables").each(function(){a(this).sortable&&(c["sidebars["+a(this).attr("id")+"]"]=a(this).sortable("toArray").join(","))});a.post(ajaxurl,c,function(){a(".spinner").removeClass("is-active")})},save:function(b,c,d,g){var h=b.closest("div.widgets-sortables").attr("id"),k=b.find("form").serialize();b=a(b);a(".spinner",b).addClass("is-active");h={action:"save-widget",savewidgets:a("#_wpnonce_widgets").val(),sidebar:h};c&&(h.delete_widget=1);k+="&"+a.param(h);a.post(ajaxurl,k,function(h){var k;
c?(a("input.widget_number",b).val()||(k=a("input.widget-id",b).val(),a("#available-widgets").find("input.widget-id").each(function(){a(this).val()===k&&a(this).closest("div.widget").show()})),d?(g=0,b.slideUp("fast",function(){a(this).remove();wpWidgets.saveOrder()})):b.remove()):(a(".spinner").removeClass("is-active"),h&&2<h.length&&(a("div.widget-content",b).html(h),wpWidgets.appendTitle(b),n.trigger("widget-updated",[b])));g&&wpWidgets.saveOrder()})},appendTitle:function(b){var c=a('input[id*="-title"]',
b).val()||"";c&&(c=": "+c.replace(/<[^<>]+>/g,"").replace(/</g,"&lt;").replace(/>/g,"&gt;"));a(b).children(".widget-top").children(".widget-title").children().children(".in-widget-title").html(c)},close:function(a){a.children(".widget-inside").slideUp("fast",function(){a.attr("style","")})},addWidget:function(b){var c,d,g,h,k;b=b.find(".widgets-chooser-selected").data("sidebarId");b=a("#"+b);c=a("#available-widgets").find(".widget-in-question").clone();d=c.attr("id");g=c.find("input.add_new").val();
h=c.find("input.multi_number").val();c.find(".widgets-chooser").remove();"multi"===g?(c.html(c.html().replace(/<[^<>]+>/g,function(a){return a.replace(/__i__|%i%/g,h)})),c.attr("id",d.replace("__i__",h)),h++,a("#"+d).find("input.multi_number").val(h)):"single"===g&&(c.attr("id","new-"+d),a("#"+d).hide());b.closest(".widgets-holder-wrap").removeClass("closed");b.append(c);b.sortable("refresh");wpWidgets.save(c,0,0,1);c.find("input.add_new").val("");n.trigger("widget-added",[c]);d=a(window).scrollTop();
g=d+a(window).height();k=b.offset();k.bottom=k.top+b.outerHeight();(d>k.bottom||g<k.top)&&a("html, body").animate({scrollTop:k.top-130},200);window.setTimeout(function(){c.find(".widget-title").trigger("click")},250)},closeChooser:function(){var b=this;a(".widgets-chooser").slideUp(200,function(){a("#wpbody-content").append(this);b.clearWidgetSelection()})},clearWidgetSelection:function(){a("#widgets-left").removeClass("chooser");a(".widget-in-question").removeClass("widget-in-question")},closeSidebar:function(b){this.hoveredSidebar.addClass("closed");
a(b.target).css("min-height","");this.hoveredSidebar=null}};n.ready(function(){wpWidgets.init()})})(jQuery);
