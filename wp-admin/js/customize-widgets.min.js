customize-widgets.js:1932: WARNING - Misplaced function annotation. This JSDoc is not attached to a function node. Are you missing parentheses?
	api.Widgets.highlightWidgetFormControl = function( widgetId ) {
	^

0 error(s), 1 warning(s)
(function(n,e){function t(a){var b,c={number:null,id_base:null};(b=a.match(/^(.+)-(\d+)$/))?(c.id_base=b[1],c.number=parseInt(b[2],10)):c.id_base=a;return c}if(n&&n.customize){var d=n.customize,q;d.Widgets=d.Widgets||{};d.Widgets.data=_wpCustomizeWidgetsSettings||{};q=d.Widgets.data.l10n;delete d.Widgets.data.l10n;d.Widgets.WidgetModel=Backbone.Model.extend({id:null,temp_id:null,classname:null,control_tpl:null,description:null,is_disabled:null,is_multi:null,multi_number:null,name:null,id_base:null,
transport:"refresh",params:[],width:null,height:null,search_matched:!0});d.Widgets.WidgetCollection=Backbone.Collection.extend({model:d.Widgets.WidgetModel,doSearch:function(a){this.terms!==a&&(this.terms=a,0<this.terms.length&&this.search(this.terms),""===this.terms&&this.each(function(a){a.set("search_matched",!0)}))},search:function(a){var b,c;a=a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");a=a.replace(/ /g,")(?=.*");b=new RegExp("^(?=.*"+a+").+","i");this.each(function(a){c=[a.get("name"),a.get("id"),
a.get("description")].join(" ");a.set("search_matched",b.test(c))})}});d.Widgets.availableWidgets=new d.Widgets.WidgetCollection(d.Widgets.data.availableWidgets);d.Widgets.SidebarModel=Backbone.Model.extend({after_title:null,after_widget:null,before_title:null,before_widget:null,"class":null,description:null,id:null,name:null,is_rendered:!1});d.Widgets.SidebarCollection=Backbone.Collection.extend({model:d.Widgets.SidebarModel});d.Widgets.registeredSidebars=new d.Widgets.SidebarCollection(d.Widgets.data.registeredSidebars);
d.Widgets.AvailableWidgetsPanelView=n.Backbone.View.extend({el:"#available-widgets",events:{"input #widgets-search":"search","keyup #widgets-search":"search","change #widgets-search":"search","search #widgets-search":"search","focus .widget-tpl":"focus","click .widget-tpl":"_submit","keypress .widget-tpl":"_submit",keydown:"keyboardAccessible"},selected:null,currentSidebarControl:null,$search:null,initialize:function(){var a=this;this.$search=e("#widgets-search");_.bindAll(this,"close");this.listenTo(this.collection,
"change",this.updateList);this.updateList();e("#customize-controls, #available-widgets .customize-section-title").on("click keydown",function(b){b=e(b.target).is(".add-new-widget, .add-new-widget *");e("body").hasClass("adding-widget")&&!b&&a.close()});d.previewer.bind("url",this.close)},search:function(a){this.collection.doSearch(a.target.value);this.selected&&!this.selected.is(":visible")&&(this.selected.removeClass("selected"),this.selected=null);this.selected&&!a.target.value&&(this.selected.removeClass("selected"),
this.selected=null);!this.selected&&a.target.value&&(a=this.$el.find("> .widget-tpl:visible:first"),a.length&&this.select(a))},updateList:function(){this.collection.each(function(a){var b=e("#widget-tpl-"+a.id);b.toggle(a.get("search_matched")&&!a.get("is_disabled"));a.get("is_disabled")&&b.is(this.selected)&&(this.selected=null)})},select:function(a){this.selected=e(a);this.selected.siblings(".widget-tpl").removeClass("selected");this.selected.addClass("selected")},focus:function(a){this.select(e(a.currentTarget))},
_submit:function(a){"keypress"===a.type&&13!==a.which&&32!==a.which||this.submit(e(a.currentTarget))},submit:function(a){a||(a=this.selected);a&&this.currentSidebarControl&&(this.select(a),a=e(this.selected).data("widget-id"),a=this.collection.findWhere({id:a}))&&((a=this.currentSidebarControl.addWidget(a.get("id_base")))&&a.focus(),this.close())},open:function(a){this.currentSidebarControl=a;_(this.currentSidebarControl.getWidgetFormControls()).each(function(a){a.params.is_wide&&a.collapseForm()});
e("body").addClass("adding-widget");this.$el.find(".selected").removeClass("selected");this.collection.doSearch("");d.settings.browser.mobile||this.$search.focus()},close:function(a){a=a||{};a.returnFocus&&this.currentSidebarControl&&this.currentSidebarControl.container.find(".add-new-widget").focus();this.selected=this.currentSidebarControl=null;e("body").removeClass("adding-widget");this.$search.val("")},keyboardAccessible:function(a){var b=13===a.which,c=27===a.which,d=40===a.which,k=38===a.which,
g=9===a.which,l=a.shiftKey,h=null,m=this.$el.find("> .widget-tpl:visible:first"),p=this.$el.find("> .widget-tpl:visible:last"),r=e(a.target).is(this.$search),u=e(a.target).is(".widget-tpl:visible:last");if(d||k)d?r?h=m:this.selected&&0!==this.selected.nextAll(".widget-tpl:visible").length&&(h=this.selected.nextAll(".widget-tpl:visible:first")):k&&(r?h=p:this.selected&&0!==this.selected.prevAll(".widget-tpl:visible").length&&(h=this.selected.prevAll(".widget-tpl:visible:first"))),this.select(h),h?
h.focus():this.$search.focus();else if(!b||this.$search.val())b?this.submit():c&&this.close({returnFocus:!0}),this.currentSidebarControl&&g&&(l&&r||!l&&u)&&(this.currentSidebarControl.container.find(".add-new-widget").focus(),a.preventDefault())}});d.Widgets.formSyncHandlers={rss:function(a,b,c){a=b.find(".widget-error:first");c=e("<div>"+c+"</div>").find(".widget-error:first");a.length&&c.length?a.replaceWith(c):a.length?a.remove():c.length&&b.find(".widget-content:first").prepend(c)}};d.Widgets.WidgetControl=
d.Control.extend({defaultExpandedArguments:{duration:"fast",completeCallback:e.noop},initialize:function(a,b){var c=this;d.Control.prototype.initialize.call(c,a,b);c.expanded=new d.Value;c.expandedArgumentsQueue=[];c.expanded.bind(function(a){var b=c.expandedArgumentsQueue.shift(),b=e.extend({},c.defaultExpandedArguments,b);c.onChangeExpanded(a,b)});c.expanded.set(!1)},ready:function(){this._setupModel();this._setupWideWidget();this._setupControlToggle();this._setupWidgetTitle();this._setupReorderUI();
this._setupHighlightEffects();this._setupUpdateUI();this._setupRemoveUI();e(document).trigger("widget-added",[this.container.find(".widget:first")])},_setupModel:function(){var a=this,b;d.Widgets.savedWidgetIds=d.Widgets.savedWidgetIds||[];b=function(){d.Widgets.savedWidgetIds[a.params.widget_id]=!0};d.bind("ready",b);d.bind("saved",b);this._updateCount=0;this.isWidgetUpdating=!1;this.liveUpdateMode=!0;this.setting.bind(function(b,d){_(d).isEqual(b)||a.isWidgetUpdating||a.updateWidget({instance:b})})},
_setupWideWidget:function(){var a=this,b,c,f,k,g;this.params.is_wide&&(b=this.container.find(".widget-inside"),c=b.find("> .form"),f=e(".wp-full-overlay-sidebar-content:first"),this.container.addClass("wide-widget-control"),this.container.find(".widget-content:first").css({"max-width":this.params.width,"min-height":this.params.height}),g=function(){var d=a.container.offset().top,h=e(window).height(),f=c.outerHeight();b.css("max-height",h);b.css("top",Math.max(0,Math.min(Math.max(d,0),h-f)))},k=e("#customize-theme-controls"),
this.container.on("expand",function(){g();f.on("scroll",g);e(window).on("resize",g);k.on("expanded collapsed",g)}),this.container.on("collapsed",function(){f.off("scroll",g);e(window).off("resize",g);k.off("expanded collapsed",g)}),d.each(function(b){0===b.id.indexOf("sidebars_widgets[")&&b.bind(function(){a.container.hasClass("expanded")&&g()})}))},_setupControlToggle:function(){var a=this;this.container.find(".widget-top").on("click",function(b){b.preventDefault();a.getSidebarWidgetsControl().isReordering||
a.expanded(!a.expanded())});this.container.find(".widget-control-close").on("click",function(b){b.preventDefault();a.collapse();a.container.find(".widget-top .widget-action:first").focus()})},_setupWidgetTitle:function(){var a=this,b;b=function(){var b=a.setting().title,d=a.container.find(".in-widget-title");b?d.text(": "+b):d.text("")};this.setting.bind(b);b()},_setupReorderUI:function(){var a=this,b,c,f;b=function(b){b.siblings(".selected").removeClass("selected");b.addClass("selected");b=b.data("id")===
a.params.sidebar_id;a.container.find(".move-widget-btn").prop("disabled",b)};this.container.find(".widget-title-action").after(e(d.Widgets.data.tpl.widgetReorderNav));c=e(_.template(d.Widgets.data.tpl.moveWidgetArea,{sidebars:_(d.Widgets.registeredSidebars.toArray()).pluck("attributes")}));this.container.find(".widget-top").after(c);f=function(){var f=c.find("li"),g,l=0;g=f.filter(function(){return e(this).data("id")===a.params.sidebar_id});f.each(function(){var a=e(this),c;c=a.data("id");c=d.Widgets.registeredSidebars.get(c).get("is_rendered");
a.toggle(c);c&&(l+=1);a.hasClass("selected")&&!c&&b(g)});1<l?a.container.find(".move-widget").show():a.container.find(".move-widget").hide()};f();d.Widgets.registeredSidebars.on("change:is_rendered",f);this.container.find(".widget-reorder-nav").find(".move-widget, .move-widget-down, .move-widget-up").each(function(){e(this).prepend(a.container.find(".widget-title").text()+": ")}).on("click keypress",function(b){if("keypress"!==b.type||13===b.which||32===b.which)if(e(this).focus(),e(this).is(".move-widget"))a.toggleWidgetMoveArea();
else{b=e(this).is(".move-widget-down");var c=e(this).is(".move-widget-up"),d=a.getWidgetSidebarPosition();c&&0===d||b&&d===a.getSidebarWidgetsControl().setting().length-1||(c?(a.moveUp(),n.a11y.speak(q.widgetMovedUp)):(a.moveDown(),n.a11y.speak(q.widgetMovedDown)),e(this).focus())}});this.container.find(".widget-area-select").on("click keypress","li",function(a){if("keypress"!==a.type||13===a.which||32===a.which)a.preventDefault(),b(e(this))});this.container.find(".move-widget-btn").click(function(){a.getSidebarWidgetsControl().toggleReordering(!1);
var b=a.params.sidebar_id,c=a.container.find(".widget-area-select li.selected").data("id"),e,f,m,b=d("sidebars_widgets["+b+"]"),c=d("sidebars_widgets["+c+"]");e=Array.prototype.slice.call(b());f=Array.prototype.slice.call(c());m=a.getWidgetSidebarPosition();e.splice(m,1);f.push(a.params.widget_id);b(e);c(f);a.focus()})},_setupHighlightEffects:function(){var a=this;this.container.on("mouseenter click",function(){a.setting.previewer.send("highlight-widget",a.params.widget_id)});this.setting.bind(function(){a.setting.previewer.send("highlight-widget",
a.params.widget_id)})},_setupUpdateUI:function(){var a=this,b,c,f,k,g;b=this.container.find(".widget:first");c=b.find(".widget-content:first");f=this.container.find(".widget-control-save");f.val(q.saveBtnLabel);f.attr("title",q.saveBtnTooltip);f.removeClass("button-primary").addClass("button-secondary");f.on("click",function(b){b.preventDefault();a.updateWidget({disable_form:!0})});k=_.debounce(function(){a.updateWidget()},250);c.on("keydown","input",function(b){13===b.which&&(b.preventDefault(),
a.updateWidget({ignoreActiveElement:!0}))});c.on("change input propertychange",":input",function(b){a.liveUpdateMode&&("change"===b.type||this.checkValidity&&this.checkValidity())&&k()});this.setting.previewer.channel.bind("synced",function(){a.container.removeClass("previewer-loading")});d.previewer.bind("widget-updated",function(b){b===a.params.widget_id&&a.container.removeClass("previewer-loading")});if(g=d.Widgets.formSyncHandlers[this.params.widget_id_base])e(document).on("widget-synced",function(a,
c){b.is(c)&&g.apply(document,arguments)})},onChangeActive:function(a,b){this.container.toggleClass("widget-rendered",a);b.completeCallback&&b.completeCallback()},_setupRemoveUI:function(){var a=this,b,c;b=this.container.find("a.widget-control-remove");b.on("click",function(b){b.preventDefault();var c;c=a.container.next().is(".customize-control-widget_form")?a.container.next().find(".widget-action:first"):a.container.prev().is(".customize-control-widget_form")?a.container.prev().find(".widget-action:first"):
a.container.next(".customize-control-sidebar_widgets").find(".add-new-widget:first");a.container.slideUp(function(){var b=d.Widgets.getSidebarWidgetControlContainingWidget(a.params.widget_id),e,f;b&&(e=b.setting().slice(),f=_.indexOf(e,a.params.widget_id),-1!==f&&(e.splice(f,1),b.setting(e),c.focus()))})});c=function(){b.text(q.removeBtnLabel);b.attr("title",q.removeBtnTooltip)};this.params.is_new?d.bind("saved",c):c()},_getInputs:function(a){return e(a).find(":input[name]")},_getInputsSignature:function(a){return _(a).map(function(a){a=
e(a);return(a.is(":checkbox, :radio")?[a.attr("id"),a.attr("name"),a.prop("value")]:[a.attr("id"),a.attr("name")]).join(",")}).join(";")},_getInputState:function(a){a=e(a);return a.is(":radio, :checkbox")?a.prop("checked"):a.is("select[multiple]")?a.find("option:selected").map(function(){return e(this).val()}).get():a.val()},_setInputState:function(a,b){a=e(a);a.is(":radio, :checkbox")?a.prop("checked",b):a.is("select[multiple]")?(b=e.isArray(b)?_.map(b,function(a){return String(a)}):[],a.find("option").each(function(){e(this).prop("selected",
-1!==_.indexOf(b,String(this.value)))})):a.val(b)},getSidebarWidgetsControl:function(){var a;if(a=d.control("sidebars_widgets["+this.params.sidebar_id+"]"))return a},updateWidget:function(a){var b=this,c,f,k,g,l,h,m,p,r;a=e.extend({instance:null,complete:null,ignoreActiveElement:!1},a);c=a.instance;f=a.complete;l=this._updateCount+=1;k=this.container.find(".widget:first");g=k.find(".widget-content:first");g.find(".widget-error").remove();this.container.addClass("widget-form-loading");this.container.addClass("previewer-loading");
p=d.state("processing");p(p()+1);this.liveUpdateMode||this.container.addClass("widget-form-disabled");h={action:"update-widget",wp_customize:"on"};h.nonce=d.Widgets.data.nonce;h.theme=d.settings.theme.stylesheet;h.customized=n.customize.previewer.query().customized;h=e.param(h);m=this._getInputs(g);m.each(function(){e(this).data("state"+l,b._getInputState(this))});h=c?h+("&"+e.param({sanitized_widget_setting:JSON.stringify(c)})):h+("&"+m.serialize());h+="&"+g.find("~ :input").serialize();this._previousUpdateRequest&&
this._previousUpdateRequest.abort();this._previousUpdateRequest=c=e.post(n.ajax.settings.url,h);c.done(function(c){var h,p,n;h=!1;"0"===c?(d.previewer.preview.iframe.hide(),d.previewer.login().done(function(){b.updateWidget(a);d.previewer.preview.iframe.show()})):"-1"===c?d.previewer.cheatin():c.success?(p=e("<div>"+c.data.form+"</div>"),n=b._getInputs(p),(p=b._getInputsSignature(m)===b._getInputsSignature(n))&&!b.liveUpdateMode&&(b.liveUpdateMode=!0,b.container.removeClass("widget-form-disabled"),
b.container.find('input[name="savewidget"]').hide()),p&&b.liveUpdateMode?(m.each(function(c){var d=e(this),f=e(n[c]);c=d.data("state"+l);f=b._getInputState(f);d.data("sanitized",f);_.isEqual(c,f)||!a.ignoreActiveElement&&d.is(document.activeElement)||b._setInputState(d,f)}),e(document).trigger("widget-synced",[k,c.data.form])):b.liveUpdateMode?(b.liveUpdateMode=!1,b.container.find('input[name="savewidget"]').show(),h=!0):(g.html(c.data.form),b.container.removeClass("widget-form-disabled"),e(document).trigger("widget-updated",
[k])),(r=!h&&!_(b.setting()).isEqual(c.data.instance))?(b.isWidgetUpdating=!0,b.setting(c.data.instance),b.isWidgetUpdating=!1):b.container.removeClass("previewer-loading"),f&&f.call(b,null,{noChange:!r,ajaxFinished:!0})):(h=q.error,c.data&&c.data.message&&(h=c.data.message),f?f.call(b,h):g.prepend('<p class="widget-error"><strong>'+h+"</strong></p>"))});c.fail(function(a,c){f&&f.call(b,c)});c.always(function(){b.container.removeClass("widget-form-loading");m.each(function(){e(this).removeData("state"+
l)});p(p()-1)})},expandControlSection:function(){d.Control.prototype.expand.call(this)},_toggleExpanded:d.Section.prototype._toggleExpanded,expand:d.Section.prototype.expand,expandForm:function(){this.expand()},collapse:d.Section.prototype.collapse,collapseForm:function(){this.collapse()},toggleForm:function(a){"undefined"===typeof a&&(a=!this.expanded());this.expanded(a)},onChangeExpanded:function(a,b){var c=this,f,e,g,l;b.unchanged?a&&d.Control.prototype.expand.call(c,{completeCallback:b.completeCallback}):
(f=this.container.find("div.widget:first"),e=f.find(".widget-inside:first"),a?(c.section()&&d.section(c.section())&&c.expandControlSection(),d.control.each(function(a){c.params.type===a.params.type&&c!==a&&a.collapse()}),g=function(){c.container.removeClass("expanding");c.container.addClass("expanded");c.container.trigger("expanded")},b.completeCallback&&(l=g,g=function(){l();b.completeCallback()}),c.params.is_wide?e.fadeIn(b.duration,g):e.slideDown(b.duration,g),c.container.trigger("expand"),c.container.addClass("expanding")):
(g=function(){c.container.removeClass("collapsing");c.container.removeClass("expanded");c.container.trigger("collapsed")},b.completeCallback&&(l=g,g=function(){l();b.completeCallback()}),c.container.trigger("collapse"),c.container.addClass("collapsing"),c.params.is_wide?e.fadeOut(b.duration,g):e.slideUp(b.duration,function(){f.css({width:"",margin:""});g()})))},getWidgetSidebarPosition:function(){var a;a=this.getSidebarWidgetsControl().setting();a=_.indexOf(a,this.params.widget_id);if(-1!==a)return a},
moveUp:function(){this._moveWidgetByOne(-1)},moveDown:function(){this._moveWidgetByOne(1)},_moveWidgetByOne:function(a){var b,c,d,e;b=this.getWidgetSidebarPosition();c=this.getSidebarWidgetsControl().setting;d=Array.prototype.slice.call(c());e=d[b+a];d[b+a]=this.params.widget_id;d[b]=e;c(d)},toggleWidgetMoveArea:function(a){var b=this,c;c=this.container.find(".move-widget-area");"undefined"===typeof a&&(a=!c.hasClass("active"));a&&(c.find(".selected").removeClass("selected"),c.find("li").filter(function(){return e(this).data("id")===
b.params.sidebar_id}).addClass("selected"),this.container.find(".move-widget-btn").prop("disabled",!0));c.toggleClass("active",a)},highlightSectionAndControl:function(){var a;a=this.container.is(":hidden")?this.container.closest(".control-section"):this.container;e(".highlighted").removeClass("highlighted");a.addClass("highlighted");setTimeout(function(){a.removeClass("highlighted")},500)}});d.Widgets.SidebarSection=d.Section.extend({ready:function(){var a;d.Section.prototype.ready.call(this);a=d.Widgets.registeredSidebars.get(this.params.sidebarId);
this.active.bind(function(b){a.set("is_rendered",b)});a.set("is_rendered",this.active())}});d.Widgets.SidebarControl=d.Control.extend({ready:function(){this.$controlSection=this.container.closest(".control-section");this.$sectionContent=this.container.closest(".accordion-section-content");this._setupModel();this._setupSortable();this._setupAddition();this._applyCardinalOrderClassNames()},_setupModel:function(){var a=this;this.setting.bind(function(b,c){var f,k,g;k=_(c).difference(b);b=_(b).filter(function(a){a=
t(a);return!!d.Widgets.availableWidgets.findWhere({id_base:a.id_base})});f=_(b).map(function(b){var c=d.Widgets.getWidgetFormControlForWidget(b);c||(c=a.addWidget(b));return c});f.sort(function(a,c){var d=_.indexOf(b,a.params.widget_id),e=_.indexOf(b,c.params.widget_id);return d-e});g=0;_(f).each(function(b){b.priority(g);b.section(a.section());g+=1});a.priority(g);a._applyCardinalOrderClassNames();_(f).each(function(b){b.params.sidebar_id=a.params.sidebar_id});_(k).each(function(b){setTimeout(function(){var c,
f,g=!1;d.each(function(c){c.id!==a.setting.id&&0===c.id.indexOf("sidebars_widgets[")&&"sidebars_widgets[wp_inactive_widgets]"!==c.id&&(c=c(),-1!==_.indexOf(c,b)&&(g=!0))});g||(f=(c=d.Widgets.getWidgetFormControlForWidget(b))&&e.contains(document,c.container[0])&&!e.contains(a.$sectionContent[0],c.container[0]),c&&!f&&(d.control.remove(c.id),c.container.remove()),d.Widgets.savedWidgetIds[b]&&(c=d.value("sidebars_widgets[wp_inactive_widgets]")().slice(),c.push(b),d.value("sidebars_widgets[wp_inactive_widgets]")(_(c).unique())),
c=t(b).id_base,(c=d.Widgets.availableWidgets.findWhere({id_base:c}))&&!c.get("is_multi")&&c.set("is_disabled",!1))})})})},_setupSortable:function(){var a=this;this.isReordering=!1;this.$sectionContent.sortable({items:"> .customize-control-widget_form",handle:".widget-top",axis:"y",tolerance:"pointer",connectWith:".accordion-section-content:has(.customize-control-sidebar_widgets)",update:function(){var b=a.$sectionContent.sortable("toArray"),b=e.map(b,function(a){return e("#"+a).find(":input[name=widget-id]").val()});
a.setting(b)}});this.$controlSection.find(".accordion-section-title").droppable({accept:".customize-control-widget_form",over:function(){d.section(a.section.get()).expand({allowMultiple:!0,completeCallback:function(){d.section.each(function(a){a.container.find(".customize-control-sidebar_widgets").length&&a.container.find(".accordion-section-content:first").sortable("refreshPositions")})}})}});this.container.find(".reorder-toggle").on("click keydown",function(b){"keydown"===b.type&&13!==b.which&&
32!==b.which||a.toggleReordering(!a.isReordering)})},_setupAddition:function(){var a=this;this.container.find(".add-new-widget").on("click keydown",function(b){if("keydown"!==b.type||13===b.which||32===b.which)a.$sectionContent.hasClass("reordering")||(e("body").hasClass("adding-widget")?d.Widgets.availableWidgetsPanel.close():d.Widgets.availableWidgetsPanel.open(a))})},_applyCardinalOrderClassNames:function(){var a=[];_.each(this.setting(),function(b){(b=d.Widgets.getWidgetFormControlForWidget(b))&&
a.push(b)});a.length?(this.container.find(".reorder-toggle").show(),e(a).each(function(){e(this.container).removeClass("first-widget").removeClass("last-widget").find(".move-widget-down, .move-widget-up").prop("tabIndex",0)}),_.first(a).container.addClass("first-widget").find(".move-widget-up").prop("tabIndex",-1),_.last(a).container.addClass("last-widget").find(".move-widget-down").prop("tabIndex",-1)):this.container.find(".reorder-toggle").hide()},toggleReordering:function(a){a=Boolean(a);a!==this.$sectionContent.hasClass("reordering")&&
(this.isReordering=a,this.$sectionContent.toggleClass("reordering",a),a?(_(this.getWidgetFormControls()).each(function(a){a.collapse()}),this.$sectionContent.find(".first-widget .move-widget").focus(),this.$sectionContent.find(".add-new-widget").prop("tabIndex",-1)):this.$sectionContent.find(".add-new-widget").prop("tabIndex",0))},getWidgetFormControls:function(){var a=[];_(this.setting()).each(function(b){b=t(b);var c;c="widget_"+b.id_base;b.number&&(c+="["+b.number+"]");(b=d.control(c))&&a.push(b)});
return a},addWidget:function(a){var b=this,c,f=t(a),k=f.number,f=d.Widgets.availableWidgets.findWhere({id_base:f.id_base}),g,l,h,m;if(!f||k&&!f.get("is_multi"))return!1;f.get("is_multi")&&!k&&(f.set("multi_number",f.get("multi_number")+1),k=f.get("multi_number"));c=e.trim(e("#widget-tpl-"+f.get("id")).html());f.get("is_multi")?c=c.replace(/<[^<>]+>/g,function(a){return a.replace(/__i__|%i%/g,k)}):f.set("is_disabled",!0);c=e(c);c=e("<li/>").addClass("customize-control").addClass("customize-control-widget_form").append(c);
c.find("> .widget-icon").remove();f.get("is_multi")&&(c.find('input[name="widget_number"]').val(k),c.find('input[name="multi_number"]').val(k));a=c.find('[name="widget-id"]').val();c.hide();g="widget_"+f.get("id_base");f.get("is_multi")&&(g+="["+k+"]");c.attr("id","customize-control-"+g.replace(/\]/g,"").replace(/\[/g,"-"));l=d.has(g);l||(m={transport:"refresh",previewer:this.setting.previewer},m=d.create(g,g,"",m),m.set({}));h=new d.controlConstructor.widget_form(g,{params:{settings:{"default":g},
content:c,sidebar_id:b.params.sidebar_id,widget_id:a,widget_id_base:f.get("id_base"),type:"widget_form",is_new:!l,width:f.get("width"),height:f.get("height"),is_wide:f.get("is_wide")},previewer:b.setting.previewer});d.control.add(g,h);d.each(function(c){if(c.id!==b.setting.id&&0===c.id.indexOf("sidebars_widgets[")){var d=c().slice(),e=_.indexOf(d,a);-1!==e&&(d.splice(e),c(d))}});f=this.setting().slice();-1===_.indexOf(f,a)&&(f.push(a),this.setting(f));c.slideDown(function(){l&&h.updateWidget({instance:h.setting()})});
return h}});e.extend(d.sectionConstructor,{sidebar:d.Widgets.SidebarSection});e.extend(d.controlConstructor,{widget_form:d.Widgets.WidgetControl,sidebar_widgets:d.Widgets.SidebarControl});d.bind("nonce-refresh",function(a){d.Widgets.data.nonce=a["update-widget"]});d.bind("ready",function(){d.Widgets.availableWidgetsPanel=new d.Widgets.AvailableWidgetsPanelView({collection:d.Widgets.availableWidgets});d.previewer.bind("highlight-widget-control",d.Widgets.highlightWidgetFormControl);d.previewer.bind("focus-widget-control",
d.Widgets.focusWidgetFormControl)});d.Widgets.highlightWidgetFormControl=function(a){(a=d.Widgets.getWidgetFormControlForWidget(a))&&a.highlightSectionAndControl()};d.Widgets.focusWidgetFormControl=function(a){(a=d.Widgets.getWidgetFormControlForWidget(a))&&a.focus()};d.Widgets.getSidebarWidgetControlContainingWidget=function(a){var b=null;d.control.each(function(c){"sidebar_widgets"===c.params.type&&-1!==_.indexOf(c.setting(),a)&&(b=c)});return b};d.Widgets.getWidgetFormControlForWidget=function(a){var b=
null;d.control.each(function(c){"widget_form"===c.params.type&&c.params.widget_id===a&&(b=c)});return b}}})(window.wp,jQuery);
