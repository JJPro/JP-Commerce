(function(e,b,ca){var F=b(e),u=b(document),T=b("#wpadminbar"),aa=b("#wpfooter");b(function(){function W(b){var d=jQuery.ui.keyCode;b=b.keyCode;var g=document.createRange(),h=p[0].selectionStart,c=p[0].selectionEnd,l=K[0].firstChild;if(!h||!c||h===c){try{g.setStart(l,h),g.setEnd(l,c+1)}catch(n){}h=g.getBoundingClientRect();h.height&&(g=h.top-10,h=g+h.height+10,c=a.adminBarHeight+a.toolsHeight+a.textTopHeight,l=a.windowHeight-a.bottomHeight,g<c&&(b===d.UP||b===d.LEFT||b===d.BACKSPACE)?e.scrollTo(e.pageXOffset,
g+e.pageYOffset-c):h>l&&e.scrollTo(e.pageXOffset,h+e.pageYOffset-l))}}function I(){if(!(f&&!f.isHidden()||!f&&"tinymce"===J)){var a=p.height(),d;K.width(p.width()-22);K.text(p.val()+"&nbsp;");d=K.height();300>d&&(d=300);d!==a&&(p.height(d),k())}}function k(b){if(!N||!N.settings.visible){var d=F.scrollTop(),g=b&&b.type,h="scroll"!==g,c=f&&!f.isHidden(),l=Z.offset().top,n=x.width(),t,v,k,ba;if(h||!a.windowHeight)k=F.width(),a={windowHeight:F.height(),windowWidth:k,adminBarHeight:600<k?T.outerHeight():
0,toolsHeight:O.outerHeight()||0,menuBarHeight:y.outerHeight()||0,visualTopHeight:P.outerHeight()||0,textTopHeight:U.outerHeight()||0,bottomHeight:q.outerHeight()||0,statusBarHeight:z.outerHeight()||0,sideSortablesHeight:m.height()||0},3>a.menuBarHeight&&(a.menuBarHeight=0);c||"resize"!==g||I();c?(g=P,t=Q,v=a.visualTopHeight):(g=U,t=p,v=a.textTopHeight);if(c||g.length){k=g.parent().offset().top;ba=t.offset().top;t=t.outerHeight();if(v=t>(c?300+v:320)+5){if((!B||h)&&d>=k-a.toolsHeight-a.adminBarHeight&&
d<=k-a.toolsHeight-a.adminBarHeight+t-300)B=!0,O.css({position:"fixed",top:a.adminBarHeight,width:n}),c&&y.length&&y.css({position:"fixed",top:a.adminBarHeight+a.toolsHeight,width:n-2-(c?0:g.outerWidth()-g.width())}),g.css({position:"fixed",top:a.adminBarHeight+a.toolsHeight+a.menuBarHeight,width:n-2-(c?0:g.outerWidth()-g.width())});else if(B||h)d<=k-a.toolsHeight-a.adminBarHeight?(B=!1,O.css({position:"absolute",top:0,width:n}),c&&y.length&&y.css({position:"absolute",top:0,width:n-2}),g.css({position:"absolute",
top:a.menuBarHeight,width:n-2-(c?0:g.outerWidth()-g.width())})):d>=k-a.toolsHeight-a.adminBarHeight+t-300&&(B=!1,O.css({position:"absolute",top:t-300,width:n}),c&&y.length&&y.css({position:"absolute",top:t-300,width:n-2}),g.css({position:"absolute",top:t-300+a.menuBarHeight,width:n-2-(c?0:g.outerWidth()-g.width())}));if((!C||h&&D)&&d+a.windowHeight<=ba+t+a.bottomHeight+a.statusBarHeight+1)b&&0<b.deltaHeight&&100>b.deltaHeight?e.scrollBy(0,b.deltaHeight):D&&(C=!0,z.css({position:"fixed",bottom:a.bottomHeight,
visibility:"",width:n-2}),q.css({position:"fixed",bottom:0,width:n}));else if(!D&&C||(C||h)&&d+a.windowHeight>ba+t+a.bottomHeight+a.statusBarHeight-1)C=!1,z.attr("style",D?"":"visibility: hidden;"),q.attr("style","")}else h&&(O.css({position:"absolute",top:0,width:n}),c&&y.length&&y.css({position:"absolute",top:0,width:n-2}),g.css({position:"absolute",top:a.menuBarHeight,width:n-2-(c?0:g.outerWidth()-g.width())}),z.attr("style",D?"":"visibility: hidden;"),q.attr("style",""));300>R.width()&&600<a.windowWidth&&
u.height()>m.height()+l+120&&a.windowHeight<t?(a.sideSortablesHeight+56+20>a.windowHeight||A||w?d+56<=l?(m.attr("style",""),A=w=!1):d>G?A?(A=!1,b=m.offset().top-a.adminBarHeight,l=aa.offset().top,l<b+a.sideSortablesHeight+20&&(b=l-a.sideSortablesHeight-12),m.css({position:"absolute",top:b,bottom:""})):!w&&a.sideSortablesHeight+m.offset().top+20<d+a.windowHeight&&(w=!0,m.css({position:"fixed",top:"auto",bottom:20})):d<G&&(w?(w=!1,b=m.offset().top-20,l=aa.offset().top,l<b+a.sideSortablesHeight+20&&
(b=l-a.sideSortablesHeight-12),m.css({position:"absolute",top:b,bottom:""})):!A&&m.offset().top>=d+56&&(A=!0,m.css({position:"fixed",top:56,bottom:""}))):(d>=l-56?m.css({position:"fixed",top:56}):m.attr("style",""),A=w=!1),G=d):(m.attr("style",""),A=w=!1);h&&(x.css({paddingTop:a.toolsHeight}),c?Q.css({paddingTop:a.visualTopHeight+a.menuBarHeight}):(p.css({marginTop:a.textTopHeight}),K.width(n-20-2)))}}}function Y(){I();k()}function V(b){for(var a=1;6>a;a++)setTimeout(b,500*a)}function S(){e.pageYOffset&&
130<e.pageYOffset&&e.scrollTo(e.pageXOffset,0);H.addClass("wp-editor-expand");F.on("scroll.editor-expand resize.editor-expand",function(b){k(b.type);clearTimeout(r);r=setTimeout(k,100)});u.on("wp-collapse-menu.editor-expand postboxes-columnchange.editor-expand editor-classchange.editor-expand",k).on("postbox-toggled.editor-expand",function(){!A&&!w&&56<e.pageYOffset&&(w=!0,e.scrollBy(0,-1),k(),e.scrollBy(0,1));k()}).on("wp-window-resized.editor-expand",function(){f&&!f.isHidden()?f.execCommand("wpAutoResize"):
I()});p.on("focus.editor-expand input.editor-expand propertychange.editor-expand",I);p.on("keyup.editor-expand",W);E();N&&N.pubsub.subscribe("hidden",Y);f&&(f.settings.wp_autoresize_on=!0,f.execCommand("wpAutoResizeOn"),f.isHidden()||f.execCommand("wpAutoResize"));f&&!f.isHidden()||I();k();u.trigger("editor-expand-on")}function L(){var a=parseInt(e.getUserSetting("ed_size",300),10);50>a?a=50:5E3<a&&(a=5E3);e.pageYOffset&&130<e.pageYOffset&&e.scrollTo(e.pageXOffset,0);H.removeClass("wp-editor-expand");
F.off(".editor-expand");u.off(".editor-expand");p.off(".editor-expand");M();N&&N.pubsub.unsubscribe("hidden",Y);b.each([P,U,O,y,q,z,x,Q,p,m],function(a,b){b&&b.attr("style","")});B=C=A=w=!1;f&&(f.settings.wp_autoresize_on=!1,f.execCommand("wpAutoResizeOff"),f.isHidden()||(p.hide(),a&&f.theme.resizeTo(null,a)));a&&p.height(a);u.trigger("editor-expand-off")}var H=b("#postdivrich"),x=b("#wp-content-wrap"),O=b("#wp-content-editor-tools"),P=b(),Q=b(),U=b("#ed_toolbar"),p=b("#content"),K=b('<div id="content-textarea-clone" class="wp-exclude-emoji"></div>'),
q=b("#post-status-info"),y=b(),z=b(),m=b("#side-sortables"),R=b("#postbox-container-1"),Z=b("#post-body"),N=e.wp.editor&&e.wp.editor.fullscreen,f,E=function(){},M=function(){},B=!1,C=!1,A=!1,w=!1,r,G=0,J=x.hasClass("tmce-active")?"tinymce":"html",D=!!parseInt(e.getUserSetting("hidetb"),10),a={windowHeight:0,windowWidth:0,adminBarHeight:0,toolsHeight:0,menuBarHeight:0,visualTopHeight:0,textTopHeight:0,bottomHeight:0,statusBarHeight:0,sideSortablesHeight:0};K.insertAfter(p);K.css({"font-family":p.css("font-family"),
"font-size":p.css("font-size"),"line-height":p.css("line-height"),"white-space":"pre-wrap","word-wrap":"break-word"});u.on("tinymce-editor-init.editor-expand",function(p,d){function g(a){a=a.keyCode;47>=a&&a!==v.SPACEBAR&&a!==v.ENTER&&a!==v.DELETE&&a!==v.BACKSPACE&&a!==v.UP&&a!==v.LEFT&&a!==v.DOWN&&a!==v.UP||91<=a&&93>=a||112<=a&&123>=a||144===a||145===a||h(a)}function h(b){var c;c=d.selection.getNode();var l,h;if(d.wp&&d.wp.getView&&(l=d.wp.getView(c)))h=l.getBoundingClientRect();else{l=d.selection.getRng();
try{h=l.getClientRects()[0]}catch(g){}h||(h=c.getBoundingClientRect())}c=h.height?h:!1;var n,f;c&&(h=c.top+d.iframeElement.getBoundingClientRect().top,l=h+c.height,h-=50,l+=50,n=a.adminBarHeight+a.toolsHeight+a.menuBarHeight+a.visualTopHeight,f=a.windowHeight-(D?a.bottomHeight+a.statusBarHeight:0),f-n<c.height||(h<n&&(b===v.UP||b===v.LEFT||b===v.BACKSPACE)?e.scrollTo(e.pageXOffset,h+e.pageYOffset-n):l>f&&e.scrollTo(e.pageXOffset,l+e.pageYOffset-f)))}function c(a){a.state||k()}function l(){F.on("scroll.mce-float-panels",
m);setTimeout(function(){d.execCommand("wpAutoResize");k()},300)}function n(){F.off("scroll.mce-float-panels");setTimeout(function(){var b=x.offset().top;e.pageYOffset>b&&e.scrollTo(e.pageXOffset,b-a.adminBarHeight);I();k()},100);k()}function t(){D=!D}var v=e.tinymce.util.VK,m=_.debounce(function(){!b(".mce-floatpanel:hover").length&&e.tinymce.ui.FloatPanel.hideAll();b(".mce-tooltip").hide()},1E3,!0);"content"===d.id&&(f=d,d.settings.autoresize_min_height=300,P=x.find(".mce-toolbar-grp"),Q=x.find(".mce-edit-area"),
z=x.find(".mce-statusbar"),y=x.find(".mce-menubar"),E=function(){d.on("keyup",g);d.on("show",l);d.on("hide",n);d.on("wp-toolbar-toggle",t);d.on("setcontent wp-autoresize wp-toolbar-toggle",k);d.on("undo redo",h);d.on("FullscreenStateChanged",c);F.off("scroll.mce-float-panels").on("scroll.mce-float-panels",m)},M=function(){d.off("keyup",g);d.off("show",l);d.off("hide",n);d.off("wp-toolbar-toggle",t);d.off("setcontent wp-autoresize wp-toolbar-toggle",k);d.off("undo redo",h);d.off("FullscreenStateChanged",
c);F.off("scroll.mce-float-panels")},H.hasClass("wp-editor-expand")&&(E(),V(k)))});H.hasClass("wp-editor-expand")&&(S(),x.hasClass("html-active")&&V(function(){k();I()}));b("#adv-settings .editor-expand").show();b("#editor-expand-toggle").on("change.editor-expand",function(){b(this).prop("checked")?(S(),e.setUserSetting("editor_expand","on")):(L(),e.setUserSetting("editor_expand","off"))});e.editorExpand={on:S,off:L}});b(function(){function W(){r=q.offset();r.right=r.left+q.outerWidth();r.bottom=
r.top+q.outerHeight()}function I(){f||(f=!0,u.trigger("dfw-activate"),z.on("keydown.focus-shortcut",U))}function k(){f&&(V(),f=!1,u.trigger("dfw-deactivate"),z.off("keydown.focus-shortcut"))}function Y(){!E&&f&&(E=!0,z.on("keydown.focus",L),y.add(z).on("blur.focus",x),L(),e.setUserSetting("post_dfw","on"),u.trigger("dfw-on"))}function V(){E&&(E=!1,y.add(z).off(".focus"),H(),q.off(".focus"),e.setUserSetting("post_dfw","off"),u.trigger("dfw-off"))}function S(){E?V():Y()}function L(b){var c=b&&b.keyCode;
27===c||87===c&&b.altKey&&b.shiftKey?H(b):b&&(b.metaKey||b.ctrlKey&&!b.altKey||b.altKey&&b.shiftKey||c&&(47>=c&&8!==c&&13!==c&&32!==c&&46!==c||91<=c&&93>=c||112<=c&&135>=c||144<=c&&150>=c||224<=c))||(C||(C=!0,clearTimeout(d),d=setTimeout(function(){m.show()},600),q.css("z-index",9998),m.on("mouseenter.focus",function(){W();F.on("scroll.focus",function(){var b=e.pageYOffset;a&&D&&a!==b&&(D<r.top-20||D>r.bottom+20)&&H();a=b})}).on("mouseleave.focus",function(){G=J=null;M=B=0;F.off("scroll.focus")}).on("mousemove.focus",
function(a){var b=a.clientX;a=a.clientY;var c=e.pageYOffset,d=e.pageXOffset;if(G&&J&&(b!==G||a!==J))if(a<=J&&a<r.top-c||a>=J&&a>r.bottom-c||b<=G&&b<r.left-d||b>=G&&b>r.right-d){if(M+=Math.abs(G-b),B+=Math.abs(J-a),(a<=r.top-20-c||a>=r.bottom+20-c||b<=r.left-20-d||b>=r.right+20-d)&&(10<M||10<B)){H();G=J=null;M=B=0;return}}else M=B=0;G=b;J=a}).on("touchstart.focus",function(a){a.preventDefault();H()}),q.off("mouseenter.focus"),X&&(clearTimeout(X),X=null),p.addClass("focus-on").removeClass("focus-off")),
O(),P())}function H(a){if(C){C=!1;clearTimeout(d);d=setTimeout(function(){m.hide()},200);q.css("z-index","");m.off("mouseenter.focus mouseleave.focus mousemove.focus touchstart.focus");if("undefined"===typeof a)q.on("mouseenter.focus",function(){(b.contains(q.get(0),document.activeElement)||g)&&L()});X=setTimeout(function(){X=null;q.off("mouseenter.focus")},1E3);p.addClass("focus-off").removeClass("focus-on")}A&&(A=!1,T.off(".focus"));Q()}function x(){setTimeout(function(){var a=document.activeElement.compareDocumentPosition(q.get(0));
2!==a&&4!==a||!(b.contains(N.get(0),document.activeElement)||b.contains(K.get(0),document.activeElement)||b.contains(aa.get(0),document.activeElement))||H()},0)}function O(){!A&&C&&(A=!0,T.on("mouseenter.focus",function(){T.addClass("focus-off")}).on("mouseleave.focus",function(){T.removeClass("focus-off")}))}function P(){w||!C||R.find(":focus").length||(w=!0,R.stop().fadeTo("fast",.3).on("mouseenter.focus",Q).off("mouseleave.focus"),Z.on("focus.focus",Q).off("blur.focus"))}function Q(){w&&(w=!1,
R.stop().fadeTo("fast",1).on("mouseleave.focus",P).off("mouseenter.focus"),Z.on("blur.focus",P).off("focus.focus"))}function U(a){a.altKey&&a.shiftKey&&87===a.keyCode&&S()}var p=b(document.body),K=b("#wpcontent"),q=b("#post-body-content"),y=b("#title"),z=b("#content"),m=b(document.createElement("DIV")),R=b("#edit-slug-box"),Z=R.find("a").add(R.find("button")).add(R.find("input")),N=b("#adminmenuwrap");b();b();var f="on"===e.getUserSetting("editor_expand","on"),E=f?"on"===e.getUserSetting("post_dfw"):
!1,M=0,B=0,C,A,w,r,G,J,D,a,X,d,g;p.append(m);m.css({display:"none",position:"fixed",top:T.height(),right:0,bottom:0,left:0,"z-index":9997});q.css({position:"relative"});F.on("mousemove.focus",function(a){D=a.pageY});if(b("#postdivrich").hasClass("wp-editor-expand"))z.on("keydown.focus-shortcut",U);u.on("tinymce-editor-setup.focus",function(a,b){b.addButton("dfw",{active:E,classes:"wp-dfw btn widget",disabled:!f,onclick:S,onPostRender:function(){var a=this;u.on("dfw-activate.focus",function(){a.disabled(!1)}).on("dfw-deactivate.focus",
function(){a.disabled(!0)}).on("dfw-on.focus",function(){a.active(!0)}).on("dfw-off.focus",function(){a.active(!1)})},tooltip:"Distraction-free writing mode",shortcut:"Alt+Shift+W"});b.addCommand("wpToggleDFW",S);b.addShortcut("alt+shift+w","","wpToggleDFW")});u.on("tinymce-editor-init.focus",function(a,c){function d(){g=!0}function e(){g=!1}var f,k;"content"===c.id&&(b(c.getWin()),b(c.getContentAreaContainer()).find("iframe"),f=function(){c.on("keydown",L);c.on("blur",x);c.on("focus",d);c.on("blur",
e);c.on("wp-autoresize",W)},k=function(){c.off("keydown",L);c.off("blur",x);c.off("focus",d);c.off("blur",e);c.off("wp-autoresize",W)},E&&f(),u.on("dfw-on.focus",f).on("dfw-off.focus",k),c.on("click",function(a){a.target===c.getDoc().documentElement&&c.focus()}))});u.on("quicktags-init",function(a,c){var d;c.settings.buttons&&-1!==(","+c.settings.buttons+",").indexOf(",dfw,")&&(d=b("#"+c.name+"_dfw"),b(document).on("dfw-activate",function(){d.prop("disabled",!1)}).on("dfw-deactivate",function(){d.prop("disabled",
!0)}).on("dfw-on",function(){d.addClass("active")}).on("dfw-off",function(){d.removeClass("active")}))});u.on("editor-expand-on.focus",I).on("editor-expand-off.focus",k);E&&(z.on("keydown.focus",L),y.add(z).on("blur.focus",x));e.wp=e.wp||{};e.wp.editor=e.wp.editor||{};e.wp.editor.dfw={activate:I,deactivate:k,isActive:function(){return f},on:Y,off:V,toggle:S,isOn:function(){return E}}})})(window,window.jQuery);
