(function(c,k,g){function n(a){a=a||"";a=g("<div>").text(a).html();return(a=g.trim(a))||c.Menus.data.l10n.unnamed}wpNavMenu.originalInit=wpNavMenu.init;wpNavMenu.options.menuItemDepthPerLevel=20;wpNavMenu.options.sortableItems="> .customize-control-nav_menu_item";wpNavMenu.options.targetTolerance=10;wpNavMenu.init=function(){this.jQueryExtensions()};c.Menus=c.Menus||{};c.Menus.data={nonce:"",itemTypes:[],l10n:{},menuItemTransport:"postMessage",phpIntMax:0,defaultSettingValues:{nav_menu:{},nav_menu_item:{}}};
"undefined"!==typeof _wpCustomizeNavMenusSettings&&g.extend(c.Menus.data,_wpCustomizeNavMenusSettings);c.Menus.generatePlaceholderAutoIncrementId=function(){return-Math.ceil(c.Menus.data.phpIntMax*Math.random())};c.Menus.AvailableItemModel=Backbone.Model.extend(g.extend({id:null},c.Menus.data.defaultSettingValues.nav_menu_item));c.Menus.AvailableItemCollection=Backbone.Collection.extend({model:c.Menus.AvailableItemModel,sort_key:"order",comparator:function(a){return-a.get(this.sort_key)},sortByField:function(a){this.sort_key=
a;this.sort()}});c.Menus.availableMenuItems=new c.Menus.AvailableItemCollection(c.Menus.data.availableMenuItems);c.Menus.AvailableMenuItemsPanelView=k.Backbone.View.extend({el:"#available-menu-items",events:{"input #menu-items-search":"debounceSearch","keyup #menu-items-search":"debounceSearch","focus .menu-item-tpl":"focus","click .menu-item-tpl":"_submit","click #custom-menu-item-submit":"_submitLink","keypress #custom-menu-item-name":"_submitLink",keydown:"keyboardAccessible"},selected:null,currentMenuControl:null,
debounceSearch:null,$search:null,searchTerm:"",rendered:!1,pages:{},sectionContent:"",loading:!1,initialize:function(){var a=this;c.panel.has("nav_menus")&&(this.$search=g("#menu-items-search"),this.sectionContent=this.$el.find(".accordion-section-content"),this.debounceSearch=_.debounce(a.search,500),_.bindAll(this,"close"),g("#customize-controls, .customize-section-back").on("click keydown",function(b){var d=g(b.target).is(".item-delete, .item-delete *");b=g(b.target).is(".add-new-menu-item, .add-new-menu-item *");
!g("body").hasClass("adding-menu-items")||d||b||a.close()}),g(".clear-results").on("click keydown",function(b){if("keydown"!==b.type||13===b.which||32===b.which)b.preventDefault(),g("#menu-items-search").val("").focus(),b.target.value="",a.search(b)}),this.$el.on("input","#custom-menu-item-name.invalid, #custom-menu-item-url.invalid",function(){g(this).removeClass("invalid")}),c.panel("nav_menus").container.bind("expanded",function(){a.rendered||(a.initList(),a.rendered=!0)}),this.sectionContent.scroll(function(){var b=
a.$el.find(".accordion-section.open .accordion-section-content").prop("scrollHeight"),d=a.$el.find(".accordion-section.open").height();!a.loading&&g(this).scrollTop()>.75*b-d&&(b=g(this).data("type"),d=g(this).data("object"),"search"===b?a.searchTerm&&a.doSearch(a.pages.search):a.loadItems(b,d))}),c.previewer.bind("url",this.close))},search:function(a){var b=g("#available-menu-items-search"),d=g("#available-menu-items .accordion-section").not(b);a&&this.searchTerm!==a.target.value&&(""===a.target.value||
b.hasClass("open")?""===a.target.value&&(b.removeClass("open"),d.show(),b.find(".clear-results").prop("tabIndex",-1).removeClass("is-visible")):(d.fadeOut(100),b.find(".accordion-section-content").slideDown("fast"),b.addClass("open"),b.find(".clear-results").prop("tabIndex",0).addClass("is-visible")),this.searchTerm=a.target.value,this.pages.search=1,this.doSearch(1))},doSearch:function(a){var b=this,d,e=g("#available-menu-items-search"),f=e.find(".accordion-section-content"),h=k.template("available-menu-item");
b.currentRequest&&b.currentRequest.abort();if(!(0>a)){if(1<a)e.addClass("loading-more"),f.attr("aria-busy","true"),k.a11y.speak(c.Menus.data.l10n.itemsLoadingMore);else if(""===b.searchTerm){f.html("");k.a11y.speak("");return}e.addClass("loading");b.loading=!0;d={"customize-menus-nonce":c.Menus.data.nonce,wp_customize:"on",search:b.searchTerm,page:a};b.currentRequest=k.ajax.post("search-available-menu-items-customizer",d);b.currentRequest.done(function(d){1===a&&f.empty();e.removeClass("loading loading-more");
f.attr("aria-busy","false");e.addClass("open");b.loading=!1;d=new c.Menus.AvailableItemCollection(d.items);b.collection.add(d.models);d.each(function(a){f.append(h(a.attributes))});b.pages.search=20>d.length?-1:b.pages.search+1;d&&1<a?k.a11y.speak(c.Menus.data.l10n.itemsFoundMore.replace("%d",d.length)):d&&1===a&&k.a11y.speak(c.Menus.data.l10n.itemsFound.replace("%d",d.length))});b.currentRequest.fail(function(a){a.message&&(f.empty().append(g('<p class="nothing-found"></p>').text(a.message)),k.a11y.speak(a.message));
b.pages.search=-1});b.currentRequest.always(function(){e.removeClass("loading loading-more");f.attr("aria-busy","false");b.loading=!1;b.currentRequest=null})}},initList:function(){var a=this;_.each(c.Menus.data.itemTypes,function(b){a.pages[b.type+":"+b.object]=0;a.loadItems(b.type,b.object)})},loadItems:function(a,b){var d=this,e,f,h;f=k.template("available-menu-item");-1!==d.pages[a+":"+b]&&(h=g("#available-menu-items-"+a+"-"+b),h.find(".accordion-section-title").addClass("loading"),d.loading=!0,
e={"customize-menus-nonce":c.Menus.data.nonce,wp_customize:"on",type:a,object:b,page:d.pages[a+":"+b]},e=k.ajax.post("load-available-menu-items-customizer",e),e.done(function(e){var g;e=e.items;0===e.length?(0===d.pages[a+":"+b]&&h.addClass("cannot-expand").removeClass("loading").find(".accordion-section-title > button").prop("tabIndex",-1),d.pages[a+":"+b]=-1):(e=new c.Menus.AvailableItemCollection(e),d.collection.add(e.models),g=h.find(".accordion-section-content"),e.each(function(a){g.append(f(a.attributes))}),
d.pages[a+":"+b]+=1)}),e.fail(function(a){"undefined"!==typeof console&&console.error&&console.error(a)}),e.always(function(){h.find(".accordion-section-title").removeClass("loading");d.loading=!1}))},itemSectionHeight:function(){var a,b;b=window.innerHeight;a=this.$el.find(".accordion-section:not( #available-menu-items-search ) .accordion-section-content");b-=46*(2+a.length)-13;120<b&&290>b&&a.css("max-height",b)},select:function(a){this.selected=g(a);this.selected.siblings(".menu-item-tpl").removeClass("selected");
this.selected.addClass("selected")},focus:function(a){this.select(g(a.currentTarget))},_submit:function(a){"keypress"===a.type&&13!==a.which&&32!==a.which||this.submit(g(a.currentTarget))},submit:function(a){var b;a||(a=this.selected);a&&this.currentMenuControl&&(this.select(a),b=g(this.selected).data("menu-item-id"),b=this.collection.findWhere({id:b}))&&(this.currentMenuControl.addItemToMenu(b.attributes),g(a).find(".menu-item-handle").addClass("item-added"))},_submitLink:function(a){"keypress"===
a.type&&13!==a.which||this.submitLink()},submitLink:function(){var a,b=g("#custom-menu-item-name"),d=g("#custom-menu-item-url");this.currentMenuControl&&(""===b.val()?b.addClass("invalid"):""===d.val()||"http://"===d.val()?d.addClass("invalid"):(a={title:b.val(),url:d.val(),type:"custom",type_label:c.Menus.data.l10n.custom_label,object:""},this.currentMenuControl.addItemToMenu(a),d.val("http://"),b.val("")))},open:function(a){this.currentMenuControl=a;this.itemSectionHeight();g("body").addClass("adding-menu-items");
_(this.currentMenuControl.getMenuItemControls()).each(function(a){a.collapseForm()});this.$el.find(".selected").removeClass("selected");this.$search.focus()},close:function(a){a=a||{};a.returnFocus&&this.currentMenuControl&&this.currentMenuControl.container.find(".add-new-menu-item").focus();this.selected=this.currentMenuControl=null;g("body").removeClass("adding-menu-items");g("#available-menu-items .menu-item-handle.item-added").removeClass("item-added");this.$search.val("")},keyboardAccessible:function(a){var b=
13===a.which,d=27===a.which,c=9===a.which&&a.shiftKey,f=g(a.target).is(this.$search);if(!b||this.$search.val())f&&c?(this.currentMenuControl.container.find(".add-new-menu-item").focus(),a.preventDefault()):d&&this.close({returnFocus:!0})}});c.Menus.MenusPanel=c.Panel.extend({attachEvents:function(){c.Panel.prototype.attachEvents.call(this);var a=this.container.find(".panel-meta"),b=a.find(".customize-help-toggle"),d=a.find(".customize-panel-description"),e=g("#screen-options-wrap"),f=a.find(".customize-screen-options-toggle");
f.on("click keydown",function(h){if(!c.utils.isKeydownButNotEnterEvent(h))return h.preventDefault(),d.not(":hidden")&&(d.slideUp("fast"),b.attr("aria-expanded","false")),"true"===f.attr("aria-expanded")?(f.attr("aria-expanded","false"),a.removeClass("open"),a.removeClass("active-menu-screen-options"),e.slideUp("fast")):(f.attr("aria-expanded","true"),a.addClass("open"),a.addClass("active-menu-screen-options"),e.slideDown("fast")),!1});b.on("click keydown",function(h){c.utils.isKeydownButNotEnterEvent(h)||
(h.preventDefault(),"true"===f.attr("aria-expanded")&&(f.attr("aria-expanded","false"),b.attr("aria-expanded","true"),a.addClass("open"),a.removeClass("active-menu-screen-options"),e.slideUp("fast"),d.slideDown("fast")))})},ready:function(){var a=this;this.container.find(".hide-column-tog").click(function(){var b=g(this),d=b.val();b.prop("checked")?a.checked(d):a.unchecked(d);a.saveManageColumnsState()});this.container.find(".hide-column-tog").each(function(){var b=g(this),d=b.val();b.prop("checked")?
a.checked(d):a.unchecked(d)})},saveManageColumnsState:function(){var a=this.hidden();g.post(k.ajax.settings.url,{action:"hidden-columns",hidden:a,screenoptionnonce:g("#screenoptionnonce").val(),page:"nav-menus"})},checked:function(a){this.container.addClass("field-"+a+"-active")},unchecked:function(a){this.container.removeClass("field-"+a+"-active")},hidden:function(){this.hidden=function(){return g(".hide-column-tog").not(":checked").map(function(){var a=this.id;return a.substring(a,a.length-5)}).get().join(",")}}});
c.Menus.MenuSection=c.Section.extend({initialize:function(a,b){c.Section.prototype.initialize.call(this,a,b);this.deferred.initSortables=g.Deferred()},ready:function(){var a=this;if("undefined"===typeof a.params.menu_id)throw Error("params.menu_id was not defined");a.active.validate=function(){return c.has(a.id)?!!c(a.id).get():!1};a.populateControls();a.navMenuLocationSettings={};a.assignedLocations=new c.Value([]);c.each(function(b,d){var c=d.match(/^nav_menu_locations\[(.+?)]/);c&&(a.navMenuLocationSettings[c[1]]=
b,b.bind(function(){a.refreshAssignedLocations()}))});a.assignedLocations.bind(function(b){a.updateAssignedLocationsInSectionTitle(b)});a.refreshAssignedLocations();c.bind("pane-contents-reflowed",function(){a.container.parent().length&&(a.container.find(".menu-item .menu-item-reorder-nav button").attr({tabindex:"0","aria-hidden":"false"}),a.container.find(".menu-item.move-up-disabled .menus-move-up").attr({tabindex:"-1","aria-hidden":"true"}),a.container.find(".menu-item.move-down-disabled .menus-move-down").attr({tabindex:"-1",
"aria-hidden":"true"}),a.container.find(".menu-item.move-left-disabled .menus-move-left").attr({tabindex:"-1","aria-hidden":"true"}),a.container.find(".menu-item.move-right-disabled .menus-move-right").attr({tabindex:"-1","aria-hidden":"true"}))})},populateControls:function(){var a,b;a=this.id+"[name]";b=c.control(a);b||(b=new c.controlConstructor.nav_menu_name(a,{params:{type:"nav_menu_name",content:'<li id="customize-control-'+this.id.replace("[","-").replace("]","")+'-name" class="customize-control customize-control-nav_menu_name"></li>',
label:c.Menus.data.l10n.menuNameLabel,active:!0,section:this.id,priority:0,settings:{"default":this.id}}}),c.control.add(b.id,b),b.active.set(!0));a=c.control(this.id);a||(a=new c.controlConstructor.nav_menu(this.id,{params:{type:"nav_menu",content:'<li id="customize-control-'+this.id.replace("[","-").replace("]","")+'" class="customize-control customize-control-nav_menu"></li>',section:this.id,priority:998,active:!0,settings:{"default":this.id},menu_id:this.params.menu_id}}),c.control.add(a.id,a),
a.active.set(!0));a=this.id+"[auto_add]";b=c.control(a);b||(b=new c.controlConstructor.nav_menu_auto_add(a,{params:{type:"nav_menu_auto_add",content:'<li id="customize-control-'+this.id.replace("[","-").replace("]","")+'-auto-add" class="customize-control customize-control-nav_menu_auto_add"></li>',label:"",active:!0,section:this.id,priority:999,settings:{"default":this.id}}}),c.control.add(b.id,b),b.active.set(!0))},refreshAssignedLocations:function(){var a=this.params.menu_id,b=[];_.each(this.navMenuLocationSettings,
function(d,c){d()===a&&b.push(c)});this.assignedLocations.set(b)},updateAssignedLocationsInSectionTitle:function(a){var b;b=this.container.find(".accordion-section-title:first");b.find(".menu-in-location").remove();_.each(a,function(a){var e=g('<span class="menu-in-location"></span>');e.text(c.Menus.data.l10n.menuLocation.replace("%s",a));b.append(e)});this.container.toggleClass("assigned-to-menu-location",0!==a.length)},onChangeExpanded:function(a,b){a&&(wpNavMenu.menuList=this.container.find(".accordion-section-content:first"),
wpNavMenu.targetList=wpNavMenu.menuList,g("#menu-to-edit").removeAttr("id"),wpNavMenu.menuList.attr("id","menu-to-edit").addClass("menu"),_.each(c.section(this.id).controls(),function(a){"nav_menu_item"===a.params.type&&a.actuallyEmbed()}),"resolved"!==this.deferred.initSortables.state()&&(wpNavMenu.initSortables(),this.deferred.initSortables.resolve(wpNavMenu.menuList),c.control("nav_menu["+String(this.params.menu_id)+"]").reflowMenuItems()));c.Section.prototype.onChangeExpanded.call(this,a,b)}});
c.Menus.NewMenuSection=c.Section.extend({attachEvents:function(){var a=this;this.container.on("click",".add-menu-toggle",function(){a.expanded()?a.collapse():a.expand()})},onChangeExpanded:function(a){var b=this.container.find(".add-menu-toggle"),d=this.container.find(".new-menu-section-content"),c=this.container.closest(".wp-full-overlay-sidebar-content");a?(b.addClass("open"),b.attr("aria-expanded","true"),d.slideDown("fast",function(){c.scrollTop(c.height())})):(b.removeClass("open"),b.attr("aria-expanded",
"false"),d.slideUp("fast"),d.find(".menu-name-field").removeClass("invalid"))}});c.Menus.MenuLocationControl=c.Control.extend({initialize:function(a,b){this.themeLocation=a.match(/^nav_menu_locations\[(.+?)]/)[1];c.Control.prototype.initialize.call(this,a,b)},ready:function(){var a=this,b=/^nav_menu\[(-?\d+)]/;a.setting.validate=function(a){return parseInt(a,10)};c.bind("add",function(d){var c;(c=d.id.match(b))&&!1!==d()&&(c=c[1],d=new Option(n(d().name),c),a.container.find("select").append(d))});
c.bind("remove",function(d){if(d=d.id.match(b))d=parseInt(d[1],10),a.setting()===d&&a.setting.set(""),a.container.find("option[value="+d+"]").remove()});c.bind("change",function(d){var c;if(c=d.id.match(b))c=parseInt(c[1],10),!1===d()?(a.setting()===c&&a.setting.set(""),a.container.find("option[value="+c+"]").remove()):a.container.find("option[value="+c+"]").text(n(d().name))})}});c.Menus.MenuItemControl=c.Control.extend({initialize:function(a,b){var d=this;c.Control.prototype.initialize.call(d,a,
b);d.active.validate=function(){var a=c.section(d.section());return a?a.active():!1}},embed:function(){var a=this.section();a&&(a=c.section(a))&&a.expanded()&&this.actuallyEmbed()},actuallyEmbed:function(){"resolved"!==this.deferred.embedded.state()&&(this.renderContent(),this.deferred.embedded.resolve())},ready:function(){if("undefined"===typeof this.params.menu_item_id)throw Error("params.menu_item_id was not defined");this._setupControlToggle();this._setupReorderUI();this._setupUpdateUI();this._setupRemoveUI();
this._setupLinksUI();this._setupTitleUI()},_setupControlToggle:function(){var a=this;this.container.find(".menu-item-handle").on("click",function(b){b.preventDefault();b.stopPropagation();b=a.getMenuControl();b.isReordering||b.isSorting||a.toggleForm()})},_setupReorderUI:function(){var a=this,b;b=k.template("menu-item-reorder-nav");a.container.find(".item-controls").after(b);a.container.find(".menu-item-reorder-nav").find(".menus-move-up, .menus-move-down, .menus-move-left, .menus-move-right").on("click",
function(){var d=g(this);d.focus();var b=d.is(".menus-move-up"),c=d.is(".menus-move-down"),h=d.is(".menus-move-left"),m=d.is(".menus-move-right");b?a.moveUp():c?a.moveDown():h?a.moveLeft():m&&a.moveRight();d.focus()})},_setupUpdateUI:function(){var a=this,b=a.setting();a.elements={};a.elements.url=new c.Element(a.container.find(".edit-menu-item-url"));a.elements.title=new c.Element(a.container.find(".edit-menu-item-title"));a.elements.attr_title=new c.Element(a.container.find(".edit-menu-item-attr-title"));
a.elements.target=new c.Element(a.container.find(".edit-menu-item-target"));a.elements.classes=new c.Element(a.container.find(".edit-menu-item-classes"));a.elements.xfn=new c.Element(a.container.find(".edit-menu-item-xfn"));a.elements.description=new c.Element(a.container.find(".edit-menu-item-description"));_.each(a.elements,function(d,c){d.bind(function(b){d.element.is("input[type=checkbox]")&&(b=b?d.element.val():"");var h=a.setting();h&&h[c]!==b&&(h=_.clone(h),h[c]=b,a.setting.set(h))});b&&d.set(b[c])});
a.setting.bind(function(d,b){var f=a.params.menu_item_id,h=[],m=[],g;!1===d?(g=c.control("nav_menu["+String(b.nav_menu_term_id)+"]"),a.container.remove(),_.each(g.getMenuItemControls(),function(a){b.menu_item_parent===a.setting().menu_item_parent&&a.setting().position>b.position?h.push(a):a.setting().menu_item_parent===f&&m.push(a)}),_.each(h,function(a){var b=_.clone(a.setting());b.position+=m.length;a.setting.set(b)}),_.each(m,function(a,d){var c=_.clone(a.setting());c.position=b.position+d;c.menu_item_parent=
b.menu_item_parent;a.setting.set(c)}),g.debouncedReflowMenuItems()):(_.each(d,function(b,c){a.elements[c]&&a.elements[c].set(d[c])}),a.container.find(".menu-item-data-parent-id").val(d.menu_item_parent),d.position===b.position&&d.menu_item_parent===b.menu_item_parent||a.getMenuControl().debouncedReflowMenuItems())})},_setupRemoveUI:function(){var a=this;a.container.find(".item-delete").on("click",function(){var b=!0,d,e,f;g("body").hasClass("adding-menu-items")||(b=!1);e=a.container.nextAll(".customize-control-nav_menu_item:visible").first();
f=a.container.prevAll(".customize-control-nav_menu_item:visible").first();d=e.length?e.find(!1===b?".item-edit":".item-delete").first():f.length?f.find(!1===b?".item-edit":".item-delete").first():a.container.nextAll(".customize-control-nav_menu").find(".add-new-menu-item").first();a.container.slideUp(function(){a.setting.set(!1);k.a11y.speak(c.Menus.data.l10n.itemDeleted);d.focus()})})},_setupLinksUI:function(){this.container.find("a.original-link").on("click",function(a){a.preventDefault();c.previewer.previewUrl(a.target.toString())})},
_setupTitleUI:function(){var a=this;a.setting.bind(function(b){if(b){var d=a.container.find(".menu-item-title");b.title?d.text(b.title).removeClass("no-title"):d.text(c.Menus.data.l10n.untitled).addClass("no-title")}})},getDepth:function(){var a;a=this.setting();var b=0;if(!a)return 0;for(;a&&a.menu_item_parent;){b+=1;a=c.control("nav_menu_item["+a.menu_item_parent+"]");if(!a)break;a=a.setting()}return b},renderContent:function(){var a=this.setting(),b;this.params.title=a.title||"";this.params.depth=
this.getDepth();this.container.data("item-depth",this.params.depth);b=["menu-item","menu-item-depth-"+String(this.params.depth),"menu-item-"+a.object,"menu-item-edit-inactive"];a.invalid?(b.push("invalid"),this.params.title=c.Menus.data.invalidTitleTpl.replace("%s",this.params.title)):"draft"===a.status&&(b.push("pending"),this.params.title=c.Menus.data.pendingTitleTpl.replace("%s",this.params.title));this.params.el_classes=b.join(" ");this.params.item_type_label=a.type_label;this.params.item_type=
a.type;this.params.url=a.url;this.params.target=a.target;this.params.attr_title=a.attr_title;this.params.classes=_.isArray(a.classes)?a.classes.join(" "):a.classes;this.params.attr_title=a.attr_title;this.params.xfn=a.xfn;this.params.description=a.description;this.params.parent=a.menu_item_parent;this.params.original_title=a.original_title||"";this.container.addClass(this.params.el_classes);c.Control.prototype.renderContent.call(this)},getMenuControl:function(){var a=this.setting();return a&&a.nav_menu_term_id?
c.control("nav_menu["+a.nav_menu_term_id+"]"):null},expandControlSection:function(){var a=this.container.closest(".accordion-section");a.hasClass("open")||a.find(".accordion-section-title:first").trigger("click")},expandForm:function(){this.toggleForm(!0)},collapseForm:function(){this.toggleForm(!1)},toggleForm:function(a){var b=this,d,e;d=this.container;e=d.find(".menu-item-settings:first");"undefined"===typeof a&&(a=!e.is(":visible"));e.is(":visible")!==a&&(a?(c.control.each(function(a){b.params.type===
a.params.type&&b!==a&&a.collapseForm()}),a=function(){d.removeClass("menu-item-edit-inactive").addClass("menu-item-edit-active");b.container.trigger("expanded")},d.find(".item-edit").attr("aria-expanded","true"),e.slideDown("fast",a),b.container.trigger("expand")):(a=function(){d.addClass("menu-item-edit-inactive").removeClass("menu-item-edit-active");b.container.trigger("collapsed")},b.container.trigger("collapse"),d.find(".item-edit").attr("aria-expanded","false"),e.slideUp("fast",a)))},focus:function(){this.expandControlSection();
this.expandForm();this.container.find(".menu-item-settings :focusable:first").focus()},moveUp:function(){this._changePosition(-1);k.a11y.speak(c.Menus.data.l10n.movedUp)},moveDown:function(){this._changePosition(1);k.a11y.speak(c.Menus.data.l10n.movedDown)},moveLeft:function(){this._changeDepth(-1);k.a11y.speak(c.Menus.data.l10n.movedLeft)},moveRight:function(){this._changeDepth(1);k.a11y.speak(c.Menus.data.l10n.movedRight)},_changePosition:function(a){var b,d=_.clone(this.setting()),c=[];if(1!==
a&&-1!==a)throw Error("Offset changes by 1 are only supported.");if(this.setting()){_(this.getMenuControl().getMenuItemControls()).each(function(a){a.setting().menu_item_parent===d.menu_item_parent&&c.push(a.setting)});c.sort(function(a,b){return a().position-b().position});b=_.indexOf(c,this.setting);if(-1===b)throw Error("Expected setting to be among siblings.");0===b&&0>a||b===c.length-1&&0<a||((b=c[b+a])&&b.set(g.extend(_.clone(b()),{position:d.position})),d.position+=a,this.setting.set(d))}},
_changeDepth:function(a){if(1!==a&&-1!==a)throw Error("Offset changes by 1 are only supported.");var b=this,d=_.clone(b.setting()),e=[],f,h;_(b.getMenuControl().getMenuItemControls()).each(function(a){a.setting().menu_item_parent===d.menu_item_parent&&e.push(a)});e.sort(function(a,b){return a.setting().position-b.setting().position});f=_.indexOf(e,b);if(-1===f)throw Error("Expected control to be among siblings.");-1===a?d.menu_item_parent&&(h=c.control("nav_menu_item["+d.menu_item_parent+"]"),_(e).chain().slice(f).each(function(a,
d){a.setting.set(g.extend({},a.setting(),{menu_item_parent:b.params.menu_item_id,position:d}))}),_(b.getMenuControl().getMenuItemControls()).each(function(a){var b;a.setting().menu_item_parent===h.setting().menu_item_parent&&a.setting().position>h.setting().position&&(b=_.clone(a.setting()),a.setting.set(g.extend(b,{position:b.position+1})))}),d.position=h.setting().position+1,d.menu_item_parent=h.setting().menu_item_parent,b.setting.set(d)):1===a&&0!==f&&(a=e[f-1],d.menu_item_parent=a.params.menu_item_id,
d.position=0,_(b.getMenuControl().getMenuItemControls()).each(function(a){a.setting().menu_item_parent===d.menu_item_parent&&(d.position=Math.max(d.position,a.setting().position))}),d.position+=1,b.setting.set(d))}});c.Menus.MenuNameControl=c.Control.extend({ready:function(){var a=this,b=a.setting();a.active.validate=function(){var b=c.section(a.section());return b?b.active():!1};a.nameElement=new c.Element(a.container.find(".menu-name-field"));a.nameElement.bind(function(b){var c=a.setting();c&&
c.name!==b&&(c=_.clone(c),c.name=b,a.setting.set(c))});b&&a.nameElement.set(b.name);a.setting.bind(function(b){b&&a.nameElement.set(b.name)})}});c.Menus.MenuAutoAddControl=c.Control.extend({ready:function(){var a=this,b=a.setting();a.active.validate=function(){var b=c.section(a.section());return b?b.active():!1};a.autoAddElement=new c.Element(a.container.find("input[type=checkbox].auto_add"));a.autoAddElement.bind(function(b){var c=a.setting();c&&c.name!==b&&(c=_.clone(c),c.auto_add=b,a.setting.set(c))});
b&&a.autoAddElement.set(b.auto_add);a.setting.bind(function(b){b&&a.autoAddElement.set(b.auto_add)})}});c.Menus.MenuControl=c.Control.extend({ready:function(){var a=this,b=a.params.menu_id,d=a.setting(),e,f;if("undefined"===typeof this.params.menu_id)throw Error("params.menu_id was not defined");a.active.validate=function(){var b=c.section(a.section());return b?b.active():!1};a.$controlSection=a.container.closest(".control-section");a.$sectionContent=a.container.closest(".accordion-section-content");
this._setupModel();c.section(a.section(),function(b){b.deferred.initSortables.done(function(b){a._setupSortable(b)})});this._setupAddition();this._setupLocations();this._setupTitle();d&&(e=n(d.name),c.control.each(function(a){a.extended(c.controlConstructor.widget_form)&&"nav_menu"===a.params.widget_id_base&&(a.container.find(".nav-menu-widget-form-controls:first").show(),a.container.find(".nav-menu-widget-no-menus-message:first").hide(),f=a.container.find("select"),0===f.find("option[value="+String(b)+
"]").length&&f.append(new Option(e,b)))}),d=g("#available-widgets-list .widget-tpl:has( input.id_base[ value=nav_menu ] )"),d.find(".nav-menu-widget-form-controls:first").show(),d.find(".nav-menu-widget-no-menus-message:first").hide(),f=d.find(".widget-inside select:first"),0===f.find("option[value="+String(b)+"]").length&&f.append(new Option(e,b)))},_setupModel:function(){var a=this,b=a.params.menu_id;a.setting.bind(function(d){var e;!1===d?a._handleDeletion():(e=n(d.name),c.control.each(function(a){a.extended(c.controlConstructor.widget_form)&&
"nav_menu"===a.params.widget_id_base&&a.container.find("select").find("option[value="+String(b)+"]").text(e)}))});a.container.find(".menu-delete").on("click",function(b){b.stopPropagation();b.preventDefault();a.setting.set(!1)})},_setupSortable:function(a){var b=this;if(!a.is(b.$sectionContent))throw Error("Unexpected menuList.");a.on("sortstart",function(){b.isSorting=!0});a.on("sortstop",function(){setTimeout(function(){var a=b.$sectionContent.sortable("toArray"),e=[],f=0,h=10;b.isSorting=!1;_.each(a,
function(a){if(a=a.match(/^customize-control-nav_menu_item-(-?\d+)$/,""))a=parseInt(a[1],10),(a=c.control("nav_menu_item["+String(a)+"]"))&&e.push(a)});_.each(e,function(a){if(!1!==a.setting()){var b=_.clone(a.setting());f+=1;h+=1;b.position=f;a.priority(h);b.menu_item_parent=parseInt(a.container.find(".menu-item-data-parent-id").val(),10);b.menu_item_parent||(b.menu_item_parent=0);a.setting.set(b)}})})});b.isReordering=!1;this.container.find(".reorder-toggle").on("click",function(){b.toggleReordering(!b.isReordering)})},
_setupAddition:function(){var a=this;this.container.find(".add-new-menu-item").on("click",function(b){a.$sectionContent.hasClass("reordering")||(g("body").hasClass("adding-menu-items")?(g(this).attr("aria-expanded","false"),c.Menus.availableMenuItemsPanel.close(),b.stopPropagation()):(g(this).attr("aria-expanded","true"),c.Menus.availableMenuItemsPanel.open(a)))})},_handleDeletion:function(){var a,b=this.params.menu_id,d,e,f=0;a=c.section(this.section());d=function(){a.container.remove();c.section.remove(a.id)};
a&&a.expanded()?a.collapse({completeCallback:function(){d();k.a11y.speak(c.Menus.data.l10n.menuDeleted);c.panel("nav_menus").focus()}}):d();c.each(function(a){/^nav_menu\[/.test(a.id)&&!1!==a()&&(f+=1)});c.control.each(function(a){if(a.extended(c.controlConstructor.widget_form)&&"nav_menu"===a.params.widget_id_base){var d=a.container.find("select");d.val()===String(b)&&d.prop("selectedIndex",0).trigger("change");a.container.find(".nav-menu-widget-form-controls:first").toggle(0!==f);a.container.find(".nav-menu-widget-no-menus-message:first").toggle(0===
f);a.container.find("option[value="+String(b)+"]").remove()}});e=g("#available-widgets-list .widget-tpl:has( input.id_base[ value=nav_menu ] )");e.find(".nav-menu-widget-form-controls:first").toggle(0!==f);e.find(".nav-menu-widget-no-menus-message:first").toggle(0===f);e.find("option[value="+String(b)+"]").remove()},_setupLocations:function(){var a=this;a.container.find(".assigned-menu-location").each(function(){var b=g(this),d=b.find("input[type=checkbox]"),e,f,h=c("nav_menu_locations["+d.data("location-id")+
"]");f=function(a){var d=c("nav_menu["+String(a)+"]");a&&d&&d()?b.find(".theme-location-set").show().find("span").text(n(d().name)):b.find(".theme-location-set").hide()};e=new c.Element(d);e.set(h.get()===a.params.menu_id);d.on("change",function(){h.set(this.checked?a.params.menu_id:0)});h.bind(function(b){e.set(b===a.params.menu_id);f(b)});f(h.get())})},_setupTitle:function(){var a=this;a.setting.bind(function(b){if(b){var d=a.container.closest(".accordion-section"),e=a.params.menu_id,f=d.find(".accordion-section-title"),
h=d.find(".customize-section-title h3"),m=d.find(".menu-in-location"),k=h.find(".customize-action"),l=n(b.name);f.text(l);m.length&&m.appendTo(f);h.text(l);k.length&&k.prependTo(h);c.control.each(function(a){/^nav_menu_locations\[/.test(a.id)&&a.container.find("option[value="+e+"]").text(l)});d.find(".customize-control-checkbox input").each(function(){g(this).prop("checked")&&g(".current-menu-location-name-"+g(this).data("location-id")).text(l)})}})},toggleReordering:function(a){var b=this.container.find(".add-new-menu-item"),
d=this.container.find(".reorder-toggle"),e=this.$sectionContent.find(".item-title");a=Boolean(a);a!==this.$sectionContent.hasClass("reordering")&&(this.isReordering=a,this.$sectionContent.toggleClass("reordering",a),this.$sectionContent.sortable(this.isReordering?"disable":"enable"),this.isReordering?(b.attr({tabindex:"-1","aria-hidden":"true"}),d.attr("aria-label",c.Menus.data.l10n.reorderLabelOff),k.a11y.speak(c.Menus.data.l10n.reorderModeOn),e.attr("aria-hidden","false")):(b.removeAttr("tabindex aria-hidden"),
d.attr("aria-label",c.Menus.data.l10n.reorderLabelOn),k.a11y.speak(c.Menus.data.l10n.reorderModeOff),e.attr("aria-hidden","true")),a&&_(this.getMenuItemControls()).each(function(a){a.collapseForm()}))},getMenuItemControls:function(){var a=[],b=this.params.menu_id;c.control.each(function(c){"nav_menu_item"===c.params.type&&c.setting()&&b===c.setting().nav_menu_term_id&&a.push(c)});return a},reflowMenuItems:function(){var a=this.getMenuItemControls(),b;b=function(a){var c=[],f=a.currentParent;_.each(a.menuItemControls,
function(a){f===a.setting().menu_item_parent&&c.push(a)});c.sort(function(a,b){return a.setting().position-b.setting().position});_.each(c,function(c){a.currentAbsolutePosition+=1;c.priority.set(a.currentAbsolutePosition);c.container.hasClass("menu-item-depth-"+String(a.currentDepth))||(_.each(c.container.prop("className").match(/menu-item-depth-\d+/g),function(a){c.container.removeClass(a)}),c.container.addClass("menu-item-depth-"+String(a.currentDepth)));c.container.data("item-depth",a.currentDepth);
a.currentDepth+=1;a.currentParent=c.params.menu_item_id;b(a);--a.currentDepth;a.currentParent=f});c.length&&(_(c).each(function(b){b.container.removeClass("move-up-disabled move-down-disabled move-left-disabled move-right-disabled");0===a.currentDepth?b.container.addClass("move-left-disabled"):10===a.currentDepth&&b.container.addClass("move-right-disabled")}),c[0].container.addClass("move-up-disabled").addClass("move-right-disabled").toggleClass("move-down-disabled",1===c.length),c[c.length-1].container.addClass("move-down-disabled").toggleClass("move-up-disabled",
1===c.length))};b({menuItemControls:a,currentParent:0,currentDepth:0,currentAbsolutePosition:0});this.container.find(".reorder-toggle").toggle(1<a.length)},debouncedReflowMenuItems:_.debounce(function(){this.reflowMenuItems.apply(this,arguments)},0),addItemToMenu:function(a){var b,d,e,f=0,h=10;_.each(this.getMenuItemControls(),function(a){!1!==a.setting()&&(h=Math.max(h,a.priority()),0===a.setting().menu_item_parent&&(f=Math.max(f,a.setting().position)))});f+=1;h+=1;a=g.extend({},c.Menus.data.defaultSettingValues.nav_menu_item,
a,{nav_menu_term_id:this.params.menu_id,original_title:a.title,position:f});delete a.id;e=c.Menus.generatePlaceholderAutoIncrementId();b="nav_menu_item["+String(e)+"]";d=c.create(b,b,{},{type:"nav_menu_item",transport:"postMessage",previewer:c.previewer});d.set(a);a=new c.controlConstructor.nav_menu_item(b,{params:{type:"nav_menu_item",content:'<li id="customize-control-nav_menu_item-'+String(e)+'" class="customize-control customize-control-nav_menu_item"></li>',section:this.id,priority:h,active:!0,
settings:{"default":b},menu_item_id:e},previewer:c.previewer});c.control.add(b,a);d.preview();this.debouncedReflowMenuItems();k.a11y.speak(c.Menus.data.l10n.itemAdded);return a}});c.Menus.NewMenuControl=c.Control.extend({ready:function(){this._bindHandlers()},_bindHandlers:function(){var a=this,b=g("#customize-control-new_menu_name input"),c=g("#create-new-menu-submit");b.on("keydown",function(b){13===b.which&&a.submit()});c.on("click",function(b){a.submit();b.stopPropagation();b.preventDefault()})},
submit:function(){var a=this.container.closest(".accordion-section-new-menu").find(".menu-name-field").first(),b=a.val(),d,e=c.Menus.generatePlaceholderAutoIncrementId();b?(d="nav_menu["+String(e)+"]",c.create(d,d,{},{type:"nav_menu",transport:"postMessage",previewer:c.previewer}),c(d).set(g.extend({},c.Menus.data.defaultSettingValues.nav_menu,{name:b})),b=new c.Menus.MenuSection(d,{params:{id:d,panel:"nav_menus",title:n(b),customizeAction:c.Menus.data.l10n.customizingMenus,type:"nav_menu",priority:10,
menu_id:e}}),c.section.add(d,b),a.val(""),a.removeClass("invalid"),k.a11y.speak(c.Menus.data.l10n.menuAdded),c.section(d).focus(),g("#menu-to-edit").css("margin-top",0)):(a.addClass("invalid"),a.focus())}});g.extend(c.controlConstructor,{nav_menu_location:c.Menus.MenuLocationControl,nav_menu_item:c.Menus.MenuItemControl,nav_menu:c.Menus.MenuControl,nav_menu_name:c.Menus.MenuNameControl,nav_menu_auto_add:c.Menus.MenuAutoAddControl,new_menu:c.Menus.NewMenuControl});g.extend(c.panelConstructor,{nav_menus:c.Menus.MenusPanel});
g.extend(c.sectionConstructor,{nav_menu:c.Menus.MenuSection,new_menu:c.Menus.NewMenuSection});c.bind("ready",function(){c.Menus.availableMenuItemsPanel=new c.Menus.AvailableMenuItemsPanelView({collection:c.Menus.availableMenuItems});c.bind("saved",function(a){(a.nav_menu_updates||a.nav_menu_item_updates)&&c.Menus.applySavedData(a)});c.previewer.bind("refresh",function(){c.previewer.refresh()})});c.Menus.applySavedData=function(a){var b={};_(a.nav_menu_updates).each(function(a){var e,f,h,m,p,l,n;if("inserted"===
a.status){if(!a.previous_term_id)throw Error("Expected previous_term_id");if(!a.term_id)throw Error("Expected term_id");e="nav_menu["+String(a.previous_term_id)+"]";if(!c.has(e))throw Error("Expected setting to exist: "+e);m=c(e);if(!c.section.has(e))throw Error("Expected control to exist: "+e);h=c.section(e);l=m.get();if(!l)throw Error("Did not expect setting to be empty (deleted).");l=g.extend(_.clone(l),a.saved_value);b[a.previous_term_id]=a.term_id;f="nav_menu["+String(a.term_id)+"]";p=c.create(f,
f,l,{type:"nav_menu",transport:"postMessage",previewer:c.previewer});h.expanded()&&h.collapse();l=new c.Menus.MenuSection(f,{params:{id:f,panel:"nav_menus",title:l.name,customizeAction:c.Menus.data.l10n.customizingMenus,type:"nav_menu",priority:h.priority.get(),active:!0,menu_id:a.term_id}});c.section.add(f,l);c.control.each(function(b){if(b.extended(c.controlConstructor.widget_form)&&"nav_menu"===b.params.widget_id_base){var e;b=b.container.find("select");e=b.find("option[value="+String(a.previous_term_id)+
"]");b.find("option[value="+String(a.term_id)+"]").prop("selected",e.prop("selected"));e.remove()}});m.callbacks.disable();m.set(!1);m.preview();p.preview();m._dirty=!1;h.container.remove();c.section.remove(e);n=0;c.each(function(a){/^nav_menu\[/.test(a.id)&&!1!==a()&&(n+=1)});e=g("#available-widgets-list .widget-tpl:has( input.id_base[ value=nav_menu ] )");e.find(".nav-menu-widget-form-controls:first").toggle(0!==n);e.find(".nav-menu-widget-no-menus-message:first").toggle(0===n);e.find("option[value="+
String(a.previous_term_id)+"]").remove();k.customize.control.each(function(b){/^nav_menu_locations\[/.test(b.id)&&b.container.find("option[value="+String(a.previous_term_id)+"]").remove()});c.each(function(b){var e=c.state("saved").get();/^nav_menu_locations\[/.test(b.id)&&b.get()===a.previous_term_id&&(b.set(a.term_id),b._dirty=!1,c.state("saved").set(e),b.preview())});h.expanded.get()&&l.expand()}else if("updated"===a.status){h="nav_menu["+String(a.term_id)+"]";if(!c.has(h))throw Error("Expected setting to exist: "+
h);h=c(h);_.isEqual(a.saved_value,h.get())||(e=c.state("saved").get(),h.set(a.saved_value),h._dirty=!1,c.state("saved").set(e))}});_(a.nav_menu_item_updates).each(function(a){var e,f,h,g,k,l;if("inserted"===a.status){if(!a.previous_post_id)throw Error("Expected previous_post_id");if(!a.post_id)throw Error("Expected post_id");e="nav_menu_item["+String(a.previous_post_id)+"]";if(!c.has(e))throw Error("Expected setting to exist: "+e);h=c(e);if(!c.control.has(e))throw Error("Expected control to exist: "+
e);l=c.control(e);k=h.get();if(!k)throw Error("Did not expect setting to be empty (deleted).");k=_.clone(k);b[k.nav_menu_term_id]&&(k.nav_menu_term_id=b[k.nav_menu_term_id]);f="nav_menu_item["+String(a.post_id)+"]";g=c.create(f,f,k,{type:"nav_menu_item",transport:"postMessage",previewer:c.previewer});a=new c.controlConstructor.nav_menu_item(f,{params:{type:"nav_menu_item",content:'<li id="customize-control-nav_menu_item-'+String(a.post_id)+'" class="customize-control customize-control-nav_menu_item"></li>',
menu_id:a.post_id,section:"nav_menu["+String(k.nav_menu_term_id)+"]",priority:l.priority.get(),active:!0,settings:{"default":f},menu_item_id:a.post_id},previewer:c.previewer});l.container.remove();c.control.remove(e);c.control.add(f,a);h.callbacks.disable();h.set(!1);h.preview();g.preview();h._dirty=!1;a.container.toggleClass("menu-item-edit-inactive",l.container.hasClass("menu-item-edit-inactive"))}});_.each(a.widget_nav_menu_updates,function(a,b){var f=c(b);f&&(f._value=a,f.preview())})};c.Menus.focusMenuItemControl=
function(a){(a=c.Menus.getMenuItemControl(a))&&a.focus()};c.Menus.getMenuControl=function(a){return c.control("nav_menu["+a+"]")};c.Menus.getMenuItemControl=function(a){return c.control("nav_menu_item["+a+"]")}})(wp.customize,wp,jQuery);
