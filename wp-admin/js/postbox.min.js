var postboxes;
(function(a){var f=a(document);postboxes={add_postbox_toggles:function(c,b){var d=this;d.init(c,b);a(".postbox .hndle, .postbox .handlediv").bind("click.postboxes",function(){var b=a(this).parent(".postbox"),e=b.attr("id");"dashboard_browser_nag"!=e&&(b.toggleClass("closed"),"press-this"!=c&&d.save_state(c),e&&(!b.hasClass("closed")&&a.isFunction(postboxes.pbshow)?d.pbshow(e):b.hasClass("closed")&&a.isFunction(postboxes.pbhide)&&d.pbhide(e)),f.trigger("postbox-toggled",b))});a(".postbox .hndle a").click(function(a){a.stopPropagation()});a(".postbox a.dismiss").bind("click.postboxes",
function(){var b=a(this).parents(".postbox").attr("id")+"-hide";a("#"+b).prop("checked",!1).triggerHandler("click");return!1});a(".hide-postbox-tog").bind("click.postboxes",function(){var b=a(this).val(),e=a("#"+b);a(this).prop("checked")?(e.show(),a.isFunction(postboxes.pbshow)&&d.pbshow(b)):(e.hide(),a.isFunction(postboxes.pbhide)&&d.pbhide(b));d.save_state(c);d._mark_area();f.trigger("postbox-toggled",e)});a('.columns-prefs input[type="radio"]').bind("click.postboxes",function(){var b=parseInt(a(this).val(),
10);b&&(d._pb_edit(b),d.save_order(c))})},init:function(c,b){var d=a(document.body).hasClass("mobile");a.extend(this,b||{});a("#wpbody-content").css("overflow","hidden");a(".meta-box-sortables").sortable({placeholder:"sortable-placeholder",connectWith:".meta-box-sortables",items:".postbox",handle:".hndle",cursor:"move",delay:d?200:0,distance:2,tolerance:"pointer",forcePlaceholderSize:!0,helper:"clone",opacity:.65,stop:function(){a(this).find("#dashboard_browser_nag").is(":visible")&&"dashboard_browser_nag"!=
this.firstChild.id?a(this).sortable("cancel"):postboxes.save_order(c)},receive:function(b,d){"dashboard_browser_nag"==d.item[0].id&&a(d.sender).sortable("cancel");postboxes._mark_area()}});d&&(a(document.body).bind("orientationchange.postboxes",function(){postboxes._pb_change()}),this._pb_change());this._mark_area()},save_state:function(c){var b=a(".postbox").filter(".closed").map(function(){return this.id}).get().join(","),d=a(".postbox").filter(":hidden").map(function(){return this.id}).get().join(",");
a.post(ajaxurl,{action:"closed-postboxes",closed:b,hidden:d,closedpostboxesnonce:jQuery("#closedpostboxesnonce").val(),page:c})},save_order:function(c){var b,d=a(".columns-prefs input:checked").val()||0;b={action:"meta-box-order",_ajax_nonce:a("#meta-box-order-nonce").val(),page_columns:d,page:c};a(".meta-box-sortables").each(function(){b["order["+this.id.split("-")[0]+"]"]=a(this).sortable("toArray").join(",")});a.post(ajaxurl,b)},_mark_area:function(){var c=a("div.postbox:visible").length,b=a("#post-body #side-sortables");
a("#dashboard-widgets .meta-box-sortables:visible").each(function(){var b=a(this);1==c||b.children(".postbox:visible").length?b.removeClass("empty-container"):b.addClass("empty-container")});b.length&&(b.children(".postbox:visible").length?b.removeClass("empty-container"):"280px"==a("#postbox-container-1").css("width")&&b.addClass("empty-container"))},_pb_edit:function(c){var b=a(".metabox-holder").get(0);b&&(b.className=b.className.replace(/columns-\d+/,"columns-"+c));a(document).trigger("postboxes-columnchange")},
_pb_change:function(){var c=a('label.columns-prefs-1 input[type="radio"]');switch(window.orientation){case 90:case -90:c.length&&c.is(":checked")||this._pb_edit(2);break;case 0:case 180:a("#poststuff").length?this._pb_edit(1):c.length&&c.is(":checked")||this._pb_edit(2)}},pbshow:!1,pbhide:!1}})(jQuery);
