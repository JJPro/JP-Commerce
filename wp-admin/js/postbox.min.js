var postboxes;
(function(a){var g=a(document);postboxes={handle_click:function(){var c=a(this),b=c.parent(".postbox"),d=b.attr("id"),e;"dashboard_browser_nag"!==d&&(b.toggleClass("closed"),e=!b.hasClass("closed"),c.hasClass("handlediv")?c.attr("aria-expanded",e):c.closest(".postbox").find("button.handlediv").attr("aria-expanded",e),"press-this"!==postboxes.page&&postboxes.save_state(postboxes.page),d&&(!b.hasClass("closed")&&a.isFunction(postboxes.pbshow)?postboxes.pbshow(d):b.hasClass("closed")&&a.isFunction(postboxes.pbhide)&&
postboxes.pbhide(d)),g.trigger("postbox-toggled",b))},add_postbox_toggles:function(c,b){var d=a(".postbox .hndle, .postbox .handlediv");this.page=c;this.init(c,b);d.on("click.postboxes",this.handle_click);a(".postbox .hndle a").click(function(a){a.stopPropagation()});a(".postbox a.dismiss").on("click.postboxes",function(b){var c=a(this).parents(".postbox").attr("id")+"-hide";b.preventDefault();a("#"+c).prop("checked",!1).triggerHandler("click")});a(".hide-postbox-tog").bind("click.postboxes",function(){var b=
a(this),d=b.val(),f=a("#"+d);b.prop("checked")?(f.show(),a.isFunction(postboxes.pbshow)&&postboxes.pbshow(d)):(f.hide(),a.isFunction(postboxes.pbhide)&&postboxes.pbhide(d));postboxes.save_state(c);postboxes._mark_area();g.trigger("postbox-toggled",f)});a('.columns-prefs input[type="radio"]').bind("click.postboxes",function(){var b=parseInt(a(this).val(),10);b&&(postboxes._pb_edit(b),postboxes.save_order(c))})},init:function(c,b){var d=a(document.body).hasClass("mobile"),e=a(".postbox .handlediv");
a.extend(this,b||{});a("#wpbody-content").css("overflow","hidden");a(".meta-box-sortables").sortable({placeholder:"sortable-placeholder",connectWith:".meta-box-sortables",items:".postbox",handle:".hndle",cursor:"move",delay:d?200:0,distance:2,tolerance:"pointer",forcePlaceholderSize:!0,helper:"clone",opacity:.65,stop:function(){var b=a(this);b.find("#dashboard_browser_nag").is(":visible")&&"dashboard_browser_nag"!=this.firstChild.id?b.sortable("cancel"):postboxes.save_order(c)},receive:function(b,
c){"dashboard_browser_nag"==c.item[0].id&&a(c.sender).sortable("cancel");postboxes._mark_area()}});d&&(a(document.body).bind("orientationchange.postboxes",function(){postboxes._pb_change()}),this._pb_change());this._mark_area();e.each(function(){var b=a(this);b.attr("aria-expanded",!b.parent(".postbox").hasClass("closed"))})},save_state:function(c){var b=a(".postbox").filter(".closed").map(function(){return this.id}).get().join(","),d=a(".postbox").filter(":hidden").map(function(){return this.id}).get().join(",");
a.post(ajaxurl,{action:"closed-postboxes",closed:b,hidden:d,closedpostboxesnonce:jQuery("#closedpostboxesnonce").val(),page:c})},save_order:function(c){var b,d=a(".columns-prefs input:checked").val()||0;b={action:"meta-box-order",_ajax_nonce:a("#meta-box-order-nonce").val(),page_columns:d,page:c};a(".meta-box-sortables").each(function(){b["order["+this.id.split("-")[0]+"]"]=a(this).sortable("toArray").join(",")});a.post(ajaxurl,b)},_mark_area:function(){var c=a("div.postbox:visible").length,b=a("#post-body #side-sortables");
a("#dashboard-widgets .meta-box-sortables:visible").each(function(){var b=a(this);1==c||b.children(".postbox:visible").length?b.removeClass("empty-container"):b.addClass("empty-container")});b.length&&(b.children(".postbox:visible").length?b.removeClass("empty-container"):"280px"==a("#postbox-container-1").css("width")&&b.addClass("empty-container"))},_pb_edit:function(c){var b=a(".metabox-holder").get(0);b&&(b.className=b.className.replace(/columns-\d+/,"columns-"+c));a(document).trigger("postboxes-columnchange")},
_pb_change:function(){var c=a('label.columns-prefs-1 input[type="radio"]');switch(window.orientation){case 90:case -90:c.length&&c.is(":checked")||this._pb_edit(2);break;case 0:case 180:a("#poststuff").length?this._pb_edit(1):c.length&&c.is(":checked")||this._pb_edit(2)}},pbshow:!1,pbhide:!1}})(jQuery);
