(function(v,e){var p,u,b=wp.customize;b.Setting=b.Value.extend({initialize:function(a,d,c){b.Value.prototype.initialize.call(this,d,c);this.id=a;this.transport=this.transport||"refresh";this._dirty=c.dirty||!1;this.bind(this.preview)},preview:function(){switch(this.transport){case "refresh":return this.previewer.refresh();case "postMessage":return this.previewer.send("setting",[this.id,this()])}}});b.utils={};b.utils.bubbleChildValueChanges=function(a,b){e.each(b,function(b,d){a[d].bind(function(b,
d){a.parent&&b!==d&&a.parent.trigger("change",a)})})};u=function(a){var d,c,h;d=this;a=a||{};h=function(){(d.extended(b.Panel)&&d.expanded&&d.expanded()?d.container.find("ul.control-panel-content"):d.extended(b.Section)&&d.expanded&&d.expanded()?d.container.find("ul.accordion-section-content"):d.container).find("input, select, textarea, button, object, a[href], [tabindex]").filter(":visible").first().focus()};a.completeCallback?(c=a.completeCallback,a.completeCallback=function(){h();c()}):a.completeCallback=
h;d.expand?d.expand(a):a.completeCallback()};b.utils.prioritySort=function(a,b){return a.priority()===b.priority()&&"number"===typeof a.params.instanceNumber&&"number"===typeof b.params.instanceNumber?a.params.instanceNumber-b.params.instanceNumber:a.priority()-b.priority()};b.utils.isKeydownButNotEnterEvent=function(a){return"keydown"===a.type&&13!==a.which};b.utils.areElementListsEqual=function(a,b){return a.length===b.length&&-1===_.indexOf(_.map(_.zip(a,b),function(a){return e(a[0]).is(a[1])}),
!1)};p=b.Class.extend({defaultActiveArguments:{duration:"fast",completeCallback:e.noop},defaultExpandedArguments:{duration:"fast",completeCallback:e.noop},containerType:"container",defaults:{title:"",description:"",priority:100,type:"default",content:null,active:!0,instanceNumber:null},initialize:function(a,d){var c=this;c.id=a;d=d||{};d.params=_.defaults(d.params||{},c.defaults);e.extend(c,d);c.templateSelector="customize-"+c.containerType+"-"+c.params.type;c.container=e(c.params.content);0===c.container.length&&
(c.container=e(c.getContainer()));c.deferred={embedded:new e.Deferred};c.priority=new b.Value;c.active=new b.Value;c.activeArgumentsQueue=[];c.expanded=new b.Value;c.expandedArgumentsQueue=[];c.active.bind(function(a){var b=c.activeArgumentsQueue.shift(),b=e.extend({},c.defaultActiveArguments,b);a=a&&c.isContextuallyActive();c.onChangeActive(a,b)});c.expanded.bind(function(a){var b=c.expandedArgumentsQueue.shift(),b=e.extend({},c.defaultExpandedArguments,b);c.onChangeExpanded(a,b)});c.deferred.embedded.done(function(){c.attachEvents()});
b.utils.bubbleChildValueChanges(c,["priority","active"]);c.priority.set(c.params.priority);c.active.set(c.params.active);c.expanded.set(!1)},ready:function(){},_children:function(a,d){var c=this,h=[];b[d].each(function(b){b[a].get()===c.id&&h.push(b)});h.sort(b.utils.prioritySort);return h},isContextuallyActive:function(){throw Error("Container.isContextuallyActive() must be overridden in a subclass.");},onChangeActive:function(a,d){var c,h=this,f;d.unchanged?d.completeCallback&&d.completeCallback():
(c="resolved"===b.previewer.deferred.active.state()?d.duration:0,h.extended(b.Panel)&&(b.panel.each(function(a){a!==h&&a.expanded()&&(f=a,c=0)}),a||_.each(h.sections(),function(a){a.collapse({duration:0})})),e.contains(document,h.container[0])?a?h.container.stop(!0,!0).slideDown(c,d.completeCallback):h.expanded()?h.collapse({duration:c,completeCallback:function(){h.container.stop(!0,!0).slideUp(c,d.completeCallback)}}):h.container.stop(!0,!0).slideUp(c,d.completeCallback):(h.container.toggle(a),d.completeCallback&&
d.completeCallback()),f&&f._recalculateTopMargin())},_toggleActive:function(a,b){b=b||{};if(a&&this.active.get()||!a&&!this.active.get())return b.unchanged=!0,this.onChangeActive(this.active.get(),b),!1;b.unchanged=!1;this.activeArgumentsQueue.push(b);this.active.set(a);return!0},activate:function(a){return this._toggleActive(!0,a)},deactivate:function(a){return this._toggleActive(!1,a)},onChangeExpanded:function(){throw Error("Must override with subclass.");},_toggleExpanded:function(a,b){var c=
this,h;b=b||{};h=b.completeCallback;if(a&&!c.active())return!1;b.completeCallback=function(){h&&h.apply(c,arguments);a?c.container.trigger("expanded"):c.container.trigger("collapsed")};if(a&&c.expanded.get()||!a&&!c.expanded.get())return b.unchanged=!0,c.onChangeExpanded(c.expanded.get(),b),!1;b.unchanged=!1;c.expandedArgumentsQueue.push(b);c.expanded.set(a);return!0},expand:function(a){return this._toggleExpanded(!0,a)},collapse:function(a){return this._toggleExpanded(!1,a)},focus:u,getContainer:function(){var a;
return(a=0!==e("#tmpl-"+this.templateSelector).length?wp.template(this.templateSelector):wp.template("customize-"+this.containerType+"-default"))&&this.container?e.trim(a(this.params)):"<li></li>"}});b.Section=p.extend({containerType:"section",defaults:{title:"",description:"",priority:100,type:"default",content:null,active:!0,instanceNumber:null,panel:null,customizeAction:""},initialize:function(a,d){var c=this;p.prototype.initialize.call(c,a,d);c.id=a;c.panel=new b.Value;c.panel.bind(function(a){e(c.container).toggleClass("control-subsection",
!!a)});c.panel.set(c.params.panel||"");b.utils.bubbleChildValueChanges(c,["panel"]);c.embed();c.deferred.embedded.done(function(){c.ready()})},embed:function(){var a=this,d;d=function(c){var d;c?b.panel(c,function(b){b.deferred.embedded.done(function(){d=b.container.find("ul:first");a.container.parent().is(d)||d.append(a.container);a.deferred.embedded.resolve()})}):(d=e("#customize-theme-controls").children("ul"),a.container.parent().is(d)||d.append(a.container),a.deferred.embedded.resolve())};a.panel.bind(d);
d(a.panel.get());a.deferred.embedded.done(function(){b.bind("pane-contents-reflowed",_.debounce(function(){a._recalculateTopMargin()},100))})},attachEvents:function(){var a=this;a.container.find(".accordion-section-title, .customize-section-back").on("click keydown",function(d){b.utils.isKeydownButNotEnterEvent(d)||(d.preventDefault(),a.expanded()?a.collapse():a.expand())})},isContextuallyActive:function(){var a=this.controls(),b=0;_(a).each(function(a){a.active()&&(b+=1)});return 0!==b},controls:function(){return this._children("section",
"control")},onChangeExpanded:function(a,d){var c=this,h=c.container.closest(".wp-full-overlay-sidebar-content"),f=c.container.find(".accordion-section-content"),g=c.container.closest(".wp-full-overlay"),k=c.container.find(".customize-section-back"),l=c.container.find(".accordion-section-title").first(),m=e("#customize-header-actions").height(),n,q,r,t;a&&!c.container.hasClass("open")?(d.unchanged?q=d.completeCallback:(h.scrollTop(0),n=function(){var a,b;a=window.matchMedia||window.msMatchMedia;b=
90;a&&a("(max-width: 640px)").matches&&(b=45);f.css("height",window.innerHeight-b)},q=function(){c.container.addClass("open");g.addClass("section-open");r=f.offset().top;t=h.scrollTop();f.css("margin-top",m-r-t);n();l.attr("tabindex","-1");k.attr("tabindex","0");k.focus();d.completeCallback&&d.completeCallback();e(window).on("resize.customizer-section",_.debounce(n,100));c._recalculateTopMargin()}),d.allowMultiple||b.section.each(function(a){a!==c&&a.collapse({duration:d.duration})}),c.panel()?b.panel(c.panel()).expand({duration:d.duration,
completeCallback:q}):(b.panel.each(function(a){a.collapse()}),q())):!a&&c.container.hasClass("open")?(c.container.removeClass("open"),g.removeClass("section-open"),f.css("margin-top",""),h.scrollTop(0),k.attr("tabindex","-1"),l.attr("tabindex","0"),l.focus(),d.completeCallback&&d.completeCallback(),e(window).off("resize.customizer-section")):d.completeCallback&&d.completeCallback()},_recalculateTopMargin:function(){var a,b;a=this.container.find(".accordion-section-content");0!==a.length&&(b=e("#customize-header-actions").height(),
b=a.offset().top-b,0<b&&a.css("margin-top",parseInt(a.css("margin-top"),10)-b))}});b.ThemesSection=b.Section.extend({currentTheme:"",overlay:"",template:"",screenshotQueue:null,$window:e(window),initialize:function(){this.$customizeSidebar=e(".wp-full-overlay-sidebar-content:first");return b.Section.prototype.initialize.apply(this,arguments)},ready:function(){var a=this;a.overlay=a.container.find(".theme-overlay");a.template=wp.template("customize-themes-details-view");e("body").on("keyup",function(b){a.overlay.find(".theme-wrap").is(":visible")&&
(39===b.keyCode&&a.nextTheme(),37===b.keyCode&&a.previousTheme(),27===b.keyCode&&a.closeDetails())});_.bindAll(this,"renderScreenshots")},isContextuallyActive:function(){return this.active()},attachEvents:function(){var a=this;a.container.find(".change-theme, .customize-theme").on("click keydown",function(c){b.utils.isKeydownButNotEnterEvent(c)||(c.preventDefault(),a.expanded()?a.collapse():a.expand())});a.container.on("click keydown",".left",function(c){b.utils.isKeydownButNotEnterEvent(c)||(c.preventDefault(),
a.previousTheme())});a.container.on("click keydown",".right",function(c){b.utils.isKeydownButNotEnterEvent(c)||(c.preventDefault(),a.nextTheme())});a.container.on("click keydown",".theme-backdrop, .close",function(c){b.utils.isKeydownButNotEnterEvent(c)||(c.preventDefault(),a.closeDetails())});var d=_.throttle(_.bind(a.renderScreenshots,this),100);a.container.on("input","#themes-filter",function(b){var e=b.currentTarget.value.toLowerCase().trim().replace("-"," ");b=a.controls();_.each(b,function(a){a.filter(e)});
d();b=a.container.find("li.customize-control:visible").length;a.container.find(".theme-count").text(b)});b.bind("ready",function(){_.each(a.controls().slice(0,3),function(a){var b=a.params.theme.screenshot[0];b&&(a=new Image,a.src=b)})})},onChangeExpanded:function(a,d){if(d.unchanged)d.completeCallback&&d.completeCallback();else{var c,h,f=this,g=f.container.closest(".accordion-section"),k=g.closest(".wp-full-overlay"),l=g.closest(".wp-full-overlay-sidebar-content"),m=l.find(".open"),n=g.find(".customize-theme"),
q=g.find(".change-theme"),r=g.find(".control-panel-content");a?(b.section.each(function(a){a!==f&&a.collapse({duration:d.duration})}),b.panel.each(function(a){a.collapse({duration:0})}),r.show(0,function(){c=r.offset().top;h=l.scrollTop();r.css("margin-top",e("#customize-header-actions").height()-c-h);g.addClass("current-panel");k.addClass("in-themes-panel");l.scrollTop(0);_.delay(f.renderScreenshots,10);f.$customizeSidebar.on("scroll.customize-themes-section",_.throttle(f.renderScreenshots,300));
d.completeCallback&&d.completeCallback()}),n.focus()):(m.removeClass("open"),g.removeClass("current-panel"),k.removeClass("in-themes-panel"),f.$customizeSidebar.off("scroll.customize-themes-section"),r.delay(180).hide(0,function(){r.css("margin-top","inherit");d.completeCallback&&d.completeCallback()}),n.attr("tabindex","0"),q.focus(),l.scrollTop(0))}},_recalculateTopMargin:function(){b.Panel.prototype._recalculateTopMargin.call(this)},renderScreenshots:function(){var a=this;null===a.screenshotQueue&&
(a.screenshotQueue=a.controls());a.screenshotQueue.length&&(a.screenshotQueue=_.filter(a.screenshotQueue,function(b){var c=b.container.find(".theme-screenshot"),e=c.find("img");if(!e.length)return!1;if(e.is(":hidden"))return!0;var f=a.$window.scrollTop(),g=f+a.$window.height(),e=e.offset().top,c=c.height(),k=3*c;(f=e+c>=f-k&&e<=g+k)&&b.container.trigger("render-screenshot");return!f}))},nextTheme:function(){var a=this;a.getNextTheme()&&a.showDetails(a.getNextTheme(),function(){a.overlay.find(".right").focus()})},
getNextTheme:function(){var a;a=b.control("theme_"+this.currentTheme);a=a.container.next("li.customize-control-theme");if(!a.length)return!1;a=a[0].id.replace("customize-control-","");a=b.control(a);return a.params.theme},previousTheme:function(){var a=this;a.getPreviousTheme()&&a.showDetails(a.getPreviousTheme(),function(){a.overlay.find(".left").focus()})},getPreviousTheme:function(){var a;a=b.control("theme_"+this.currentTheme);a=a.container.prev("li.customize-control-theme");if(!a.length)return!1;
a=a[0].id.replace("customize-control-","");a=b.control(a);return a.params.theme},updateLimits:function(){this.getNextTheme()||this.overlay.find(".right").addClass("disabled");this.getPreviousTheme()||this.overlay.find(".left").addClass("disabled")},showDetails:function(a,b){b=b||function(){};this.currentTheme=a.id;this.overlay.html(this.template(a)).fadeIn("fast").focus();e("body").addClass("modal-open");this.containFocus(this.overlay);this.updateLimits();b()},closeDetails:function(){e("body").removeClass("modal-open");
this.overlay.fadeOut("fast");b.control("theme_"+this.currentTheme).focus()},containFocus:function(a){var b;a.on("keydown",function(c){if(9===c.keyCode){b=e(":tabbable",a);if(b.last()[0]===c.target&&!c.shiftKey)return b.first().focus(),!1;if(b.first()[0]===c.target&&c.shiftKey)return b.last().focus(),!1}})}});b.Panel=p.extend({containerType:"panel",initialize:function(a,b){var c=this;p.prototype.initialize.call(c,a,b);c.embed();c.deferred.embedded.done(function(){c.ready()})},embed:function(){var a=
this,d=e("#customize-theme-controls > ul");a.container.parent().is(d)||(d.append(a.container),a.renderContent());b.bind("pane-contents-reflowed",_.debounce(function(){a._recalculateTopMargin()},100));a.deferred.embedded.resolve()},attachEvents:function(){var a,d=this;d.container.find(".accordion-section-title").on("click keydown",function(a){b.utils.isKeydownButNotEnterEvent(a)||(a.preventDefault(),d.expanded()||d.expand())});d.container.find(".customize-panel-back").on("click keydown",function(a){b.utils.isKeydownButNotEnterEvent(a)||
(a.preventDefault(),d.expanded()&&d.collapse())});a=d.container.find(".panel-meta:first");a.find("> .accordion-section-title .customize-help-toggle").on("click keydown",function(c){b.utils.isKeydownButNotEnterEvent(c)||(c.preventDefault(),a=d.container.find(".panel-meta"),a.hasClass("cannot-expand")||(c=a.find(".customize-panel-description:first"),a.hasClass("open")?(a.toggleClass("open"),c.slideUp(d.defaultExpandedArguments.duration),e(this).attr("aria-expanded",!1)):(c.slideDown(d.defaultExpandedArguments.duration),
a.toggleClass("open"),e(this).attr("aria-expanded",!0))))})},sections:function(){return this._children("panel","section")},isContextuallyActive:function(){var a=this.sections(),b=0;_(a).each(function(a){a.active()&&a.isContextuallyActive()&&(b+=1)});return 0!==b},onChangeExpanded:function(a,d){if(d.unchanged)d.completeCallback&&d.completeCallback();else{var c,h,f=this,g=f.container.closest(".accordion-section"),k=g.closest(".wp-full-overlay"),l=g.closest(".wp-full-overlay-sidebar-content"),m=l.find(".open"),
n=k.find("#customize-theme-controls > ul > .accordion-section > .accordion-section-title"),q=g.find(".customize-panel-back"),r=g.find(".accordion-section-title").first(),t=g.find(".control-panel-content"),p=e("#customize-header-actions").height();a?(b.section.each(function(a){f.id!==a.panel()&&a.collapse({duration:0})}),b.panel.each(function(a){f!==a&&a.collapse({duration:0})}),t.show(0,function(){t.parent().show();c=t.offset().top;h=l.scrollTop();t.css("margin-top",p-c-h);g.addClass("current-panel");
k.addClass("in-sub-panel");l.scrollTop(0);d.completeCallback&&d.completeCallback()}),n.attr("tabindex","-1"),q.attr("tabindex","0"),q.focus(),f._recalculateTopMargin()):(m.removeClass("open"),g.removeClass("current-panel"),k.removeClass("in-sub-panel"),t.delay(180).hide(0,function(){t.css("margin-top","inherit");d.completeCallback&&d.completeCallback()}),n.attr("tabindex","0"),q.attr("tabindex","-1"),r.focus(),l.scrollTop(0))}},_recalculateTopMargin:function(){var a,b;a=e("#customize-header-actions").height();
b=this.container.closest(".accordion-section").find(".control-panel-content");b.css("margin-top",parseInt(b.css("margin-top"),10)-(b.offset().top-a))},renderContent:function(){var a;(a=0!==e("#tmpl-"+this.templateSelector+"-content").length?wp.template(this.templateSelector+"-content"):wp.template("customize-panel-default-content"))&&this.container&&this.container.find(".accordion-sub-container").html(a(this.params))}});b.Control=b.Class.extend({defaultActiveArguments:{duration:"fast",completeCallback:e.noop},
initialize:function(a,d){var c=this,h,f,g;c.params={};e.extend(c,d||{});c.id=a;c.selector="#customize-control-"+a.replace(/\]/g,"").replace(/\[/g,"-");c.templateSelector="customize-control-"+c.params.type+"-content";c.container=c.params.content?e(c.params.content):e(c.selector);c.deferred={embedded:new e.Deferred};c.section=new b.Value;c.priority=new b.Value;c.active=new b.Value;c.activeArgumentsQueue=[];c.elements=[];h=c.container.find("[data-customize-setting-link]");f={};h.each(function(){var a=
e(this),d;if(a.is(":radio")){d=a.prop("name");if(f[d])return;f[d]=!0;a=h.filter('[name="'+d+'"]')}b(a.data("customizeSettingLink"),function(d){var e=new b.Element(a);c.elements.push(e);e.sync(d);e.set(d())})});c.active.bind(function(a){var b=c.activeArgumentsQueue.shift(),b=e.extend({},c.defaultActiveArguments,b);c.onChangeActive(a,b)});c.section.set(c.params.section);c.priority.set(isNaN(c.params.priority)?10:c.params.priority);c.active.set(c.params.active);b.utils.bubbleChildValueChanges(c,["section",
"priority","active"]);g=e.map(c.params.settings,function(a){return a});b.apply(b,g.concat(function(){var a;c.settings={};for(a in c.params.settings)c.settings[a]=b(c.params.settings[a]);c.setting=c.settings["default"]||null;c.embed()}));c.deferred.embedded.done(function(){c.ready()})},embed:function(){var a=this,d;d=function(c){var d;c&&b.section(c,function(b){b.deferred.embedded.done(function(){d=b.container.find("ul:first");a.container.parent().is(d)||(d.append(a.container),a.renderContent());a.deferred.embedded.resolve()})})};
a.section.bind(d);d(a.section.get())},ready:function(){},expand:function(a){b.section(this.section()).expand(a)},focus:u,onChangeActive:function(a,b){b.unchanged?b.completeCallback&&b.completeCallback():e.contains(document,this.container[0])?a?this.container.slideDown(b.duration,b.completeCallback):this.container.slideUp(b.duration,b.completeCallback):(this.container.toggle(a),b.completeCallback&&b.completeCallback())},toggle:function(a){return this.onChangeActive(a,this.defaultActiveArguments)},
activate:p.prototype.activate,deactivate:p.prototype.deactivate,_toggleActive:p.prototype._toggleActive,dropdownInit:function(){var a=this,d=this.container.find(".dropdown-status"),c=this.params,e=!1,f=function(a){"string"===typeof a&&c.statuses&&c.statuses[a]?d.html(c.statuses[a]).show():d.hide()};this.container.on("click keydown",".dropdown",function(c){b.utils.isKeydownButNotEnterEvent(c)||(c.preventDefault(),e||a.container.toggleClass("open"),a.container.hasClass("open")&&a.container.parent().parent().find("li.library-selected").focus(),
e=!0,setTimeout(function(){e=!1},400))});this.setting.bind(f);f(this.setting())},renderContent:function(){var a;0!==e("#tmpl-"+this.templateSelector).length&&(a=wp.template(this.templateSelector))&&this.container&&this.container.html(a(this.params))}});b.ColorControl=b.Control.extend({ready:function(){var a=this,b=this.container.find(".color-picker-hex");b.val(a.setting()).wpColorPicker({change:function(){a.setting.set(b.wpColorPicker("color"))},clear:function(){a.setting.set("")}});this.setting.bind(function(a){b.val(a);
b.wpColorPicker("color",a)})}});b.MediaControl=b.Control.extend({ready:function(){var a=this;_.bindAll(a,"restoreDefault","removeFile","openFrame","select","pausePlayer");a.container.on("click keydown",".upload-button",a.openFrame);a.container.on("click keydown",".upload-button",a.pausePlayer);a.container.on("click keydown",".thumbnail-image img",a.openFrame);a.container.on("click keydown",".default-button",a.restoreDefault);a.container.on("click keydown",".remove-button",a.pausePlayer);a.container.on("click keydown",
".remove-button",a.removeFile);a.container.on("click keydown",".remove-button",a.cleanupPlayer);b.section(a.section()).container.on("expanded",function(){a.player&&a.player.setControlsSize()}).on("collapsed",function(){a.pausePlayer()});a.setting.bind(function(){a.renderContent()})},pausePlayer:function(){this.player&&this.player.pause()},cleanupPlayer:function(){this.player&&wp.media.mixin.removePlayer(this.player)},openFrame:function(a){b.utils.isKeydownButNotEnterEvent(a)||(a.preventDefault(),
this.frame||this.initFrame(),this.frame.open())},initFrame:function(){this.frame=wp.media({button:{text:this.params.button_labels.frame_button},states:[new wp.media.controller.Library({title:this.params.button_labels.frame_title,library:wp.media.query({type:this.params.mime_type}),multiple:!1,date:!1})]});this.frame.on("select",this.select)},select:function(){var a;a=this.frame.state().get("selection").first().toJSON();var b=window._wpmejsSettings||{};this.params.attachment=a;this.setting(a.id);(a=
this.container.find("audio, video").get(0))?this.player=new MediaElementPlayer(a,b):this.cleanupPlayer()},restoreDefault:function(a){b.utils.isKeydownButNotEnterEvent(a)||(a.preventDefault(),this.params.attachment=this.params.defaultAttachment,this.setting(this.params.defaultAttachment.url))},removeFile:function(a){b.utils.isKeydownButNotEnterEvent(a)||(a.preventDefault(),this.params.attachment={},this.setting(""),this.renderContent())}});b.UploadControl=b.MediaControl.extend({select:function(){var a;
a=this.frame.state().get("selection").first().toJSON();var b=window._wpmejsSettings||{};this.params.attachment=a;this.setting(a.url);(a=this.container.find("audio, video").get(0))?this.player=new MediaElementPlayer(a,b):this.cleanupPlayer()},success:function(){},removerVisibility:function(){}});b.ImageControl=b.UploadControl.extend({thumbnailSrc:function(){}});b.BackgroundControl=b.UploadControl.extend({ready:function(){b.UploadControl.prototype.ready.apply(this,arguments)},select:function(){b.UploadControl.prototype.select.apply(this,
arguments);wp.ajax.post("custom-background-add",{nonce:_wpCustomizeBackground.nonces.add,wp_customize:"on",theme:b.settings.theme.stylesheet,attachment_id:this.params.attachment.id})}});b.CroppedImageControl=b.MediaControl.extend({openFrame:function(a){b.utils.isKeydownButNotEnterEvent(a)||(this.initFrame(),this.frame.setState("library").open())},initFrame:function(){this.frame=wp.media({button:{text:_wpMediaViewsL10n.select,close:!1},states:[new wp.media.controller.Library({title:this.params.button_labels.frame_title,
library:wp.media.query({type:"image"}),multiple:!1,date:!1,priority:20,suggestedWidth:this.params.width,suggestedHeight:this.params.height}),new wp.media.controller.CustomizeImageCropper({imgSelectOptions:this.calculateImageSelectOptions,control:this})]});this.frame.on("select",this.onSelect,this);this.frame.on("cropped",this.onCropped,this);this.frame.on("skippedcrop",this.onSkippedCrop,this)},onSelect:function(){var a=this.frame.state().get("selection").first().toJSON();this.params.width!==a.width||
this.params.height!==a.height||this.params.flex_width||this.params.flex_height?this.frame.setState("cropper"):(this.setImageFromAttachment(a),this.frame.close())},onCropped:function(a){this.setImageFromAttachment(a)},calculateImageSelectOptions:function(a,b){var c=b.get("control"),e=!!parseInt(c.params.flex_width,10),f=!!parseInt(c.params.flex_height,10),g=a.get("width"),k=a.get("height"),l=parseInt(c.params.width,10),m=parseInt(c.params.height,10),n=l/m;b.set("canSkipCrop",!c.mustBeCropped(e,f,l,
m,g,k));g/k>n?(m=k,l=m*n):(l=g,m=l/n);c=(g-l)/2;n=(k-m)/2;g={handles:!0,keys:!0,instance:!0,persistent:!0,imageWidth:g,imageHeight:k,x1:c,y1:n,x2:l+c,y2:m+n};!1===f&&!1===e&&(g.aspectRatio=l+":"+m);!1===f&&(g.maxHeight=m);!1===e&&(g.maxWidth=l);return g},mustBeCropped:function(a,b,c,e,f,g){return!0===a&&!0===b||!0===a&&e===g||!0===b&&c===f||c===f&&e===g||f<=c?!1:!0},onSkippedCrop:function(){var a=this.frame.state().get("selection").first().toJSON();this.setImageFromAttachment(a)},setImageFromAttachment:function(a){this.params.attachment=
a;this.setting(a.id)}});b.SiteIconControl=b.CroppedImageControl.extend({initFrame:function(){this.frame=wp.media({button:{text:_wpMediaViewsL10n.select,close:!1},states:[new wp.media.controller.Library({title:this.params.button_labels.frame_title,library:wp.media.query({type:"image"}),multiple:!1,date:!1,priority:20,suggestedWidth:this.params.width,suggestedHeight:this.params.height}),new wp.media.controller.SiteIconCropper({imgSelectOptions:this.calculateImageSelectOptions,control:this})]});this.frame.on("select",
this.onSelect,this);this.frame.on("cropped",this.onCropped,this);this.frame.on("skippedcrop",this.onSkippedCrop,this)},onSelect:function(){var a=this.frame.state().get("selection").first().toJSON(),b=this;this.params.width!==a.width||this.params.height!==a.height||this.params.flex_width||this.params.flex_height?this.frame.setState("cropper"):wp.ajax.post("crop-image",{nonce:a.nonces.edit,id:a.id,context:"site-icon",cropDetails:{x1:0,y1:0,width:this.params.width,height:this.params.height,dst_width:this.params.width,
dst_height:this.params.height}}).done(function(a){b.setImageFromAttachment(a);b.frame.close()}).fail(function(){b.trigger("content:error:crop")})},setImageFromAttachment:function(a){var b;_.each(["site_icon-32","thumbnail","full"],function(c){b||_.isUndefined(a.sizes[c])||(b=a.sizes[c])});this.params.attachment=a;this.setting(a.id);e('link[sizes="32x32"]').attr("href",b.url)},removeFile:function(a){b.utils.isKeydownButNotEnterEvent(a)||(a.preventDefault(),this.params.attachment={},this.setting(""),
this.renderContent(),e('link[rel="icon"]').attr("href",""))}});b.HeaderControl=b.Control.extend({ready:function(){this.btnRemove=e("#customize-control-header_image .actions .remove");this.btnNew=e("#customize-control-header_image .actions .new");_.bindAll(this,"openMedia","removeImage");this.btnNew.on("click",this.openMedia);this.btnRemove.on("click",this.removeImage);b.HeaderTool.currentHeader=this.getInitialHeaderImage();new b.HeaderTool.CurrentView({model:b.HeaderTool.currentHeader,el:"#customize-control-header_image .current .container"});
new b.HeaderTool.ChoiceListView({collection:b.HeaderTool.UploadsList=new b.HeaderTool.ChoiceList,el:"#customize-control-header_image .choices .uploaded .list"});new b.HeaderTool.ChoiceListView({collection:b.HeaderTool.DefaultsList=new b.HeaderTool.DefaultsList,el:"#customize-control-header_image .choices .default .list"});b.HeaderTool.combinedList=b.HeaderTool.CombinedList=new b.HeaderTool.CombinedList([b.HeaderTool.UploadsList,b.HeaderTool.DefaultsList])},getInitialHeaderImage:function(){if(!b.get().header_image||
!b.get().header_image_data||_.contains(["remove-header","random-default-image","random-uploaded-image"],b.get().header_image))return new b.HeaderTool.ImageModel;var a=_.find(_wpCustomizeHeader.uploads,function(a){return a.attachment_id===b.get().header_image_data.attachment_id});a||(a={url:b.get().header_image,thumbnail_url:b.get().header_image,attachment_id:b.get().header_image_data.attachment_id});return new b.HeaderTool.ImageModel({header:a,choice:a.url.split("/").pop()})},calculateImageSelectOptions:function(a,
d){var c=parseInt(_wpCustomizeHeader.data.width,10),e=parseInt(_wpCustomizeHeader.data.height,10),f=!!parseInt(_wpCustomizeHeader.data["flex-width"],10),g=!!parseInt(_wpCustomizeHeader.data["flex-height"],10),k,l,m;m=a.get("width");l=a.get("height");this.headerImage=new b.HeaderTool.ImageModel;this.headerImage.set({themeWidth:c,themeHeight:e,themeFlexWidth:f,themeFlexHeight:g,imageWidth:m,imageHeight:l});d.set("canSkipCrop",!this.headerImage.shouldBeCropped());k=c/e;m/l>k?(e=l,c=e*k):(c=m,e=c/k);
k={handles:!0,keys:!0,instance:!0,persistent:!0,imageWidth:m,imageHeight:l,x1:0,y1:0,x2:c,y2:e};!1===g&&!1===f&&(k.aspectRatio=c+":"+e);!1===g&&(k.maxHeight=e);!1===f&&(k.maxWidth=c);return k},openMedia:function(a){var b=_wpMediaViewsL10n;a.preventDefault();this.frame=wp.media({button:{text:b.selectAndCrop,close:!1},states:[new wp.media.controller.Library({title:b.chooseImage,library:wp.media.query({type:"image"}),multiple:!1,date:!1,priority:20,suggestedWidth:_wpCustomizeHeader.data.width,suggestedHeight:_wpCustomizeHeader.data.height}),
new wp.media.controller.Cropper({imgSelectOptions:this.calculateImageSelectOptions})]});this.frame.on("select",this.onSelect,this);this.frame.on("cropped",this.onCropped,this);this.frame.on("skippedcrop",this.onSkippedCrop,this);this.frame.open()},onSelect:function(){this.frame.setState("cropper")},onCropped:function(a){this.setImageFromURL(a.url,a.attachment_id,a.width,a.height)},onSkippedCrop:function(a){var b=a.get("url"),c=a.get("width"),e=a.get("height");this.setImageFromURL(b,a.id,c,e)},setImageFromURL:function(a,
d,c,e){var f={};f.url=a;f.thumbnail_url=a;f.timestamp=_.now();d&&(f.attachment_id=d);c&&(f.width=c);e&&(f.height=e);a=new b.HeaderTool.ImageModel({header:f,choice:a.split("/").pop()});b.HeaderTool.UploadsList.add(a);b.HeaderTool.currentHeader.set(a.toJSON());a.save();a.importImage()},removeImage:function(){b.HeaderTool.currentHeader.trigger("hide");b.HeaderTool.CombinedList.trigger("control:removeImage")}});b.ThemeControl=b.Control.extend({touchDrag:!1,isRendered:!1,renderContent:function(){var a=
this,d=arguments;b.section(a.section(),function(c){c.expanded()?(b.Control.prototype.renderContent.apply(a,d),a.isRendered=!0):c.expanded.bind(function(c){c&&!a.isRendered&&(b.Control.prototype.renderContent.apply(a,d),a.isRendered=!0)})})},ready:function(){var a=this;a.container.on("touchmove",".theme",function(){a.touchDrag=!0});a.container.on("click keydown touchend",".theme",function(d){if(!b.utils.isKeydownButNotEnterEvent(d)){if(!0===a.touchDrag)return a.touchDrag=!1;e(d.target).is(".theme-actions .button")||
(d=e(this).data("previewUrl"),e(".wp-full-overlay").addClass("customize-loading"),window.parent.location=d)}});a.container.on("click keydown",".theme-actions .theme-details",function(d){b.utils.isKeydownButNotEnterEvent(d)||(d.preventDefault(),b.section(a.section()).showDetails(a.params.theme))});a.container.on("render-screenshot",function(){var a=e(this).find("img"),b=a.data("src");b&&a.attr("src",b)})},filter:function(a){var b=this.params.theme.name+" "+this.params.theme.description+" "+this.params.theme.tags+
" "+this.params.theme.author,b=b.toLowerCase().replace("-"," ");-1!==b.search(a)?this.activate():this.deactivate()}});b.defaultConstructor=b.Setting;b.control=new b.Values({defaultConstructor:b.Control});b.section=new b.Values({defaultConstructor:b.Section});b.panel=new b.Values({defaultConstructor:b.Panel});b.PreviewFrame=b.Messenger.extend({sensitivity:2E3,initialize:function(a,d){var c=e.Deferred();c.promise(this);this.container=a.container;this.signature=a.signature;e.extend(a,{channel:b.PreviewFrame.uuid()});
b.Messenger.prototype.initialize.call(this,a,d);this.add("previewUrl",a.previewUrl);this.query=e.extend(a.query||{},{customize_messenger_channel:this.channel()});this.run(c)},run:function(a){var d=this,c=!1,h=!1;this._ready&&this.unbind("ready",this._ready);this._ready=function(){h=!0;c&&a.resolveWith(d)};this.bind("ready",this._ready);this.bind("ready",function(a){this.container.addClass("iframe-ready");a&&_({panel:a.activePanels,section:a.activeSections,control:a.activeControls}).each(function(a,
c){b[c].each(function(b,c){a&&a[c]?b.activate():b.deactivate()})})});this.request=e.ajax(this.previewUrl(),{type:"POST",data:this.query,xhrFields:{withCredentials:!0}});this.request.fail(function(){a.rejectWith(d,["request failure"])});this.request.done(function(f){var g=d.request.getResponseHeader("Location"),k=d.signature;g&&g!==d.previewUrl()?a.rejectWith(d,["redirect",g]):"0"===f?d.login(a):"-1"===f?a.rejectWith(d,["cheatin"]):(g=f.lastIndexOf(k),-1===g||g<f.lastIndexOf("</html>")?a.rejectWith(d,
["unsigned"]):(f=f.slice(0,g)+f.slice(g+k.length),d.iframe=e("<iframe />",{title:b.l10n.previewIframeTitle}).appendTo(d.container),d.iframe.one("load",function(){c=!0;h?a.resolveWith(d):setTimeout(function(){a.rejectWith(d,["ready timeout"])},d.sensitivity)}),d.targetWindow(d.iframe[0].contentWindow),d.targetWindow().document.open(),d.targetWindow().document.write(f),d.targetWindow().document.close()))})},login:function(a){var d=this,c;c=function(){a.rejectWith(d,["logged out"])};if(this.triedLogin)return c();
e.get(b.settings.url.ajax,{action:"logged-in"}).fail(c).done(function(h){var f;"1"!==h&&c();f=e("<iframe />",{src:d.previewUrl(),title:b.l10n.previewIframeTitle}).hide();f.appendTo(d.container);f.load(function(){d.triedLogin=!0;f.remove();d.run(a)})})},destroy:function(){b.Messenger.prototype.destroy.call(this);this.request.abort();this.iframe&&this.iframe.remove();delete this.request;delete this.iframe;delete this.targetWindow}});(function(){var a=0;b.PreviewFrame.uuid=function(){return"preview-"+
a++}})();b.setDocumentTitle=function(a){a=b.settings.documentTitleTmpl.replace("%s",a);document.title=a;b.trigger("title",a)};b.Previewer=b.Messenger.extend({refreshBuffer:250,initialize:function(a,d){var c=this,h=/^https?/;e.extend(this,d||{});this.deferred={active:e.Deferred()};this.refresh=function(a){var b=a.refresh,c=function(){d=null;b.call(a)},d;return function(){if("number"!==typeof d)if(a.loading)a.abort();else return c();clearTimeout(d);d=setTimeout(c,a.refreshBuffer)}}(this);this.container=
b.ensure(a.container);this.allowedUrls=a.allowedUrls;this.signature=a.signature;a.url=window.location.href;b.Messenger.prototype.initialize.call(this,a);this.add("scheme",this.origin()).link(this.origin).setter(function(a){return(a=a.match(h))?a[0]:""});this.add("previewUrl",a.previewUrl).setter(function(a){var b;if(/\/wp-admin(\/|$)/.test(a.replace(/[#?].*$/,"")))return null;e.each([a.replace(h,c.scheme()),a],function(a,d){e.each(c.allowedUrls,function(a,c){var k;c=c.replace(/\/+$/,"");k=d.replace(c,
"");if(0===d.indexOf(c)&&/^([/#?]|$)/.test(k))return b=d,!1});if(b)return!1});return b?b:null});this.previewUrl.bind(this.refresh);this.scroll=0;this.bind("scroll",function(a){this.scroll=a});this.bind("url",this.previewUrl);this.bind("documentTitle",function(a){b.setDocumentTitle(a)})},query:function(){},abort:function(){this.loading&&(this.loading.destroy(),delete this.loading)},refresh:function(){var a=this;this.send("loading-initiated");this.abort();this.loading=new b.PreviewFrame({url:this.url(),
previewUrl:this.previewUrl(),query:this.query()||{},container:this.container,signature:this.signature});this.loading.done(function(){this.bind("synced",function(){a.preview&&a.preview.destroy();a.preview=this;delete a.loading;a.targetWindow(this.targetWindow());a.channel(this.channel());a.deferred.active.resolve();a.send("active")});this.send("sync",{scroll:a.scroll,settings:b.get()})});this.loading.fail(function(b,c){a.send("loading-failed");"redirect"===b&&c&&a.previewUrl(c);"logged out"===b&&(a.preview&&
(a.preview.destroy(),delete a.preview),a.login().done(a.refresh));"cheatin"===b&&a.cheatin()})},login:function(){var a=this,d,c,h;if(this._login)return this._login;d=e.Deferred();this._login=d.promise();c=new b.Messenger({channel:"login",url:b.settings.url.login});h=e("<iframe />",{src:b.settings.url.login,title:b.l10n.loginIframeTitle}).appendTo(this.container);c.targetWindow(h[0].contentWindow);c.bind("login",function(){var b=a.refreshNonces();b.always(function(){h.remove();c.destroy();delete a._login});
b.done(function(){d.resolve()});b.fail(function(){a.cheatin();d.reject()})});return this._login},cheatin:function(){e(document.body).empty().addClass("cheatin").append("<h1>"+b.l10n.cheatin+"</h1><p>"+b.l10n.notAllowed+"</p>")},refreshNonces:function(){var a,d=e.Deferred();d.promise();a=wp.ajax.post("customize_refresh_nonces",{wp_customize:"on",theme:b.settings.theme.stylesheet});a.done(function(a){b.trigger("nonce-refresh",a);d.resolve()});a.fail(function(){d.reject()});return d}});b.controlConstructor=
{color:b.ColorControl,media:b.MediaControl,upload:b.UploadControl,image:b.ImageControl,cropped_image:b.CroppedImageControl,site_icon:b.SiteIconControl,header:b.HeaderControl,background:b.BackgroundControl,theme:b.ThemeControl};b.panelConstructor={};b.sectionConstructor={themes:b.ThemesSection};e(function(){b.settings=window._wpCustomizeSettings;b.l10n=window._wpCustomizeControlsL10n;if(b.settings&&e.support.postMessage&&(e.support.cors||!b.settings.isCrossDomain)){var a,d=e(document.body),c=d.children(".wp-full-overlay"),
h=e("#customize-info .panel-title.site-title"),f=e(".customize-controls-close"),g=e("#save");e("#customize-controls").on("keydown",function(a){var b=13===a.which,c=e(a.target);b&&(c.is("input:not([type=button])")||c.is("select"))&&a.preventDefault()});e(".customize-info").find("> .accordion-section-title .customize-help-toggle").on("click keydown",function(a){if(!b.utils.isKeydownButNotEnterEvent(a)){a.preventDefault();a=e(this).closest(".accordion-section");var c=a.find(".customize-panel-description:first");
a.hasClass("cannot-expand")||(a.hasClass("open")?(a.toggleClass("open"),c.slideUp(b.Panel.prototype.defaultExpandedArguments.duration),e(this).attr("aria-expanded",!1)):(c.slideDown(b.Panel.prototype.defaultExpandedArguments.duration),a.toggleClass("open"),e(this).attr("aria-expanded",!0)))}});b.previewer=new b.Previewer({container:"#customize-preview",form:"#customize-controls",previewUrl:b.settings.url.preview,allowedUrls:b.settings.url.allowed,signature:"WP_CUSTOMIZER_SIGNATURE"},{nonce:b.settings.nonce,
query:function(){var a={};b.each(function(b,c){b._dirty&&(a[c]=b())});return{wp_customize:"on",theme:b.settings.theme.stylesheet,customized:JSON.stringify(a),nonce:this.nonce.preview}},save:function(){var a=this,c=b.state("processing"),f,g;d.addClass("saving");g=function(){var c;c=e.extend(a.query(),{nonce:a.nonce.save});c=wp.ajax.post("customize_save",c);b.trigger("save",c);c.always(function(){d.removeClass("saving")});c.fail(function(c){"0"===c?c="not_logged_in":"-1"===c&&(c="invalid_nonce");"invalid_nonce"===
c?a.cheatin():"not_logged_in"===c&&(a.preview.iframe.hide(),a.login().done(function(){a.save();a.preview.iframe.show()}));b.trigger("error",c)});c.done(function(a){b.each(function(a){a._dirty=!1});b.trigger("saved",a)})};0===c()?g():(f=function(){0===c()&&(b.state.unbind("change",f),g())},b.state.bind("change",f))}});b.previewer.bind("nonce",function(a){e.extend(this.nonce,a)});b.bind("nonce-refresh",function(a){e.extend(b.settings.nonce,a);e.extend(b.previewer.nonce,a)});e.each(b.settings.settings,
function(a,c){b.create(a,a,c.value,{transport:c.transport,previewer:b.previewer,dirty:!!c.dirty})});e.each(b.settings.panels,function(a,c){var d;d=new (b.panelConstructor[c.type]||b.Panel)(a,{params:c});b.panel.add(a,d)});e.each(b.settings.sections,function(a,c){var d;d=new (b.sectionConstructor[c.type]||b.Section)(a,{params:c});b.section.add(a,d)});e.each(b.settings.controls,function(a,c){var d;d=new (b.controlConstructor[c.type]||b.Control)(a,{params:c,previewer:b.previewer});b.control.add(a,d)});
_.each(["panel","section","control"],function(a){var c,d=b.settings.autofocus[a];d&&b[a](d)&&(c=b[a](d),c.deferred.embedded.done(function(){b.previewer.deferred.active.done(function(){c.focus()})}))});b.reflowPaneContents=_.bind(function(){var a,c,d,f=[],g=!1;document.activeElement&&(c=e(document.activeElement));b.panel.each(function(c){var d=c.sections(),e=_.pluck(d,"container");f.push(c);a=c.container.find("ul:first");b.utils.areElementListsEqual(e,a.children("[id]"))||(_(d).each(function(b){a.append(b.container)}),
g=!0)});b.section.each(function(c){var d=c.controls(),e=_.pluck(d,"container");c.panel()||f.push(c);a=c.container.find("ul:first");b.utils.areElementListsEqual(e,a.children("[id]"))||(_(d).each(function(b){a.append(b.container)}),g=!0)});f.sort(b.utils.prioritySort);d=_.pluck(f,"container");a=e("#customize-theme-controls").children("ul");b.utils.areElementListsEqual(d,a.children())||(_(f).each(function(b){a.append(b.container)}),g=!0);b.panel.each(function(a){var b=a.active();a.active.callbacks.fireWith(a.active,
[b,b])});b.section.each(function(a){var b=a.active();a.active.callbacks.fireWith(a.active,[b,b])});g&&c&&c.focus();b.trigger("pane-contents-reflowed")},b);b.bind("ready",b.reflowPaneContents);b.reflowPaneContents=_.debounce(b.reflowPaneContents,100);e([b.panel,b.section,b.control]).each(function(a,c){c.bind("add",b.reflowPaneContents);c.bind("change",b.reflowPaneContents);c.bind("remove",b.reflowPaneContents)});b.previewer.previewUrl()?b.previewer.refresh():b.previewer.previewUrl(b.settings.url.home);
(function(){var a=new b.Values,c=a.create("saved"),d=a.create("activated"),e=a.create("processing");a.bind("change",function(){d()?c()?(g.val(b.l10n.saved).prop("disabled",!0),f.find(".screen-reader-text").text(b.l10n.close)):(g.val(b.l10n.save).prop("disabled",!1),f.find(".screen-reader-text").text(b.l10n.cancel)):(g.val(b.l10n.activate).prop("disabled",!1),f.find(".screen-reader-text").text(b.l10n.cancel))});c(!0);d(b.settings.theme.active);e(0);b.bind("change",function(){a("saved").set(!1)});b.bind("saved",
function(){a("saved").set(!0);a("activated").set(!0)});d.bind(function(a){a&&b.trigger("activated")});b.state=a})();g.click(function(a){b.previewer.save();a.preventDefault()}).keydown(function(a){9!==a.which&&(13===a.which&&b.previewer.save(),a.preventDefault())});f.keydown(function(a){9!==a.which&&(13===a.which&&this.click(),a.preventDefault())});e(".collapse-sidebar").on("click",function(){"true"===e(this).attr("aria-expanded")?e(this).attr({"aria-expanded":"false","aria-label":b.l10n.expandSidebar}):
e(this).attr({"aria-expanded":"true","aria-label":b.l10n.collapseSidebar});c.toggleClass("collapsed").toggleClass("expanded")});e(".customize-controls-preview-toggle").on("click keydown",function(a){b.utils.isKeydownButNotEnterEvent(a)||(c.toggleClass("preview-only"),a.preventDefault())});if(h.length)e("#customize-control-blogname input").on("input",function(){h.text(this.value)});a=new b.Messenger({url:b.settings.url.parent,channel:"loader"});a.bind("back",function(){f.on("click.customize-controls-close",
function(b){b.preventDefault();a.send("close")})});e(window).on("beforeunload",function(){if(!b.state("saved")())return setTimeout(function(){c.removeClass("customize-loading")},1),b.l10n.saveAlert});e.each(["saved","change"],function(c,d){b.bind(d,function(){a.send(d)})});b.bind("activated",function(){a.targetWindow()?a.send("activated",b.settings.url.activated):b.settings.url.activated&&(window.location=b.settings.url.activated)});b.bind("title",function(b){a.send("title",b)});a.send("ready");e.each({background_image:{controls:["background_repeat",
"background_position_x","background_attachment"],callback:function(a){return!!a}},show_on_front:{controls:["page_on_front","page_for_posts"],callback:function(a){return"page"===a}},header_textcolor:{controls:["header_textcolor"],callback:function(a){return"blank"!==a}}},function(a,c){b(a,function(a){e.each(c.controls,function(d,e){b.control(e,function(b){var d=function(a){b.container.toggle(c.callback(a))};d(a.get());a.bind(d)})})})});b.control("display_header_text",function(a){var c="";a.elements[0].unsync(b("header_textcolor"));
a.element=new b.Element(a.container.find("input"));a.element.set("blank"!==a.setting());a.element.bind(function(d){d||(c=b("header_textcolor").get());a.setting.set(d?c:"blank")});a.setting.bind(function(b){a.element.set("blank"!==b)})});b("show_on_front","page_on_front",function(a,c){var d=function(){"page"===a()&&0<parseInt(c(),10)&&b.previewer.previewUrl.set(b.settings.url.home)};a.bind(d);c.bind(d)});b("page_for_posts",function(a){a.bind(function(a){a=parseInt(a,10);0<a&&b.previewer.previewUrl.set(b.settings.url.home+
"?page_id="+a)})});b.trigger("ready");f.focus();setTimeout(function(){f.focus()},200)}})})(wp,jQuery);
