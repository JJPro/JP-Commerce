var tagBox,array_unique_noempty;
(function(a){array_unique_noempty=function(c){var b=[];a.each(c,function(c,d){(d=a.trim(d))&&-1===a.inArray(d,b)&&b.push(d)});return b};tagBox={clean:function(a){var b=window.tagsBoxL10n.tagDelimiter;","!==b&&(a=a.replace(new RegExp(b,"g"),","));a=a.replace(/\s*,\s*/g,",").replace(/,+/g,",").replace(/[,\s]+$/,"").replace(/^[,\s]+/,"");","!==b&&(a=a.replace(/,/g,b));return a},parseTags:function(c){var b=c.id.split("-check-num-")[1];c=a(c).closest(".tagsdiv");var e=c.find(".the-tags"),d=window.tagsBoxL10n.tagDelimiter,
f=e.val().split(d),h=[];delete f[b];a.each(f,function(b,c){(c=a.trim(c))&&h.push(c)});e.val(this.clean(h.join(d)));this.quickClicks(c);return!1},quickClicks:function(c){var b=a(".the-tags",c),e=a(".tagchecklist",c),d=a(c).attr("id"),f;b.length&&(f=b.prop("disabled"),c=b.val().split(window.tagsBoxL10n.tagDelimiter),e.empty(),a.each(c,function(c,b){var g,l;if(b=a.trim(b))g=a("<span />").text(b),f||(l=a('<a id="'+d+"-check-num-"+c+'" class="ntdelbutton" tabindex="0">X</a>'),l.on("click keypress",function(b){if("click"===
b.type||13===b.keyCode)13===b.keyCode&&a(this).closest(".tagsdiv").find("input.newtag").focus(),tagBox.parseTags(this)}),g.prepend("&nbsp;").prepend(l)),e.append(g)}))},flushTags:function(c,b,e){var d,f,h=a(".the-tags",c),k=a("input.newtag",c),g=window.tagsBoxL10n.tagDelimiter;f=(b=b||!1)?a(b).text():k.val();if("undefined"==typeof f)return!1;d=h.val();d=this.clean(d?d+g+f:f);d=array_unique_noempty(d.split(g)).join(g);h.val(d);this.quickClicks(c);b||k.val("");"undefined"==typeof e&&k.focus();return!1},
get:function(c){var b=c.substr(c.indexOf("-")+1);a.post(ajaxurl,{action:"get-tagcloud",tax:b},function(e,d){0!==e&&"success"==d&&(e=a('<p id="tagcloud-'+b+'" class="the-tagcloud">'+e+"</p>"),a("a",e).click(function(){tagBox.flushTags(a("#"+b),this);return!1}),a("#"+c).after(e))})},init:function(){var c=this,b=a("div.ajaxtag");a(".tagsdiv").each(function(){tagBox.quickClicks(this)});a(".tagadd",b).click(function(){c.flushTags(a(this).closest(".tagsdiv"))});a("input.newtag",b).keyup(function(b){if(13==
b.which)return tagBox.flushTags(a(this).closest(".tagsdiv")),!1}).keypress(function(a){if(13==a.which)return a.preventDefault(),!1}).each(function(){var b=a(this).closest("div.tagsdiv").attr("id");a(this).suggest(ajaxurl+"?action=ajax-tag-search&tax="+b,{delay:500,minchars:2,multiple:!0,multipleSep:window.tagsBoxL10n.tagDelimiter+" "})});a("#post").submit(function(){a("div.tagsdiv").each(function(){tagBox.flushTags(this,!1,1)})});a(".tagcloud-link").click(function(){tagBox.get(a(this).attr("id"));
a(this).unbind().click(function(){a(this).siblings(".the-tagcloud").toggle();return!1});return!1})}}})(jQuery);
