var setCommentsList,theList,theExtraList,commentReply;
(function(a){var n,q,r;setCommentsList=function(){var b,e,k,c,m,l,g=0;b=a('input[name="_total"]',"#comments-form");e=a('input[name="_per_page"]',"#comments-form");k=a('input[name="_page"]',"#comments-form");c=function(a,d,e){d<g||(e&&(g=d),b.val(a.toString()))};n=function(a){a=parseInt(a.html().replace(/[^0-9]+/g,""),10);return isNaN(a)?0:a};q=function(a,d){var b="";if(!isNaN(d)){d=1>d?"0":d.toString();if(3<d.length){for(;3<d.length;)b=thousandsSeparator+d.substr(d.length-3)+b,d=d.substr(0,d.length-
3);d+=b}a.html(d)}};r=function(b){a("span.pending-count").each(function(){var d=a(this),e=n(d)+b;1>e&&(e=0);d.closest(".awaiting-mod")[0===e?"addClass":"removeClass"]("count-0");q(d,e)})};m=function(b){var d=a.query.get(),e=a(".total-pages").text(),c=a('input[name="_per_page"]',"#comments-form").val();d.paged||(d.paged=1);d.paged>e||(b?(theExtraList.empty(),d.number=Math.min(8,c)):(d.number=1,d.offset=Math.min(8,c)-1),d.no_placeholder=!0,d.paged++,!0===d.comment_type&&(d.comment_type=""),d=a.extend(d,
{action:"fetch-list",list_args:list_args,_ajax_fetch_list_nonce:a("#_ajax_fetch_list_nonce").val()}),a.ajax({url:ajaxurl,global:!1,dataType:"json",data:d,success:function(a){theExtraList.get(0).wpList.add(a.rows)}}))};theExtraList=a("#the-extra-comment-list").wpList({alt:"",delColor:"none",addColor:"none"});theList=a("#the-comment-list").wpList({alt:"",delBefore:function(c,d){var p,h,f,m,l,g=!1;f=a(c.target).attr("data-wp-lists");c.data._total=b.val()||0;c.data._per_page=e.val()||0;c.data._page=k.val()||
0;c.data._url=document.location.href;c.data.comment_status=a('input[name="comment_status"]',"#comments-form").val();-1!=f.indexOf(":trash=1")?g="trash":-1!=f.indexOf(":spam=1")&&(g="spam");g&&(h=f.replace(/.*?comment-([0-9]+).*/,"$1"),f=a("#comment-"+h),p=a("#"+g+"-undo-holder").html(),f.find(".check-column :checkbox").prop("checked",!1),f.siblings("#replyrow").length&&commentReply.cid==h&&commentReply.close(),f.is("tr")?(m=f.children(":visible").length,l=a(".author strong",f).text(),p=a('<tr id="undo-'+
h+'" class="undo un'+g+'" style="display:none;"><td colspan="'+m+'">'+p+"</td></tr>")):(l=a(".comment-author",f).text(),p=a('<div id="undo-'+h+'" style="display:none;" class="undo un'+g+'">'+p+"</div>")),f.before(p),a("strong","#undo-"+h).text(l),l=a(".undo a","#undo-"+h),l.attr("href","comment.php?action=un"+g+"comment&c="+h+"&_wpnonce="+c.data._ajax_nonce),l.attr("data-wp-lists","delete:the-comment-list:comment-"+h+"::un"+g+"=1"),l.attr("class","vim-z vim-destructive"),a(".avatar",f).first().clone().prependTo("#undo-"+
h+" ."+g+"-undo-inside"),l.click(function(){d.wpList.del(this);a("#undo-"+h).css({backgroundColor:"#ceb"}).fadeOut(350,function(){a(this).remove();a("#comment-"+h).css("backgroundColor","").fadeIn(300,function(){a(this).show()})});return!1}));return c},dimAfter:function(b,d){var c,e,f=a("#"+d.element);c=a("#replyrow");e=a("#comment_ID",c).val();c=a("#replybtn",c);f.is(".unapproved")?(d.data.id==e&&c.text(adminCommentsL10n.replyApprove),f.find("div.comment_status").html("0")):(d.data.id==e&&c.text(adminCommentsL10n.reply),
f.find("div.comment_status").html("1"));l=a("#"+d.element).is("."+d.dimClass)?1:-1;r(l)},delAfter:function(e,d){function l(b){return a(d.target).parent().is("span."+b)?1:a("#"+d.element).is("."+b)?-1:0}var h,f,k,v,t=a(d.target).parent().is("span.untrash"),u=a(d.target).parent().is("span.unspam");f=a("#"+d.element).is(".unapproved");v=t?-1:l("trash");k=u?-1:l("spam");a(d.target).parent().is("span.unapprove")||(t||u)&&f?h=1:f&&(h=-1);h&&r(h);a("span.spam-count").each(function(){var b=a(this),d=n(b)+
k;q(b,d)});a("span.trash-count").each(function(){var b=a(this),d=n(b)+v;q(b,d)});if(!a("#dashboard_right_now").length)if(f=b.val()?parseInt(b.val(),10):0,a(d.target).parent().is("span.undo")?f++:f--,0>f&&(f=0),"object"==typeof e&&g<d.parsed.responses[0].supplemental.time){if(h=d.parsed.responses[0].supplemental.total_items_i18n||"")a(".displaying-num").text(h),a(".total-pages").text(d.parsed.responses[0].supplemental.total_pages_i18n),a(".tablenav-pages").find(".next-page, .last-page").toggleClass("disabled",
d.parsed.responses[0].supplemental.total_pages==a(".current-page").val());c(f,d.parsed.responses[0].supplemental.time,!0)}else c(f,e,!1);!theExtraList||0===theExtraList.size()||0===theExtraList.children().size()||t||u||(theList.get(0).wpList.add(theExtraList.children(":eq(0)").remove().clone()),m())},addColor:"none"}).bind("wpListDelEnd",function(b,d){var c=a(d.target).attr("data-wp-lists"),e=d.element.replace(/[^0-9]+/g,"");-1==c.indexOf(":trash=1")&&-1==c.indexOf(":spam=1")||a("#undo-"+e).fadeIn(300,
function(){a(this).show()})})};commentReply={cid:"",act:"",init:function(){var b=a("#replyrow");a("a.cancel",b).click(function(){return commentReply.revert()});a("a.save",b).click(function(){return commentReply.send()});a("input#author, input#author-email, input#author-url",b).keypress(function(a){if(13==a.which)return commentReply.send(),a.preventDefault(),!1});a("#the-comment-list .column-comment > p").dblclick(function(){commentReply.toggle(a(this).parent())});a("#doaction, #doaction2, #post-query-submit").click(function(){0<
a("#the-comment-list #replyrow").length&&commentReply.close()});this.comments_listing=a('#comments-form > input[name="comment_status"]').val()||""},addEvents:function(b){b.each(function(){a(this).find(".column-comment > p").dblclick(function(){commentReply.toggle(a(this).parent())})})},toggle:function(b){"none"!==a(b).css("display")&&(a("#replyrow").parent().is("#com-reply")||window.confirm(adminCommentsL10n.warnQuickEdit))&&a(b).find("a.vim-q").click()},revert:function(){if(1>a("#the-comment-list #replyrow").length)return!1;
a("#replyrow").fadeOut("fast",function(){commentReply.close()});return!1},close:function(){var b,e=a("#replyrow");e.parent().is("#com-reply")||(this.cid&&"edit-comment"==this.act&&(b=a("#comment-"+this.cid),b.fadeIn(300,function(){b.show()}).css("backgroundColor","")),"undefined"!=typeof QTags&&QTags.closeAllTags("replycontent"),a("#add-new-comment").css("display",""),e.hide(),a("#com-reply").append(e),a("#replycontent").css("height","").val(""),a("#edithead input").val(""),a(".error",e).empty().hide(),
a(".spinner",e).removeClass("is-active"),this.cid="")},open:function(b,e,k){var c,m,l,g=a("#comment-"+b),n=g.height(),d=0;this.close();this.cid=b;c=a("#replyrow");m=a("#inline-"+b);k=k||"replyto";l=this.act=("edit"==k?"edit":"replyto")+"-comment";d=a("th:visible, td:visible",g).length;c.hasClass("inline-edit-row")&&0!==d&&a("td",c).attr("colspan",d);a("#action",c).val(l);a("#comment_post_ID",c).val(e);a("#comment_ID",c).val(b);"edit"==k?(a("#author",c).val(a("div.author",m).text()),a("#author-email",
c).val(a("div.author-email",m).text()),a("#author-url",c).val(a("div.author-url",m).text()),a("#status",c).val(a("div.comment_status",m).text()),a("#replycontent",c).val(a("textarea.comment",m).val()),a("#edithead, #savebtn",c).show(),a("#replyhead, #replybtn, #addhead, #addbtn",c).hide(),120<n&&(b=500<n?500:n,a("#replycontent",c).css("height",b+"px")),g.after(c).fadeOut("fast",function(){a("#replyrow").fadeIn(300,function(){a(this).show()})})):"add"==k?(a("#addhead, #addbtn",c).show(),a("#replyhead, #replybtn, #edithead, #savebtn",
c).hide(),a("#the-comment-list").prepend(c),a("#replyrow").fadeIn(300)):(b=a("#replybtn",c),a("#edithead, #savebtn, #addhead, #addbtn",c).hide(),a("#replyhead, #replybtn",c).show(),g.after(c),g.hasClass("unapproved")?b.text(adminCommentsL10n.replyApprove):b.text(adminCommentsL10n.reply),a("#replyrow").fadeIn(300,function(){a(this).show()}));setTimeout(function(){var b,d,c,e;b=a("#replyrow").offset().top;d=b+a("#replyrow").height();c=window.pageYOffset||document.documentElement.scrollTop;e=document.documentElement.clientHeight||
window.innerHeight||0;c+e-20<d?window.scroll(0,d-e+35):b-20<c&&window.scroll(0,b-35);a("#replycontent").focus().keyup(function(a){27==a.which&&commentReply.revert()})},600);return!1},send:function(){var b={};a("#replysubmit .error").hide();a("#replysubmit .spinner").addClass("is-active");a("#replyrow input").not(":button").each(function(){var e=a(this);b[e.attr("name")]=e.val()});b.content=a("#replycontent").val();b.id=b.comment_post_ID;b.comments_listing=this.comments_listing;b.p=a('[name="p"]').val();
a("#comment-"+a("#comment_ID").val()).hasClass("unapproved")&&(b.approve_parent=1);a.ajax({type:"POST",url:ajaxurl,data:b,success:function(a){commentReply.show(a)},error:function(a){commentReply.error(a)}});return!1},show:function(b){var e,k,c;if("string"==typeof b)return this.error({responseText:b}),!1;e=wpAjax.parseAjaxResponse(b);if(e.errors)return this.error({responseText:wpAjax.broken}),!1;this.revert();e=e.responses[0];b="#comment-"+e.id;"edit-comment"==this.act&&a(b).remove();if(e.supplemental.parent_approved&&
(c=a("#comment-"+e.supplemental.parent_approved),r(-1),"moderated"==this.comments_listing)){c.animate({backgroundColor:"#CCEEBB"},400,function(){c.fadeOut()});return}e=a.trim(e.data);a(e).hide();a("#replyrow").after(e);b=a(b);this.addEvents(b);k=b.hasClass("unapproved")?"#FFFFE0":b.closest(".widefat, .postbox").css("backgroundColor");b.animate({backgroundColor:"#CCEEBB"},300).animate({backgroundColor:k},300,function(){c&&c.length&&c.animate({backgroundColor:"#CCEEBB"},300).animate({backgroundColor:k},
300).removeClass("unapproved").addClass("approved").find("div.comment_status").html("1")})},error:function(b){var e=b.statusText;a("#replysubmit .spinner").removeClass("is-active");b.responseText&&(e=b.responseText.replace(/<.[^<>]*?>/g,""));e&&a("#replysubmit .error").html(e).show()},addcomment:function(b){var e=this;a("#add-new-comment").fadeOut(200,function(){e.open(0,b,"add");a("table.comments-box").css("display","");a("#no-comments").remove()})}};a(document).ready(function(){var b,e,k,c;setCommentsList();
commentReply.init();a(document).delegate("span.delete a.delete","click",function(){return!1});"undefined"!=typeof a.table_hotkeys&&(b=function(b){return function(){var c,e;c="next"==b?"first":"last";e=a(".tablenav-pages ."+b+"-page:not(.disabled)");e.length&&(window.location=e[0].href.replace(/\&hotkeys_highlight_(first|last)=1/g,"")+"&hotkeys_highlight_"+c+"=1")}},e=function(b,c){window.location=a("span.edit a",c).attr("href")},k=function(){a("#cb-select-all-1").data("wp-toggle",1).trigger("click").removeData("wp-toggle")},
c=function(b){return function(){var c=a('select[name="action"]');a('option[value="'+b+'"]',c).prop("selected",!0);a("#doaction").click()}},a.table_hotkeys(a("table.widefat"),["a","u","s","d","r","q","z",["e",e],["shift+x",k],["shift+a",c("approve")],["shift+s",c("spam")],["shift+d",c("delete")],["shift+t",c("trash")],["shift+z",c("untrash")],["shift+u",c("unapprove")]],{highlight_first:adminCommentsL10n.hotkeys_highlight_first,highlight_last:adminCommentsL10n.hotkeys_highlight_last,prev_page_link_cb:b("prev"),
next_page_link_cb:b("next"),hotkeys_opts:{disableInInput:!0,type:"keypress",noDisable:'.check-column input[type="checkbox"]'},cycle_expr:"#the-comment-list tr",start_row_index:0}));a("#the-comment-list").on("click",".comment-inline",function(b){b.preventDefault();b=a(this);var c="replyto";"undefined"!==typeof b.data("action")&&(c=b.data("action"));commentReply.open(b.data("commentId"),b.data("postId"),c)})})})(jQuery);
