window.wp=window.wp||{};
(function(m,d){var c={},h,l,g=Array.prototype.slice;h=function(){};l=function(a,b,c){var e;e=b&&b.hasOwnProperty("constructor")?b.constructor:function(){return a.apply(this,arguments)};d.extend(e,a);h.prototype=a.prototype;e.prototype=new h;b&&d.extend(e.prototype,b);c&&d.extend(e,c);e.prototype.constructor=e;e.__super__=a.prototype;return e};c.Class=function(a,b,k){var e,f=arguments;a&&b&&c.Class.applicator===a&&(f=b,d.extend(this,k||{}));e=this;this.instance&&(e=function(){return e.instance.apply(e,arguments)},
d.extend(e,this));e.initialize.apply(e,f);return e};c.Class.extend=function(a,b){var c=l(this,a,b);c.extend=this.extend;return c};c.Class.applicator={};c.Class.prototype.initialize=function(){};c.Class.prototype.extended=function(a){for(var b=this;"undefined"!==typeof b.constructor;){if(b.constructor===a)return!0;if("undefined"===typeof b.constructor.__super__)break;b=b.constructor.__super__}return!1};c.Events={trigger:function(a){this.topics&&this.topics[a]&&this.topics[a].fireWith(this,g.call(arguments,
1));return this},bind:function(a){this.topics=this.topics||{};this.topics[a]=this.topics[a]||d.Callbacks();this.topics[a].add.apply(this.topics[a],g.call(arguments,1));return this},unbind:function(a){this.topics&&this.topics[a]&&this.topics[a].remove.apply(this.topics[a],g.call(arguments,1));return this}};c.Value=c.Class.extend({initialize:function(a,b){this._value=a;this.callbacks=d.Callbacks();this._dirty=!1;d.extend(this,b||{});this.set=d.proxy(this.set,this)},instance:function(){return arguments.length?
this.set.apply(this,arguments):this.get()},get:function(){return this._value},set:function(a){var b=this._value;a=this._setter.apply(this,arguments);a=this.validate(a);if(null===a||_.isEqual(b,a))return this;this._value=a;this._dirty=!0;this.callbacks.fireWith(this,[a,b]);return this},_setter:function(a){return a},setter:function(a){var b=this.get();this._setter=a;this._value=null;this.set(b);return this},resetSetter:function(){this._setter=this.constructor.prototype._setter;this.set(this.get());
return this},validate:function(a){return a},bind:function(){this.callbacks.add.apply(this.callbacks,arguments);return this},unbind:function(){this.callbacks.remove.apply(this.callbacks,arguments);return this},link:function(){var a=this.set;d.each(arguments,function(){this.bind(a)});return this},unlink:function(){var a=this.set;d.each(arguments,function(){this.unbind(a)});return this},sync:function(){var a=this;d.each(arguments,function(){a.link(this);this.link(a)});return this},unsync:function(){var a=
this;d.each(arguments,function(){a.unlink(this);this.unlink(a)});return this}});c.Values=c.Class.extend({defaultConstructor:c.Value,initialize:function(a){d.extend(this,a||{});this._value={};this._deferreds={}},instance:function(a){return 1===arguments.length?this.value(a):this.when.apply(this,arguments)},value:function(a){return this._value[a]},has:function(a){return"undefined"!==typeof this._value[a]},add:function(a,b){if(this.has(a))return this.value(a);this._value[a]=b;b.parent=this;b.extended(c.Value)&&
b.bind(this._change);this.trigger("add",b);this._deferreds[a]&&this._deferreds[a].resolve();return this._value[a]},create:function(a){return this.add(a,new this.defaultConstructor(c.Class.applicator,g.call(arguments,1)))},each:function(a,b){b="undefined"===typeof b?this:b;d.each(this._value,function(c,e){a.call(b,e,c)})},remove:function(a){var b;this.has(a)&&(b=this.value(a),this.trigger("remove",b),b.extended(c.Value)&&b.unbind(this._change),delete b.parent);delete this._value[a];delete this._deferreds[a]},
when:function(){var a=this,b=g.call(arguments),c=d.Deferred();d.isFunction(b[b.length-1])&&c.done(b.pop());d.when.apply(d,d.map(b,function(b){if(!a.has(b))return a._deferreds[b]=a._deferreds[b]||d.Deferred()})).done(function(){var e=d.map(b,function(b){return a(b)});e.length!==b.length?a.when.apply(a,b).done(function(){c.resolveWith(a,e)}):c.resolveWith(a,e)});return c.promise()},_change:function(){this.parent.trigger("change",this)}});d.extend(c.Values.prototype,c.Events);c.ensure=function(a){return"string"==
typeof a?d(a):a};c.Element=c.Value.extend({initialize:function(a,b){var k=this,e=c.Element.synchronizer.html,f,g,h;this.element=c.ensure(a);this.events="";this.element.is("input, select, textarea")&&(this.events+="change",e=c.Element.synchronizer.val,this.element.is("input")?(f=this.element.prop("type"),c.Element.synchronizer[f]&&(e=c.Element.synchronizer[f]),"text"===f||"password"===f?this.events+=" keyup":"range"===f&&(this.events+=" input propertychange")):this.element.is("textarea")&&(this.events+=
" keyup"));c.Value.prototype.initialize.call(this,null,d.extend(b||{},e));this._value=this.get();g=this.update;h=this.refresh;this.update=function(a){a!==h.call(k)&&g.apply(this,arguments)};this.refresh=function(){k.set(h.call(k))};this.bind(this.update);this.element.bind(this.events,this.refresh)},find:function(a){return d(a,this.element)},refresh:function(){},update:function(){}});c.Element.synchronizer={};d.each(["html","val"],function(a,b){c.Element.synchronizer[b]={update:function(a){this.element[b](a)},
refresh:function(){return this.element[b]()}}});c.Element.synchronizer.checkbox={update:function(a){this.element.prop("checked",a)},refresh:function(){return this.element.prop("checked")}};c.Element.synchronizer.radio={update:function(a){this.element.filter(function(){return this.value===a}).prop("checked",!0)},refresh:function(){return this.element.filter(":checked").val()}};d.support.postMessage=!!window.postMessage;c.Messenger=c.Class.extend({add:function(a,b,d){return this[a]=new c.Value(b,d)},
initialize:function(a,b){var c=window.parent==window?null:window.parent;d.extend(this,b||{});this.add("channel",a.channel);this.add("url",a.url||"");this.add("origin",this.url()).link(this.url).setter(function(a){return a.replace(/([^:]+:\/\/[^\/]+).*/,"$1")});this.add("targetWindow",null);this.targetWindow.set=function(a){var b=this._value;a=this._setter.apply(this,arguments);a=this.validate(a);if(null===a||b===a)return this;this._value=a;this._dirty=!0;this.callbacks.fireWith(this,[a,b]);return this};
this.targetWindow(a.targetWindow||c);this.receive=d.proxy(this.receive,this);this.receive.guid=d.guid++;d(window).on("message",this.receive)},destroy:function(){d(window).off("message",this.receive)},receive:function(a){a=a.originalEvent;!this.targetWindow()||this.origin()&&a.origin!==this.origin()||"string"!==typeof a.data||"{"!==a.data[0]||(a=JSON.parse(a.data))&&a.id&&"undefined"!==typeof a.data&&((a.channel||this.channel())&&this.channel()!==a.channel||this.trigger(a.id,a.data))},send:function(a,
b){var c;b="undefined"===typeof b?null:b;this.url()&&this.targetWindow()&&(c={id:a,data:b},this.channel()&&(c.channel=this.channel()),this.targetWindow().postMessage(JSON.stringify(c),this.origin()))}});d.extend(c.Messenger.prototype,c.Events);c=d.extend(new c.Values,c);c.get=function(){var a={};this.each(function(b,c){a[c]=b.get()});return a};m.customize=c})(wp,jQuery);
