(function(e){e.suggest=function(f,a){function m(){var a=b.offset();d.css({top:a.top+f.offsetHeight+"px",left:a.left+"px"})}function u(){var c=e.trim(b.val()),l,g;a.multiple&&(l=c.lastIndexOf(a.multipleSep),-1!=l&&(c=e.trim(c.substr(l+a.multipleSep.length))));c.length>=a.minchars?(cached=v(c))?r(cached.items):e.get(a.source,{q:c},function(b){d.hide();g=w(b,c);r(g);var l=c,e=g;b=b.length;for(var f;h.length&&k+b>a.maxCacheSize;)f=h.pop(),k-=f.size;h.push({q:l,size:b,items:e});k+=b}):d.hide()}function v(a){var b;
for(b=0;b<h.length;b++)if(h[b].q==a)return h.unshift(h.splice(b,1)[0]),h[0];return!1}function r(c){var b="",g;if(c)if(c.length){m();for(g=0;g<c.length;g++)b+="<li>"+c[g]+"</li>";d.html(b).show();d.children("li").mouseover(function(){d.children("li").removeClass(a.selectClass);e(this).addClass(a.selectClass)}).click(function(a){a.preventDefault();a.stopPropagation();t()})}else d.hide()}function w(b,d){var g=[],h=b.split(a.delimiter),f,k;for(f=0;f<h.length;f++)if(k=e.trim(h[f]))k=k.replace(new RegExp(d,
"ig"),function(b){return'<span class="'+a.matchClass+'">'+b+"</span>"}),g[g.length]=k;return g}function n(){var b;if(!d.is(":visible"))return!1;b=d.children("li."+a.selectClass);b.length||(b=!1);return b}function t(){if($currentResult=n())a.multiple?($currentVal=-1!=b.val().indexOf(a.multipleSep)?b.val().substr(0,b.val().lastIndexOf(a.multipleSep)+a.multipleSep.length)+" ":"",b.val($currentVal+$currentResult.text()+a.multipleSep+" "),b.focus()):b.val($currentResult.text()),d.hide(),b.trigger("change"),
a.onSelect&&a.onSelect.apply(b[0])}var b,d,p,q,h,k;b=e(f).attr("autocomplete","off");d=e("<ul/>");p=!1;q=0;h=[];k=0;d.addClass(a.resultsClass).appendTo("body");m();e(window).load(m).resize(m);b.blur(function(){setTimeout(function(){d.hide()},200)});b.keydown(function(c){if(/27$|38$|40$/.test(c.keyCode)&&d.is(":visible")||/^13$|^9$/.test(c.keyCode)&&n())switch(c.preventDefault&&c.preventDefault(),c.stopPropagation&&c.stopPropagation(),c.cancelBubble=!0,c.returnValue=!1,c.keyCode){case 38:(c=n())?c.removeClass(a.selectClass).prev().addClass(a.selectClass):
d.children("li:last-child").addClass(a.selectClass);break;case 40:($currentResult=n())?$currentResult.removeClass(a.selectClass).next().addClass(a.selectClass):d.children("li:first-child").addClass(a.selectClass);break;case 9:case 13:t();break;case 27:d.hide()}else b.val().length!=q&&(p&&clearTimeout(p),p=setTimeout(u,a.delay),q=b.val().length)})};e.fn.suggest=function(f,a){if(f)return a=a||{},a.multiple=a.multiple||!1,a.multipleSep=a.multipleSep||",",a.source=f,a.delay=a.delay||100,a.resultsClass=
a.resultsClass||"ac_results",a.selectClass=a.selectClass||"ac_over",a.matchClass=a.matchClass||"ac_match",a.minchars=a.minchars||2,a.delimiter=a.delimiter||"\n",a.onSelect=a.onSelect||!1,a.maxCacheSize=a.maxCacheSize||65536,this.each(function(){new e.suggest(this,a)}),this}})(jQuery);
