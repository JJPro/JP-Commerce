(function(f,e,w){e.wp=e.wp||{};e.wp.heartbeat=new function(){function h(){return(new Date).getTime()}function p(a){var d,c=a.src;if(c&&/^https?:\/\//.test(c)&&(d=e.location.origin?e.location.origin:e.location.protocol+"//"+e.location.host,0!==c.indexOf(d)))return!1;try{if(a.contentWindow.document)return!0}catch(k){}return!1}function q(){a.hasFocus&&!document.hasFocus()?a.hasFocus=!1:!a.hasFocus&&document.hasFocus()&&m()}function r(b,d){var c;if(b){switch(b){case "timeout":c=!0;break;case "error":if(503===
d&&a.hasConnected){c=!0;break}case "parsererror":case "empty":case "unknown":a.errorcount++,2<a.errorcount&&a.hasConnected&&(c=!0)}c&&!n()&&(a.connectionError=!0,g.trigger("heartbeat-connection-lost",[b,d]))}}function t(){var b;a.connecting||a.suspend||(a.lastTick=h(),b=f.extend({},a.queue),a.queue={},g.trigger("heartbeat-send",[b]),b={data:b,interval:a.tempInterval?a.tempInterval/1E3:a.mainInterval/1E3,_nonce:"object"===typeof e.heartbeatSettings?e.heartbeatSettings.nonce:"",action:"heartbeat",screen_id:a.screenId,
has_focus:a.hasFocus},a.connecting=!0,a.xhr=f.ajax({url:a.url,type:"post",timeout:3E4,data:b,dataType:"json"}).always(function(){a.connecting=!1;l()}).done(function(b,c,e){var f;b?(a.hasConnected=!0,n()&&(a.errorcount=0,a.connectionError=!1,g.trigger("heartbeat-connection-restored")),b.nonces_expired&&g.trigger("heartbeat-nonces-expired"),b.heartbeat_interval&&(f=b.heartbeat_interval,delete b.heartbeat_interval),g.trigger("heartbeat-tick",[b,c,e]),f&&u(f)):r("empty")}).fail(function(a,b,e){r(b||"unknown",
a.status);g.trigger("heartbeat-error",[a,b,e])}))}function l(){var b=h()-a.lastTick,d=a.mainInterval;a.suspend||(a.hasFocus?0<a.countdown&&a.tempInterval&&(d=a.tempInterval,a.countdown--,1>a.countdown&&(a.tempInterval=0)):d=12E4,a.minimalInterval&&d<a.minimalInterval&&(d=a.minimalInterval),e.clearTimeout(a.beatTimer),b<d?a.beatTimer=e.setTimeout(function(){t()},d-b):t())}function m(){a.userActivity=h();a.suspend=!1;a.hasFocus||(a.hasFocus=!0,l())}function v(){a.userActivityEvents=!1;g.off(".wp-heartbeat-active");
f("iframe").each(function(a,d){p(d)&&f(d.contentWindow).off(".wp-heartbeat-active")});m()}function x(){var b=a.userActivity?h()-a.userActivity:0;3E5<b&&a.hasFocus&&(a.hasFocus=!1);if(a.suspendEnabled&&6E5<b||36E5<b)a.suspend=!0;a.userActivityEvents||(g.on("mouseover.wp-heartbeat-active keyup.wp-heartbeat-active touchend.wp-heartbeat-active",function(){v()}),f("iframe").each(function(a,b){if(p(b))f(b.contentWindow).on("mouseover.wp-heartbeat-active keyup.wp-heartbeat-active touchend.wp-heartbeat-active",
function(){v()})}),a.userActivityEvents=!0)}function n(){return a.connectionError}function u(b,d){var c,e=a.tempInterval?a.tempInterval:a.mainInterval;if(b){switch(b){case "fast":case 5:c=5E3;break;case 15:c=15E3;break;case 30:c=3E4;break;case 60:c=6E4;break;case 120:c=12E4;break;case "long-polling":return a.mainInterval=0;default:c=a.originalInterval}a.minimalInterval&&c<a.minimalInterval&&(c=a.minimalInterval);5E3===c?(d=parseInt(d,10)||30,a.countdown=1>d||30<d?30:d,a.tempInterval=c):(a.countdown=
0,a.tempInterval=0,a.mainInterval=c);c!==e&&l()}return a.tempInterval?a.tempInterval/1E3:a.mainInterval/1E3}var g=f(document),a={suspend:!1,suspendEnabled:!0,screenId:"",url:"",lastTick:0,queue:{},mainInterval:60,tempInterval:0,originalInterval:0,minimalInterval:0,countdown:0,connecting:!1,connectionError:!1,errorcount:0,hasConnected:!1,hasFocus:!0,userActivity:0,userActivityEvents:!1,checkFocusTimer:0,beatTimer:0};(function(){var b,d,c,k;"string"===typeof e.pagenow&&(a.screenId=e.pagenow);"string"===
typeof e.ajaxurl&&(a.url=e.ajaxurl);"object"===typeof e.heartbeatSettings&&(b=e.heartbeatSettings,!a.url&&b.ajaxurl&&(a.url=b.ajaxurl),b.interval&&(a.mainInterval=b.interval,15>a.mainInterval?a.mainInterval=15:120<a.mainInterval&&(a.mainInterval=120)),b.minimalInterval&&(b.minimalInterval=parseInt(b.minimalInterval,10),a.minimalInterval=0<b.minimalInterval&&600>=b.minimalInterval?1E3*b.minimalInterval:0),a.minimalInterval&&a.mainInterval<a.minimalInterval&&(a.mainInterval=a.minimalInterval),a.screenId||
(a.screenId=b.screenId||"front"),"disable"===b.suspension&&(a.suspendEnabled=!1));a.mainInterval*=1E3;a.originalInterval=a.mainInterval;"undefined"!==typeof document.hidden?(d="hidden",k="visibilitychange",c="visibilityState"):"undefined"!==typeof document.msHidden?(d="msHidden",k="msvisibilitychange",c="msVisibilityState"):"undefined"!==typeof document.webkitHidden&&(d="webkitHidden",k="webkitvisibilitychange",c="webkitVisibilityState");d&&(document[d]&&(a.hasFocus=!1),g.on(k+".wp-heartbeat",function(){"hidden"===
document[c]?(a.hasFocus=!1,e.clearInterval(a.checkFocusTimer)):(m(),document.hasFocus&&(a.checkFocusTimer=e.setInterval(q,1E4)))}));document.hasFocus&&(a.checkFocusTimer=e.setInterval(q,1E4));f(e).on("unload.wp-heartbeat",function(){a.suspend=!0;a.xhr&&4!==a.xhr.readyState&&a.xhr.abort()});e.setInterval(x,3E4);g.ready(function(){a.lastTick=h();l()})})();return{hasFocus:function(){return a.hasFocus},connectNow:function(){a.lastTick=0;l()},disableSuspend:function(){a.suspendEnabled=!1},interval:u,hasConnectionError:n,
enqueue:function(b,d,c){if(b){if(c&&this.isQueued(b))return!1;a.queue[b]=d;return!0}return!1},dequeue:function(b){b&&delete a.queue[b]},isQueued:function(b){if(b)return a.queue.hasOwnProperty(b)},getQueuedItem:function(b){if(b)return this.isQueued(b)?a.queue[b]:w}}}})(jQuery,window);
