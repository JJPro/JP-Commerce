(function(e,d){var a=d.customize;a.HeaderTool={};a.HeaderTool.ImageModel=Backbone.Model.extend({defaults:function(){return{header:{attachment_id:0,url:"",timestamp:_.now(),thumbnail_url:""},choice:"",selected:!1,random:!1}},initialize:function(){this.on("hide",this.hide,this)},hide:function(){this.set("choice","");a("header_image").set("remove-header");a("header_image_data").set("remove-header")},destroy:function(){var b=this.get("header"),c=a.HeaderTool.currentHeader.get("header").attachment_id;
c&&b.attachment_id===c&&a.HeaderTool.currentHeader.trigger("hide");d.ajax.post("custom-header-remove",{nonce:_wpCustomizeHeader.nonces.remove,wp_customize:"on",theme:a.settings.theme.stylesheet,attachment_id:b.attachment_id});this.trigger("destroy",this,this.collection)},save:function(){this.get("random")?(a("header_image").set(this.get("header").random),a("header_image_data").set(this.get("header").random)):this.get("header").defaultName?(a("header_image").set(this.get("header").url),a("header_image_data").set(this.get("header").defaultName)):
(a("header_image").set(this.get("header").url),a("header_image_data").set(this.get("header")));a.HeaderTool.combinedList.trigger("control:setImage",this)},importImage:function(){var b=this.get("header");void 0!==b.attachment_id&&d.ajax.post("custom-header-add",{nonce:_wpCustomizeHeader.nonces.add,wp_customize:"on",theme:a.settings.theme.stylesheet,attachment_id:b.attachment_id})},shouldBeCropped:function(){return!0===this.get("themeFlexWidth")&&!0===this.get("themeFlexHeight")||!0===this.get("themeFlexWidth")&&
this.get("themeHeight")===this.get("imageHeight")||!0===this.get("themeFlexHeight")&&this.get("themeWidth")===this.get("imageWidth")||this.get("themeWidth")===this.get("imageWidth")&&this.get("themeHeight")===this.get("imageHeight")||this.get("imageWidth")<=this.get("themeWidth")?!1:!0}});a.HeaderTool.ChoiceList=Backbone.Collection.extend({model:a.HeaderTool.ImageModel,comparator:function(a){return-a.get("header").timestamp},initialize:function(){var b=a.HeaderTool.currentHeader.get("choice").replace(/^https?:\/\//,
""),c=this.isRandomChoice(a.get().header_image);this.type||(this.type="uploaded");"undefined"===typeof this.data&&(this.data=_wpCustomizeHeader.uploads);c&&(b=a.get().header_image);this.on("control:setImage",this.setImage,this);this.on("control:removeImage",this.removeImage,this);this.on("add",this.maybeAddRandomChoice,this);_.each(this.data,function(a,c){a.attachment_id||(a.defaultName=c);"undefined"===typeof a.timestamp&&(a.timestamp=0);this.add({header:a,choice:a.url.split("/").pop(),selected:b===
a.url.replace(/^https?:\/\//,"")},{silent:!0})},this);0<this.size()&&this.addRandomChoice(b)},maybeAddRandomChoice:function(){1===this.size()&&this.addRandomChoice()},addRandomChoice:function(a){a=RegExp(this.type).test(a);var c="random-"+this.type+"-image";this.add({header:{timestamp:0,random:c,width:245,height:41},choice:c,random:!0,selected:a})},isRandomChoice:function(a){return/^random-(uploaded|default)-image$/.test(a)},shouldHideTitle:function(){return 2>this.size()},setImage:function(a){this.each(function(a){a.set("selected",
!1)});a&&a.set("selected",!0)},removeImage:function(){this.each(function(a){a.set("selected",!1)})}});a.HeaderTool.DefaultsList=a.HeaderTool.ChoiceList.extend({initialize:function(){this.type="default";this.data=_wpCustomizeHeader.defaults;a.HeaderTool.ChoiceList.prototype.initialize.apply(this)}})})(jQuery,window.wp);
