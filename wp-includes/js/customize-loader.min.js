window.wp=window.wp||{};
(function(e,b){var d=wp.customize,a;b.extend(b.support,{history:!(!window.history||!history.pushState),hashchange:"onhashchange"in window&&(void 0===document.documentMode||7<document.documentMode)});a=b.extend({},d.Events,{initialize:function(){this.body=b(document.body);if(a.settings&&b.support.postMessage&&(b.support.cors||!a.settings.isCrossDomain)){this.window=b(window);this.element=b('<div id="customize-container" />').appendTo(this.body);this.bind("open",this.overlay.show);this.bind("close",
this.overlay.hide);b("#wpbody").on("click",".load-customize",function(c){c.preventDefault();a.link=b(this);a.open(a.link.attr("href"))});if(b.support.history)this.window.on("popstate",a.popstate);b.support.hashchange&&(this.window.on("hashchange",a.hashchange),this.window.triggerHandler("hashchange"))}},popstate:function(b){(b=b.originalEvent.state)&&b.customize?a.open(b.customize):a.active&&a.close()},hashchange:function(){var c=window.location.toString().split("#")[1];c&&0===c.indexOf("wp_customize=on")&&
a.open(a.settings.url+"?"+c);c||b.support.history||a.close()},beforeunload:function(){if(!a.saved())return a.settings.l10n.saveAlert},open:function(c){if(!this.active){if(a.settings.browser.mobile)return window.location=c;this.originalDocumentTitle=document.title;this.active=!0;this.body.addClass("customize-loading");this.saved=new d.Value(!0);this.iframe=b("<iframe />",{src:c,title:a.settings.l10n.mainIframeTitle}).appendTo(this.element);this.iframe.one("load",this.loaded);this.messenger=new d.Messenger({url:c,
channel:"loader",targetWindow:this.iframe[0].contentWindow});this.messenger.bind("ready",function(){a.messenger.send("back")});this.messenger.bind("close",function(){b.support.history?history.back():b.support.hashchange?window.location.hash="":a.close()});b(window).on("beforeunload",this.beforeunload);this.messenger.bind("activated",function(a){a&&(window.location=a)});this.messenger.bind("saved",function(){a.saved(!0)});this.messenger.bind("change",function(){a.saved(!1)});this.messenger.bind("title",
function(a){window.document.title=a});this.pushState(c);this.trigger("open")}},pushState:function(a){var d=a.split("?")[1];b.support.history&&window.location.href!==a?history.pushState({customize:a},"",a):!b.support.history&&b.support.hashchange&&d&&(window.location.hash="wp_customize=on&"+d);this.trigger("open")},opened:function(){a.body.addClass("customize-active full-overlay-active")},close:function(){this.active&&(this.saved()||confirm(a.settings.l10n.saveAlert)?(this.active=!1,this.trigger("close"),
this.originalDocumentTitle&&(document.title=this.originalDocumentTitle),this.link&&this.link.focus()):history.forward())},closed:function(){a.iframe.remove();a.messenger.destroy();a.iframe=null;a.messenger=null;a.saved=null;a.body.removeClass("customize-active full-overlay-active").removeClass("customize-loading");b(window).off("beforeunload",a.beforeunload)},loaded:function(){a.body.removeClass("customize-loading")},overlay:{show:function(){this.element.fadeIn(200,a.opened)},hide:function(){this.element.fadeOut(200,
a.closed)}}});b(function(){a.settings=_wpCustomizeLoaderSettings;a.initialize()});d.Loader=a})(wp,jQuery);
