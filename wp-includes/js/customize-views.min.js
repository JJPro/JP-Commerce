(function(e,b,d){if(b&&b.customize){var c=b.customize;c.HeaderTool.CurrentView=b.Backbone.View.extend({template:b.template("header-current"),initialize:function(){this.listenTo(this.model,"change",this.render);this.render()},render:function(){this.$el.html(this.template(this.model.toJSON()));this.setPlaceholder();this.setButtons();return this},getHeight:function(){var a=this.$el.find("img"),b;if(a.length)this.$el.find(".inner").hide();else return this.$el.find(".inner").show(),40;b=this.model.get("savedHeight");
a=a.height()||b;a||(a=(a=c.get().header_image_data)&&a.width&&a.height?260/a.width*a.height:40);return a},setPlaceholder:function(a){a=a||this.getHeight();this.model.set("savedHeight",a);this.$el.add(this.$el.find(".placeholder")).height(a)},setButtons:function(){var a=e("#customize-control-header_image .actions .remove");this.model.get("choice")?a.show():a.hide()}});c.HeaderTool.ChoiceView=b.Backbone.View.extend({template:b.template("header-choice"),className:"header-view",events:{"click .choice,.random":"select",
"click .close":"removeImage"},initialize:function(){var a=[this.model.get("header").url,this.model.get("choice")];this.listenTo(this.model,"change:selected",this.toggleSelected);d.contains(a,c.get().header_image)&&c.HeaderTool.currentHeader.set(this.extendedModel())},render:function(){this.$el.html(this.template(this.extendedModel()));this.toggleSelected();return this},toggleSelected:function(){this.$el.toggleClass("selected",this.model.get("selected"))},extendedModel:function(){var a=this.model.get("collection");
return d.extend(this.model.toJSON(),{type:a.type})},getHeight:c.HeaderTool.CurrentView.prototype.getHeight,setPlaceholder:c.HeaderTool.CurrentView.prototype.setPlaceholder,select:function(){this.preventJump();this.model.save();c.HeaderTool.currentHeader.set(this.extendedModel())},preventJump:function(){var a=e(".wp-full-overlay-sidebar-content"),b=a.scrollTop();d.defer(function(){a.scrollTop(b)})},removeImage:function(a){a.stopPropagation();this.model.destroy();this.remove()}});c.HeaderTool.ChoiceListView=
b.Backbone.View.extend({initialize:function(){this.listenTo(this.collection,"add",this.addOne);this.listenTo(this.collection,"remove",this.render);this.listenTo(this.collection,"sort",this.render);this.listenTo(this.collection,"change",this.toggleList);this.render()},render:function(){this.$el.empty();this.collection.each(this.addOne,this);this.toggleList()},addOne:function(a){a.set({collection:this.collection});a=new c.HeaderTool.ChoiceView({model:a});this.$el.append(a.render().el)},toggleList:function(){var a=
this.$el.parents().prev(".customize-control-title"),b=this.$el.find(".random").parent();this.collection.shouldHideTitle()?a.add(b).hide():a.add(b).show()}});c.HeaderTool.CombinedList=b.Backbone.View.extend({initialize:function(a){this.collections=a;this.on("all",this.propagate,this)},propagate:function(a,b){d.each(this.collections,function(c){c.trigger(a,b)})}})}})(jQuery,window.wp,_);
