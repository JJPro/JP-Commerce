(function(p,b){var a=wp.customize,g;g=function(a,e,c){var b;return function(){var h=arguments;c=c||this;clearTimeout(b);b=setTimeout(function(){b=null;a.apply(c,h)},e)}};a.Preview=a.Messenger.extend({initialize:function(f,e){var c=this;a.Messenger.prototype.initialize.call(this,f,e);this.body=b(document.body);this.body.on("click.preview","a",function(a){a.preventDefault();c.send("scroll",0);c.send("url",b(this).prop("href"))});this.body.on("submit.preview","form",function(a){a.preventDefault()});
this.window=b(window);this.window.on("scroll.preview",g(function(){c.send("scroll",c.window.scrollTop())},200));this.bind("scroll",function(a){c.window.scrollTop(a)})}});b(function(){a.settings=window._wpCustomizeSettings;if(a.settings){var f;a.preview=new a.Preview({url:window.location.href,channel:a.settings.channel});a.preview.bind("settings",function(e){b.each(e,function(c,b){a.has(c)?a(c).set(b):a.create(c,b)})});a.preview.trigger("settings",a.settings.values);a.preview.bind("setting",function(b){var c;
b=b.slice();(c=a(b.shift()))&&c.set.apply(c,b)});a.preview.bind("sync",function(e){b.each(e,function(b,e){a.preview.trigger(b,e)});a.preview.send("synced")});a.preview.bind("active",function(){a.settings.nonce&&a.preview.send("nonce",a.settings.nonce);a.preview.send("documentTitle",document.title)});a.preview.send("ready",{activePanels:a.settings.activePanels,activeSections:a.settings.activeSections,activeControls:a.settings.activeControls});a.preview.bind("loading-initiated",function(){b("body").addClass("wp-customizer-unloading");
b("html").prop("title",a.settings.l10n.loading)});a.preview.bind("loading-failed",function(){b("body").removeClass("wp-customizer-unloading");b("html").prop("title","")});f=b.map(["color","image","position_x","repeat","attachment"],function(a){return"background_"+a});a.when.apply(a,f).done(function(a,c,f,h,g){var m=b(document.body),n=b("head"),k=b("#custom-background-css"),l;l=function(){var d="";m.toggleClass("custom-background",!(!a()&&!c()));a()&&(d+="background-color: "+a()+";");c()&&(d+='background-image: url("'+
c()+'");',d+="background-position: top "+f()+";",d+="background-repeat: "+h()+";",d+="background-attachment: "+g()+";");k.remove();k=b('<style type="text/css" id="custom-background-css">body.custom-background { '+d+" }</style>").appendTo(n)};b.each(arguments,function(){this.bind(l)})});a.trigger("preview-ready")}})})(wp,jQuery);
