(function(p,d){var a=wp.customize,h;h=function(a,c,b){var g;return function(){var d=arguments;b=b||this;clearTimeout(g);g=setTimeout(function(){g=null;a.apply(b,d)},c)}};a.Preview=a.Messenger.extend({initialize:function(f,c){var b=this;a.Messenger.prototype.initialize.call(this,f,c);this.body=d(document.body);this.body.on("click.preview","a",function(a){a.preventDefault();b.send("scroll",0);b.send("url",d(this).prop("href"))});this.body.on("submit.preview","form",function(a){a.preventDefault()});
this.window=d(window);this.window.on("scroll.preview",h(function(){b.send("scroll",b.window.scrollTop())},200));this.bind("scroll",function(a){b.window.scrollTop(a)})}});d(function(){a.settings=window._wpCustomizeSettings;if(a.settings){var f;a.preview=new a.Preview({url:window.location.href,channel:a.settings.channel});a.preview.bind("settings",function(c){d.each(c,function(b,c){a.has(b)?a(b).set(c):a.create(b,c)})});a.preview.trigger("settings",a.settings.values);a.preview.bind("setting",function(c){var b;
c=c.slice();(b=a(c.shift()))&&b.set.apply(b,c)});a.preview.bind("sync",function(c){d.each(c,function(b,c){a.preview.trigger(b,c)});a.preview.send("synced")});a.preview.bind("active",function(){a.settings.nonce&&a.preview.send("nonce",a.settings.nonce);a.preview.send("documentTitle",document.title)});a.preview.send("ready",{activePanels:a.settings.activePanels,activeSections:a.settings.activeSections,activeControls:a.settings.activeControls});a.preview.bind("loading-initiated",function(){d("body").addClass("wp-customizer-unloading")});
a.preview.bind("loading-failed",function(){d("body").removeClass("wp-customizer-unloading")});f=d.map(["color","image","position_x","repeat","attachment"],function(a){return"background_"+a});a.when.apply(a,f).done(function(a,b,g,f,h){var m=d(document.body),n=d("head"),k=d("#custom-background-css"),l;l=function(){var e="";m.toggleClass("custom-background",!(!a()&&!b()));a()&&(e+="background-color: "+a()+";");b()&&(e+='background-image: url("'+b()+'");',e+="background-position: top "+g()+";",e+="background-repeat: "+
f()+";",e+="background-attachment: "+h()+";");k.remove();k=d('<style type="text/css" id="custom-background-css">body.custom-background { '+e+" }</style>").appendTo(n)};d.each(arguments,function(){this.bind(l)})});a.trigger("preview-ready")}})})(wp,jQuery);
