(function(d){d.ui.WPLinkPreview=d.ui.Control.extend({url:"#",renderHtml:function(){return'<div id="'+this._id+'" class="wp-link-preview"><a href="'+this.url+'" target="_blank" tabindex="-1">'+this.url+"</a></div>"},setURL:function(a){var b,e;this.url!==a&&(this.url=a,a=window.decodeURIComponent(a),a=a.replace(/^(?:https?:)?\/\/(?:www\.)?/,""),-1!==(b=a.indexOf("?"))&&(a=a.slice(0,b)),-1!==(b=a.indexOf("#"))&&(a=a.slice(0,b)),a=a.replace(/(?:index)?\.html$/,""),"/"===a.charAt(a.length-1)&&(a=a.slice(0,
-1)),40<a.length&&-1!==(b=a.indexOf("/"))&&-1!==(e=a.lastIndexOf("/"))&&e!==b&&(40>b+a.length-e&&(e=-(40-(b+1))),a=a.slice(0,b+1)+"\u2026"+a.slice(e)),d.$(this.getEl().firstChild).attr("href",this.url).text(a))}});d.PluginManager.add("wplink",function(a){var b;a.addCommand("WP_Link",function(){window.wpLink&&window.wpLink.open(a.id)});a.addShortcut("access+a","","WP_Link");a.addShortcut("meta+k","","WP_Link");a.addButton("link",{icon:"link",tooltip:"Insert/edit link",cmd:"WP_Link",stateSelector:"a[href]"});
a.addButton("unlink",{icon:"unlink",tooltip:"Remove link",cmd:"unlink"});a.addMenuItem("link",{icon:"link",text:"Insert/edit link",cmd:"WP_Link",stateSelector:"a[href]",context:"insert",prependToContext:!0});a.on("pastepreprocess",function(b){var c=b.content,f=/^(?:https?:)?\/\/\S+$/i;a.selection.isCollapsed()||f.test(a.selection.getContent())||(c=c.replace(/<[^>]+>/g,""),c=d.trim(c),f.test(c)&&(a.execCommand("mceInsertLink",!1,{href:a.dom.decode(c)}),b.preventDefault()))});a.addButton("wp_link_preview",
{type:"WPLinkPreview",onPostRender:function(){var e=this;a.on("wptoolbar",function(c){var f=a.dom.getParent(c.element,"a"),d,g;f&&(d=a.$(f),(g=d.attr("href"))&&!d.find("img").length&&(e.setURL(g),c.element=f,c.toolbar=b))})}});a.addButton("wp_link_edit",{tooltip:"Edit ",icon:"dashicon dashicons-edit",cmd:"WP_Link"});a.addButton("wp_link_remove",{tooltip:"Remove",icon:"dashicon dashicons-no",cmd:"unlink"});a.on("preinit",function(){a.wp&&a.wp._createToolbar&&(b=a.wp._createToolbar(["wp_link_preview",
"wp_link_edit","wp_link_remove"],!0))})})})(window.tinymce);
