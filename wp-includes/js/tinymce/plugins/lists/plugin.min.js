tinymce.PluginManager.add("lists",function(d){function k(d){return d&&/^(OL|UL|DL)$/.test(d.nodeName)}function x(n){return n&&!!d.schema.getTextBlockElements()[n.nodeName]}var y=this;d.on("init",function(){function n(a){function c(c){var g,f,m;f=a[c?"startContainer":"endContainer"];m=a[c?"startOffset":"endOffset"];1==f.nodeType&&(g=e.create("span",{"data-mce-type":"bookmark"}),f.hasChildNodes()?(m=Math.min(m,f.childNodes.length-1),c?f.insertBefore(g,f.childNodes[m]):e.insertAfter(g,f.childNodes[m])):
f.appendChild(g),f=g,m=0);b[c?"startContainer":"endContainer"]=f;b[c?"startOffset":"endOffset"]=m}var b={};c(!0);a.collapsed||c();return b}function u(a){function c(b){var c,f,m;c=m=a[b?"startContainer":"endContainer"];f=a[b?"startOffset":"endOffset"];if(c){if(1==c.nodeType){a:{f=c;for(var d=f.parentNode.firstChild,v=0;d;){if(d==f){f=v;break a}1==d.nodeType&&"bookmark"==d.getAttribute("data-mce-type")||v++;d=d.nextSibling}f=-1}c=c.parentNode;e.remove(m)}a[b?"startContainer":"endContainer"]=c;a[b?"startOffset":
"endOffset"]=f}}c(!0);c();var b=e.createRng();b.setStart(a.startContainer,a.startOffset);a.endContainer&&b.setEnd(a.endContainer,a.endOffset);p.setRng(b)}function l(a,c){var b,h,g=e.createFragment(),f,m=d.schema.getBlockElements();d.settings.forced_root_block&&(c=c||d.settings.forced_root_block);c&&(h=e.create(c),h.tagName===d.settings.forced_root_block&&e.setAttribs(h,d.settings.forced_root_block_attrs),g.appendChild(h));if(a)for(;b=a.firstChild;){var B=b.nodeName;f||"SPAN"==B&&"bookmark"==b.getAttribute("data-mce-type")||
(f=!0);m[B]?(g.appendChild(b),h=null):c?(h||(h=e.create(c),g.appendChild(h)),h.appendChild(b)):g.appendChild(b)}d.settings.forced_root_block?f||tinymce.Env.ie&&!(10<tinymce.Env.ie)||h.appendChild(e.create("br",{"data-mce-bogus":"1"})):g.appendChild(e.create("br"));return g}function r(){return tinymce.grep(p.getSelectedBlocks(),function(a){return/^(LI|DT|DD)$/.test(a.nodeName)})}function w(a,c,b){function h(a){tinymce.each(f,function(b){a.parentNode.insertBefore(b,c.parentNode)});e.remove(a)}var g,
f,d;f=e.select('span[data-mce-type="bookmark"]',a);b=b||l(c);g=e.createRng();g.setStartAfter(c);g.setEndAfter(a);g=g.extractContents();for(d=g.firstChild;d;d=d.firstChild)if("LI"==d.nodeName&&e.isEmpty(d)){e.remove(d);break}e.isEmpty(g)||e.insertAfter(g,a);e.insertAfter(b,a);e.isEmpty(c.parentNode)&&h(c.parentNode);e.remove(c);e.isEmpty(a)&&e.remove(a)}function q(a){var c,b;if((c=a.nextSibling)&&k(c)&&c.nodeName==a.nodeName){for(;b=c.firstChild;)a.appendChild(b);e.remove(c)}if((c=a.previousSibling)&&
k(c)&&c.nodeName==a.nodeName){for(;b=c.firstChild;)a.insertBefore(b,a.firstChild);e.remove(c)}}function G(a){tinymce.each(tinymce.grep(e.select("ol,ul",a)),function(a){var b,d=a.parentNode;"LI"==d.nodeName&&d.firstChild==a&&(b=d.previousSibling)&&"LI"==b.nodeName&&(b.appendChild(a),e.isEmpty(d)&&e.remove(d));k(d)&&(b=d.previousSibling)&&"LI"==b.nodeName&&b.appendChild(a)})}function C(a){var c=a.parentNode,b=c.parentNode;if("DD"==a.nodeName)return e.rename(a,"DT"),!0;if(a.parentNode.firstChild==a&&
a.parentNode.lastChild==a)return"LI"==b.nodeName?(e.insertAfter(a,b),e.isEmpty(b)&&e.remove(b),e.remove(c)):k(b)?e.remove(c,!0):(b.insertBefore(l(a),c),e.remove(c)),!0;if(a.parentNode.firstChild==a)return"LI"==b.nodeName?(e.insertAfter(a,b),a.appendChild(c),e.isEmpty(b)&&e.remove(b)):k(b)?b.insertBefore(a,c):(b.insertBefore(l(a),c),e.remove(a)),!0;if(a.parentNode.lastChild==a)return"LI"==b.nodeName?e.insertAfter(a,b):k(b)?e.insertAfter(a,c):(e.insertAfter(l(a),c),e.remove(a)),!0;"LI"==b.nodeName?
(c=b,b=l(a,"LI")):b=k(b)?l(a,"LI"):l(a);w(c,a,b);G(c.parentNode);return!0}function H(a){function c(b,c){var d;if(k(b)){for(;d=a.lastChild.firstChild;)c.appendChild(d);e.remove(b)}}var b,d;return"DT"==a.nodeName?(e.rename(a,"DD"),!0):(b=a.previousSibling)&&k(b)?(b.appendChild(a),!0):b&&"LI"==b.nodeName&&k(b.lastChild)?(b.lastChild.appendChild(a),c(a.lastChild,b.lastChild),!0):(b=a.nextSibling)&&k(b)?(b.insertBefore(a,b.firstChild),!0):b&&"LI"==b.nodeName&&k(a.lastChild)?!1:(b=a.previousSibling)&&"LI"==
b.nodeName?(d=e.create(a.parentNode.nodeName),b.appendChild(d),d.appendChild(a),c(a.lastChild,d),!0):!1}function D(){var a=r();if(a.length){for(var c=n(p.getRng(!0)),b=0;b<a.length&&(H(a[b])||0!==b);b++);u(c);d.nodeChanged();return!0}}function E(){var a=r();if(a.length){var c=n(p.getRng(!0)),b,e,g=d.getBody();for(b=a.length;b--;)for(var f=a[b].parentNode;f&&f!=g;){for(e=a.length;e--;)if(a[e]===f){a.splice(b,1);break}f=f.parentNode}for(b=0;b<a.length&&(C(a[b])||0!==b);b++);u(c);d.nodeChanged();return!0}}
function I(a){var c=p.getRng(!0),b=n(c),h="LI";a=a.toUpperCase();"DL"==a&&(h="DT");tinymce.each(function(){function a(b){var e;e=c[b?"startContainer":"endContainer"];b=c[b?"startOffset":"endOffset"];for(1==e.nodeType&&(e=e.childNodes[Math.min(b,e.childNodes.length-1)]||e);e.parentNode!=m&&!x(e)&&!/^(TD|TH)$/.test(e.parentNode.nodeName);)e=e.parentNode;return e}for(var b=[],m=d.getBody(),h=a(!0),v=a(),t,n=[];h&&(n.push(h),h!=v);h=h.nextSibling);tinymce.each(n,function(a){if(x(a))b.push(a),t=null;else if(e.isBlock(a)||
"BR"==a.nodeName)"BR"==a.nodeName&&e.remove(a),t=null;else{var c=a.nextSibling;tinymce.dom.BookmarkManager.isBookmarkNode(a)&&(x(c)||!c&&a.parentNode==m)?t=null:(t||(t=e.create("p"),a.parentNode.insertBefore(t,a),b.push(t)),t.appendChild(a))}});return b}(),function(b){var c,d;(d=b.previousSibling)&&k(d)&&d.nodeName==a?(c=d,b=e.rename(b,h),d.appendChild(b)):(c=e.create(a),b.parentNode.insertBefore(c,b),c.appendChild(b),e.rename(b,h));q(c)});u(b)}function F(){var a=n(p.getRng(!0)),c=d.getBody();tinymce.each(r(),
function(a){var d,g;if(e.isEmpty(a))C(a);else{for(d=a;d&&d!=c;d=d.parentNode)k(d)&&(g=d);w(g,a)}});u(a)}function z(a){var c=e.getParent(p.getStart(),"OL,UL,DL");if(c)if(c.nodeName==a)F(a);else{var b=n(p.getRng(!0));q(e.rename(c,a));u(b)}else I(a)}function A(a){return function(){var c=e.getParent(d.selection.getStart(),"UL,OL,DL");return c&&c.nodeName==a}}var e=d.dom,p=d.selection;y.backspaceDelete=function(a){function c(a,b){var c=a.startContainer,e=a.startOffset,f;if(3==c.nodeType&&(b?e<c.data.length:
0<e))return c;e=d.schema.getNonEmptyElements();for(f=new tinymce.dom.TreeWalker(a.startContainer);c=f[b?"next":"prev"]();)if("LI"==c.nodeName&&!c.hasChildNodes()||e[c.nodeName]||3==c.nodeType&&0<c.data.length)return c}function b(a,b){var c,d,f=a.parentNode;k(b.lastChild)&&(d=b.lastChild);(c=b.lastChild)&&"BR"==c.nodeName&&a.hasChildNodes()&&e.remove(c);e.isEmpty(b)&&e.$(b).empty();if(!e.isEmpty(a))for(;c=a.firstChild;)b.appendChild(c);d&&b.appendChild(d);e.remove(a);e.isEmpty(f)&&e.remove(f)}if(p.isCollapsed()){var h=
e.getParent(p.getStart(),"LI");if(h){var g=p.getRng(!0),f=e.getParent(c(g,a),"LI");if(f&&f!=h)return g=n(g),a?b(f,h):b(h,f),u(g),!0;if(!f&&!a&&F(h.parentNode.nodeName))return!0}}};d.on("BeforeExecCommand",function(a){var c=a.command.toLowerCase(),b;"indent"==c?D()&&(b=!0):"outdent"==c&&E()&&(b=!0);if(b)return d.fire("ExecCommand",{command:a.command}),a.preventDefault(),!0});d.addCommand("InsertUnorderedList",function(){z("UL")});d.addCommand("InsertOrderedList",function(){z("OL")});d.addCommand("InsertDefinitionList",
function(){z("DL")});d.addQueryStateHandler("InsertUnorderedList",A("UL"));d.addQueryStateHandler("InsertOrderedList",A("OL"));d.addQueryStateHandler("InsertDefinitionList",A("DL"));d.on("keydown",function(a){9==a.keyCode&&!tinymce.util.VK.metaKeyPressed(a)&&d.dom.getParent(d.selection.getStart(),"LI,DT,DD")&&(a.preventDefault(),a.shiftKey?E():D())})});d.addButton("indent",{icon:"indent",title:"Increase indent",cmd:"Indent",onPostRender:function(){var n=this;d.on("nodechange",function(){for(var k=
d.selection.getSelectedBlocks(),l=!1,r=0,w=k.length;!l&&r<w;r++){var l=k[r].nodeName,q;if(q="LI"==l)q=k[r],q=q.parentNode.firstChild==q;l=q||"UL"==l||"OL"==l||"DD"==l}n.disabled(l)})}});d.on("keydown",function(d){d.keyCode==tinymce.util.VK.BACKSPACE?y.backspaceDelete()&&d.preventDefault():d.keyCode==tinymce.util.VK.DELETE&&y.backspaceDelete(!0)&&d.preventDefault()})});
