tinymce.PluginManager.add("lists",function(d){function k(d){return d&&/^(OL|UL|DL)$/.test(d.nodeName)}function x(l){return l&&!!d.schema.getTextBlockElements()[l.nodeName]}var y=this;d.on("init",function(){function l(a,c){var b=e.isEmpty(a);return c&&0<e.select("span[data-mce-type=bookmark]").length?!1:b}function v(a){function c(c){var f,g,d;g=a[c?"startContainer":"endContainer"];d=a[c?"startOffset":"endOffset"];1==g.nodeType&&(f=e.create("span",{"data-mce-type":"bookmark"}),g.hasChildNodes()?(d=
Math.min(d,g.childNodes.length-1),c?g.insertBefore(f,g.childNodes[d]):e.insertAfter(f,g.childNodes[d])):g.appendChild(f),g=f,d=0);b[c?"startContainer":"endContainer"]=g;b[c?"startOffset":"endOffset"]=d}var b={};c(!0);a.collapsed||c();return b}function n(a){function c(b){var c,d,m;c=m=a[b?"startContainer":"endContainer"];d=a[b?"startOffset":"endOffset"];if(c){if(1==c.nodeType){a:{d=c;for(var p=d.parentNode.firstChild,l=0;p;){if(p==d){d=l;break a}1==p.nodeType&&"bookmark"==p.getAttribute("data-mce-type")||
l++;p=p.nextSibling}d=-1}c=c.parentNode;e.remove(m)}a[b?"startContainer":"endContainer"]=c;a[b?"startOffset":"endOffset"]=d}}c(!0);c();var b=e.createRng();b.setStart(a.startContainer,a.startOffset);a.endContainer&&b.setEnd(a.endContainer,a.endOffset);r.setRng(b)}function q(a,c){var b,h,f=e.createFragment(),g,m=d.schema.getBlockElements();d.settings.forced_root_block&&(c=c||d.settings.forced_root_block);c&&(h=e.create(c),h.tagName===d.settings.forced_root_block&&e.setAttribs(h,d.settings.forced_root_block_attrs),
f.appendChild(h));if(a)for(;b=a.firstChild;){var p=b.nodeName;g||"SPAN"==p&&"bookmark"==b.getAttribute("data-mce-type")||(g=!0);m[p]?(f.appendChild(b),h=null):c?(h||(h=e.create(c),f.appendChild(h)),h.appendChild(b)):f.appendChild(b)}d.settings.forced_root_block?g||tinymce.Env.ie&&!(10<tinymce.Env.ie)||h.appendChild(e.create("br",{"data-mce-bogus":"1"})):f.appendChild(e.create("br"));return f}function w(){return tinymce.grep(r.getSelectedBlocks(),function(a){return/^(LI|DT|DD)$/.test(a.nodeName)})}
function t(a,c,b){function d(a){tinymce.each(g,function(b){a.parentNode.insertBefore(b,c.parentNode)});e.remove(a)}var f,g,m;g=e.select('span[data-mce-type="bookmark"]',a);b=b||q(c);f=e.createRng();f.setStartAfter(c);f.setEndAfter(a);f=f.extractContents();for(m=f.firstChild;m;m=m.firstChild)if("LI"==m.nodeName&&e.isEmpty(m)){e.remove(m);break}e.isEmpty(f)||e.insertAfter(f,a);e.insertAfter(b,a);l(c.parentNode)&&d(c.parentNode);e.remove(c);l(a)&&e.remove(a)}function B(a){var c,b;if((c=a.nextSibling)&&
k(c)&&c.nodeName==a.nodeName){for(;b=c.firstChild;)a.appendChild(b);e.remove(c)}if((c=a.previousSibling)&&k(c)&&c.nodeName==a.nodeName){for(;b=c.firstChild;)a.insertBefore(b,a.firstChild);e.remove(c)}}function G(a){tinymce.each(tinymce.grep(e.select("ol,ul",a)),function(a){var b,d=a.parentNode;"LI"==d.nodeName&&d.firstChild==a&&(b=d.previousSibling)&&"LI"==b.nodeName&&(b.appendChild(a),l(d)&&e.remove(d));k(d)&&(b=d.previousSibling)&&"LI"==b.nodeName&&b.appendChild(a)})}function C(a){var c=a.parentNode,
b=c.parentNode;if(c===d.getBody())return!0;if("DD"==a.nodeName)return e.rename(a,"DT"),!0;if(a.parentNode.firstChild==a&&a.parentNode.lastChild==a)return"LI"==b.nodeName?(e.insertAfter(a,b),l(b)&&e.remove(b),e.remove(c)):k(b)?e.remove(c,!0):(b.insertBefore(q(a),c),e.remove(c)),!0;if(a.parentNode.firstChild==a)return"LI"==b.nodeName?(e.insertAfter(a,b),a.appendChild(c),l(b)&&e.remove(b)):k(b)?b.insertBefore(a,c):(b.insertBefore(q(a),c),e.remove(a)),!0;if(a.parentNode.lastChild==a)return"LI"==b.nodeName?
e.insertAfter(a,b):k(b)?e.insertAfter(a,c):(e.insertAfter(q(a),c),e.remove(a)),!0;"LI"==b.nodeName?(c=b,b=q(a,"LI")):b=k(b)?q(a,"LI"):q(a);t(c,a,b);G(c.parentNode);return!0}function H(a){function c(b,c){var d;if(k(b)){for(;d=a.lastChild.firstChild;)c.appendChild(d);e.remove(b)}}var b,d;return"DT"==a.nodeName?(e.rename(a,"DD"),!0):(b=a.previousSibling)&&k(b)?(b.appendChild(a),!0):b&&"LI"==b.nodeName&&k(b.lastChild)?(b.lastChild.appendChild(a),c(a.lastChild,b.lastChild),!0):(b=a.nextSibling)&&k(b)?
(b.insertBefore(a,b.firstChild),!0):b&&"LI"==b.nodeName&&k(a.lastChild)?!1:(b=a.previousSibling)&&"LI"==b.nodeName?(d=e.create(a.parentNode.nodeName),b.appendChild(d),d.appendChild(a),c(a.lastChild,d),!0):!1}function D(){var a=w();if(a.length){for(var c=v(r.getRng(!0)),b=0;b<a.length&&(H(a[b])||0!==b);b++);n(c);d.nodeChanged();return!0}}function E(){var a=w();if(a.length){var c=v(r.getRng(!0)),b,e,f=d.getBody();for(b=a.length;b--;)for(var g=a[b].parentNode;g&&g!=f;){for(e=a.length;e--;)if(a[e]===
g){a.splice(b,1);break}g=g.parentNode}for(b=0;b<a.length&&(C(a[b])||0!==b);b++);n(c);d.nodeChanged();return!0}}function I(a){var c=r.getRng(!0),b=v(c),h="LI";a=a.toUpperCase();"DL"==a&&(h="DT");tinymce.each(function(){function a(b){var d;d=c[b?"startContainer":"endContainer"];b=c[b?"startOffset":"endOffset"];for(1==d.nodeType&&(d=d.childNodes[Math.min(b,d.childNodes.length-1)]||d);d.parentNode!=h&&!x(d)&&!/^(TD|TH)$/.test(d.parentNode.nodeName);)d=d.parentNode;return d}for(var b=[],h=d.getBody(),
p=a(!0),l=a(),u,k=[];p&&(k.push(p),p!=l);p=p.nextSibling);tinymce.each(k,function(a){if(x(a))b.push(a),u=null;else if(e.isBlock(a)||"BR"==a.nodeName)"BR"==a.nodeName&&e.remove(a),u=null;else{var c=a.nextSibling;tinymce.dom.BookmarkManager.isBookmarkNode(a)&&(x(c)||!c&&a.parentNode==h)?u=null:(u||(u=e.create("p"),a.parentNode.insertBefore(u,a),b.push(u)),u.appendChild(a))}});return b}(),function(b){var c,d;(d=b.previousSibling)&&k(d)&&d.nodeName==a?(c=d,b=e.rename(b,h),d.appendChild(b)):(c=e.create(a),
b.parentNode.insertBefore(c,b),c.appendChild(b),e.rename(b,h));B(c)});n(b)}function F(){var a=v(r.getRng(!0)),c=d.getBody();tinymce.each(w(),function(a){var e,f;if(a.parentNode!==d.getBody())if(l(a))C(a);else{for(e=a;e&&e!=c;e=e.parentNode)k(e)&&(f=e);t(f,a)}});n(a)}function z(a){var c=e.getParent(r.getStart(),"OL,UL,DL");if(c!==d.getBody())if(c)if(c.nodeName==a)F(a);else{var b=v(r.getRng(!0));B(e.rename(c,a));n(b)}else I(a)}function A(a){return function(){var c=e.getParent(d.selection.getStart(),
"UL,OL,DL");return c&&c.nodeName==a}}var e=d.dom,r=d.selection;y.backspaceDelete=function(a){function c(a,b){var c=a.startContainer,e=a.startOffset,f;if(3==c.nodeType&&(b?e<c.data.length:0<e))return c;e=d.schema.getNonEmptyElements();for(f=new tinymce.dom.TreeWalker(a.startContainer);c=f[b?"next":"prev"]();)if("LI"==c.nodeName&&!c.hasChildNodes()||e[c.nodeName]||3==c.nodeType&&0<c.data.length)return c}function b(a,b){var c,f,g=a.parentNode;k(b.lastChild)&&(f=b.lastChild);(c=b.lastChild)&&"BR"==c.nodeName&&
a.hasChildNodes()&&e.remove(c);l(b,!0)&&e.$(b).empty();if(!l(a,!0))for(;c=a.firstChild;)b.appendChild(c);f&&b.appendChild(f);e.remove(a);l(g)&&g!==d.getBody()&&e.remove(g)}if(r.isCollapsed()){var h=e.getParent(r.getStart(),"LI"),f,g,m;if(h){f=h.parentNode;if(f===d.getBody()&&e.isEmpty(f))return!0;g=r.getRng(!0);if((m=e.getParent(c(g,a),"LI"))&&m!=h)return f=v(g),a?b(m,h):b(h,m),n(f),!0;if(!m&&!a&&F(f.nodeName))return!0}}};d.on("BeforeExecCommand",function(a){var c=a.command.toLowerCase(),b;"indent"==
c?D()&&(b=!0):"outdent"==c&&E()&&(b=!0);if(b)return d.fire("ExecCommand",{command:a.command}),a.preventDefault(),!0});d.addCommand("InsertUnorderedList",function(){z("UL")});d.addCommand("InsertOrderedList",function(){z("OL")});d.addCommand("InsertDefinitionList",function(){z("DL")});d.addQueryStateHandler("InsertUnorderedList",A("UL"));d.addQueryStateHandler("InsertOrderedList",A("OL"));d.addQueryStateHandler("InsertDefinitionList",A("DL"));d.on("keydown",function(a){9==a.keyCode&&!tinymce.util.VK.metaKeyPressed(a)&&
d.dom.getParent(d.selection.getStart(),"LI,DT,DD")&&(a.preventDefault(),a.shiftKey?E():D())})});d.addButton("indent",{icon:"indent",title:"Increase indent",cmd:"Indent",onPostRender:function(){var l=this;d.on("nodechange",function(){for(var k=d.selection.getSelectedBlocks(),n=!1,q=0,w=k.length;!n&&q<w;q++){var n=k[q].nodeName,t;if(t="LI"==n)t=k[q],t=t.parentNode.firstChild==t;n=t||"UL"==n||"OL"==n||"DD"==n}l.disabled(n)})}});d.on("keydown",function(d){d.keyCode==tinymce.util.VK.BACKSPACE?y.backspaceDelete()&&
d.preventDefault():d.keyCode==tinymce.util.VK.DELETE&&y.backspaceDelete(!0)&&d.preventDefault()})});
