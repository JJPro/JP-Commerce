(function(B,G){function J(h,m){for(var e,l=[],a=0;a<h.length;++a){if(!(e=C[h[a]]))a:{e=B;for(var d=h[a].split(/[.\/]/),q=0;q<d.length;++q){if(!e[d[q]]){e=void 0;break a}e=e[d[q]]}}if(!e)throw"module definition dependecy not found: "+h[a];l.push(e)}m.apply(null,l)}function D(h,m,e){if("string"!==typeof h)throw"invalid module definition, module id must be defined and be a string";if(m===G)throw"invalid module definition, dependencies must be specified";if(e===G)throw"invalid module definition, definition function must be specified";
J(m,function(){C[h]=e.apply(null,arguments)})}var C={};D("tinymce/pasteplugin/Utils",["tinymce/util/Tools","tinymce/html/DomParser","tinymce/html/Schema"],function(h,m,e){function l(a,d){h.each(d,function(d){a=d.constructor==RegExp?a.replace(d,""):a.replace(d[0],d[1])});return a}return{filter:l,innerText:function(a){function d(a){var e=a.name,h=a;if("br"===e)c+="\n";else if(n[e]&&(c+=" "),v[e])c+=" ";else{3==a.type&&(c+=a.value);if(!a.shortEnded&&(a=a.firstChild)){do d(a);while(a=a.next)}z[e]&&h.next&&
(c+="\n","p"==e&&(c+="\n"))}}var q=new e,r=new m({},q),c="",n=q.getShortEndedElements(),v=h.makeMap("script noscript style textarea video audio iframe object"," "),z=q.getBlockElements();a=l(a,[/<!\[[^\]]+\]>/g]);d(r.parse(a));return c},trimHtml:function(a){return a=l(a,[/^[\s\S]*<body[^>]*>\s*|\s*<\/body[^>]*>[\s\S]*$/g,/\x3c!--StartFragment--\x3e|\x3c!--EndFragment--\x3e/g,[/( ?)<span class="Apple-converted-space">\u00a0<\/span>( ?)/g,function(a,e,h){return e||h?"\u00a0":" "}],/<br>$/i])}}});D("tinymce/pasteplugin/Clipboard",
["tinymce/Env","tinymce/dom/RangeUtils","tinymce/util/VK","tinymce/pasteplugin/Utils"],function(h,m,e,l){return function(a){function d(b){var k,f=a.dom;k=a.fire("BeforePastePreProcess",{content:b});k=a.fire("PastePreProcess",k);b=k.content;k.isDefaultPrevented()||(a.hasEventListeners("PastePostProcess")&&!k.isDefaultPrevented()&&(b=f.add(a.getBody(),"div",{style:"display:none"},b),k=a.fire("PastePostProcess",{node:b}),f.remove(b),b=k.node.innerHTML),k.isDefaultPrevented()||a.insertContent(b,{merge:!1!==
a.settings.paste_merge_formats,data:{paste:!0}}))}function q(b){b=a.dom.encode(b).replace(/\r\n/g,"\n");var k=a.dom.getParent(a.selection.getStart(),a.dom.isBlock),f=a.settings.forced_root_block,g;f&&(g=a.dom.createHTML(f,a.settings.forced_root_block_attrs),g=g.substr(0,g.length-3)+">");k&&/^(PRE|DIV)$/.test(k.nodeName)||!f?b=l.filter(b,[[/\n/g,"<br>"]]):(b=l.filter(b,[[/\n\n/g,"</p>"+g],[/^(.*<\/p>)(<p>)$/,g+"$1"],[/\n/g,"<br />"]]),-1!=b.indexOf("<p>")&&(b=g+b));d(b)}function r(){function b(b){var a,
f;f=b.startContainer;a=b.getClientRects();if(a.length)return a[0];if(b.collapsed&&1==f.nodeType){for(b=f.childNodes[w.startOffset];b&&3==b.nodeType&&!b.data.length;)b=b.nextSibling;if(b&&("BR"==b.tagName&&(f=k.doc.createTextNode("\ufeff"),b.parentNode.insertBefore(f,b),b=k.createRng(),b.setStartBefore(f),b.setEndAfter(f),a=b.getClientRects(),k.remove(f)),a.length))return a[0]}}var k=a.dom,f=a.getBody(),g=a.dom.getViewPort(a.getWin()).y,c=20,t;w=a.selection.getRng();a.inline&&(t=a.selection.getScrollContainer())&&
0<t.scrollTop&&(g=t.scrollTop);if(w.getClientRects)if(c=b(w))c=g+(c.top-k.getPos(f).y);else if(c=g,g=w.startContainer)3==g.nodeType&&g.parentNode!=f&&(g=g.parentNode),1==g.nodeType&&(c=k.getPos(g,t||f).y);p=k.add(a.getBody(),"div",{id:"mcepastebin",contentEditable:!0,"data-mce-bogus":"all",style:"position: absolute; top: "+c+"px;width: 10px; height: 10px; overflow: hidden; opacity: 0"},"%MCEPASTEBIN%");(h.ie||h.gecko)&&k.setStyle(p,"left","rtl"==k.getStyle(f,"direction",!0)?65535:-65535);k.bind(p,
"beforedeactivate focusin focusout",function(b){b.stopPropagation()});p.focus();a.selection.select(p,!0)}function c(){if(p){for(var b;b=a.dom.get("mcepastebin");)a.dom.remove(b),a.dom.unbind(b);w&&a.selection.setRng(w)}p=w=null}function n(){var b="",k,f,g;k=a.dom.select("div[id=mcepastebin]");for(f=0;f<k.length;f++)g=k[f],g.firstChild&&"mcepastebin"==g.firstChild.id&&(g=g.firstChild),g=g.innerHTML,"%MCEPASTEBIN%"!=b&&(b+=g);return b}function v(b){var a={};if(b){if(b.getData){var f=b.getData("Text");
f&&0<f.length&&-1==f.indexOf("data:text/mce-internal,")&&(a["text/plain"]=f)}if(b.types)for(f=0;f<b.types.length;f++){var g=b.types[f],c=b.getData(g);if("text/html"==g){a:{for(var t=void 0,d=void 0,y=d=void 0,d=[25942,29554,28521,14958],t=0;t<d.length;t++)if(c.charCodeAt(t)!=d[t])break a;d="";for(t=0;t<c.length;t++)y=c.charCodeAt(t),d+=String.fromCharCode(y&255),d+=String.fromCharCode((y&65280)>>8);c=decodeURIComponent(escape(d))}t=d=t=void 0;d="\x3c!--StartFragment--\x3e";t=c.indexOf(d);-1!==t&&
(c=c.substr(t+d.length));t="\x3c!--EndFragment--\x3e";t=c.indexOf(t);-1!==t&&(c=c.substr(0,t))}a[g]=c}}return a}function z(b,c){function f(f){function g(b){c&&(a.selection.setRng(c),c=null);d('<img src="'+b.result+'">')}var y,u,e;e=!1;if(f)for(y=0;y<f.length;y++)u=f[y],/^image\/(jpeg|png|gif|bmp)$/.test(u.type)&&(e=new FileReader,e.onload=g.bind(null,e),e.readAsDataURL(u.getAsFile?u.getAsFile():u),b.preventDefault(),e=!0);return e}var g=b.clipboardData||b.dataTransfer;if(a.settings.paste_data_images&&
g)return f(g.items)||f(g.files)}function H(b){b=b.clipboardData;return-1!=navigator.userAgent.indexOf("Android")&&b&&b.items&&0===b.items.length}function F(b,a){return a in b&&0<b[a].length}function x(b){return e.metaKeyPressed(b)&&86==b.keyCode||b.shiftKey&&45==b.keyCode}function E(){a.on("keydown",function(b){function d(b){x(b)&&!b.isDefaultPrevented()&&c()}x(b)&&!b.isDefaultPrevented()&&(u=b.shiftKey&&86==b.keyCode,u&&h.webkit&&-1!=navigator.userAgent.indexOf("Version/")||(b.stopImmediatePropagation(),
y=(new Date).getTime(),h.ie&&u?(b.preventDefault(),a.fire("paste",{ieFake:!0})):(c(),r(),a.once("keyup",d),a.once("paste",function(){a.off("keyup",d)}))))});a.on("paste",function(b){var k=(new Date).getTime(),f=v(b.clipboardData||a.getDoc().dataTransfer),k=(new Date).getTime()-k,g=1E3>(new Date).getTime()-y-k,e="text"==A.pasteFormat||u;u=!1;b.isDefaultPrevented()||H(b)?c():z(b)?c():(g||b.preventDefault(),!h.ie||g&&!b.ieFake||(r(),a.dom.bind(p,"paste",function(b){b.stopPropagation()}),a.getDoc().execCommand("Paste",
!1,null),f["text/html"]=n()),setTimeout(function(){var b;F(f,"text/html")?b=f["text/html"]:(b=n(),"%MCEPASTEBIN%"==b&&(e=!0));b=l.trimHtml(b);p&&p.firstChild&&"mcepastebin"===p.firstChild.id&&(e=!0);c();b.length||(e=!0);e&&(b=F(f,"text/plain")&&-1==b.indexOf("</p>")?f["text/plain"]:l.innerText(b));"%MCEPASTEBIN%"==b?g||a.windowManager.alert("Please use Ctrl+V/Cmd+V keyboard shortcuts to paste contents."):e?q(b):d(b)},0))});a.on("dragstart dragend",function(b){I="dragstart"==b.type});a.on("drop",function(b){var c=
m.getCaretRangeFromPoint(b.clientX,b.clientY,a.getDoc());if(!b.isDefaultPrevented()&&!I&&!z(b,c)&&c&&!1!==a.settings.paste_filter_drop){var f=v(b.dataTransfer),g=f["mce-internal"]||f["text/html"]||f["text/plain"];g&&(b.preventDefault(),a.undoManager.transact(function(){f["mce-internal"]&&a.execCommand("Delete");a.selection.setRng(c);g=l.trimHtml(g);f["text/html"]?d(g):q(g)}))}});a.on("dragover dragend",function(b){a.settings.paste_data_images&&b.preventDefault()})}var A=this,p,w,y=0,I=!1,u;A.pasteHtml=
d;A.pasteText=q;a.on("preInit",function(){E();a.parser.addNodeFilter("img",function(b,c,f){function g(b){b.attr("data-mce-object")||d===h.transparentSrc||b.remove()}if(!a.settings.paste_data_images&&f.data&&!0===f.data.paste)for(c=b.length;c--;){var d=b[c].attributes.map.src;d&&(0===d.indexOf("webkit-fake-url")?g(b[c]):a.settings.allow_html_data_urls||0!==d.indexOf("data:")||g(b[c]))}})})}});D("tinymce/pasteplugin/WordFilter","tinymce/util/Tools tinymce/html/DomParser tinymce/html/Schema tinymce/html/Serializer tinymce/html/Node tinymce/pasteplugin/Utils".split(" "),
function(h,m,e,l,a,d){function q(a){return/<font face="Times New Roman"|class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i.test(a)||/class="OutlineElement/.test(a)||/id="?docs\-internal\-guid\-/.test(a)}function r(a){var c;a=a.replace(/^[\u00a0 ]+/,"");h.each([/^[IVXLMCD]{1,2}\.[ \u00a0]/,/^[ivxlmcd]{1,2}\.[ \u00a0]/,/^[a-z]{1,2}[\.\)][ \u00a0]/,/^[A-Z]{1,2}[\.\)][ \u00a0]/,/^[0-9]+\.[ \u00a0]/,/^[\u3007\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d]+\.[ \u00a0]/,/^[\u58f1\u5f10\u53c2\u56db\u4f0d\u516d\u4e03\u516b\u4e5d\u62fe]+\.[ \u00a0]/],
function(d){if(d.test(a))return c=!0,!1});return c}function c(c){var v=c.settings;c.on("BeforePastePreProcess",function(z){function H(c){function d(b){var a="";if(3===b.type)return b.value;if(b=b.firstChild){do a+=d(b);while(b=b.next)}return a}function e(b,a){if(3===b.type&&a.test(b.value))return b.value=b.value.replace(a,""),!1;if(b=b.firstChild){do if(!e(b,a))return!1;while(b=b.next)}return!0}function b(a){if(a._listIgnore)a.remove();else if(a=a.firstChild){do b(a);while(a=a.next)}}function k(c,
d,n){var k=c._listLevel||h;k!=h&&(k<h?f&&(f=f.parent.parent):(g=f,f=null));f&&f.name==d?f.append(c):(g=g||f,f=new a(d,1),1<n&&f.attr("start",""+n),c.wrap(f));c.name="li";k>h&&g&&g.lastChild.append(f);h=k;b(c);e(c,/^\u00a0+/);e(c,/^\s*([\u2022\u00b7\u00a7\u25CF]|\w+\.)/);e(c,/^\u00a0+/)}for(var f,g,h=1,v=[],n=c.firstChild;"undefined"!==typeof n&&null!==n;)if(v.push(n),n=n.walk(),null!==n)for(;"undefined"!==typeof n&&n.parent!==c;)n=n.walk();for(n=0;n<v.length;n++)if(c=v[n],"p"==c.name&&c.firstChild){var l=
d(c);if(/^[\s\u00a0]*[\u2022\u00b7\u00a7\u25CF]\s*/.test(l))k(c,"ul");else if(r(l)){var l=/([0-9]+)\./.exec(l),p=1;l&&(p=parseInt(l[1],10));k(c,"ol",p)}else c._listLevel?k(c,"ul",1):f=null}else g=f,f=null}function F(d,e){var u={},b,k=c.dom.parseStyle(e);h.each(k,function(a,c){switch(c){case "mso-list":if(b=/\w+ \w+([0-9]+)/i.exec(e))d._listLevel=parseInt(b[1],10);/Ignore/i.test(a)&&d.firstChild&&(d._listIgnore=!0,d.firstChild._listIgnore=!0);break;case "horiz-align":c="text-align";break;case "vert-align":c=
"vertical-align";break;case "font-color":case "mso-foreground":c="color";break;case "mso-background":case "mso-highlight":c="background";break;case "font-weight":case "font-style":"normal"!=a&&(u[c]=a);return;case "mso-element":if(/^(comment|comment-list)$/i.test(a)){d.remove();return}}0===c.indexOf("mso-comment")?d.remove():0!==c.indexOf("mso-")&&("all"==E||A&&A[c])&&(u[c]=a)});/(bold)/i.test(u["font-weight"])&&(delete u["font-weight"],d.wrap(new a("b",1)));/(italic)/i.test(u["font-style"])&&(delete u["font-style"],
d.wrap(new a("i",1)));return(u=c.dom.serializeStyle(u,d.name))?u:null}var x=z.content,E,A,x=x.replace(/<b[^>]+id="?docs-internal-[^>]*>/gi,""),x=x.replace(/<br class="?Apple-interchange-newline"?>/gi,"");(E=v.paste_retain_style_properties)&&(A=h.makeMap(E.split(/[, ]/)));if(!1!==v.paste_enable_default_filters&&q(z.content)){z.wordContent=!0;var x=d.filter(x,[/\x3c!--[\s\S]+?--\x3e/gi,/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,[/<(\/?)s>/gi,
"<$1strike>"],[/&nbsp;/gi,"\u00a0"],[/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(a,c){return 0<c.length?c.replace(/./," ").slice(Math.floor(c.length/2)).split("").join("\u00a0"):""}]]),p=v.paste_word_valid_elements;p||(p="-strong/b,-em/i,-u,-span,-p,-ol,-ul,-li,-h1,-h2,-h3,-h4,-h5,-h6,-p/div,-a[href|name],sub,sup,strike,br,del,table[width],tr,td[colspan|rowspan|width],th[colspan|rowspan|width],thead,tfoot,tbody");p=new e({valid_elements:p,valid_children:"-li[p]"});
h.each(p.elements,function(a){a.attributes["class"]||(a.attributes["class"]={},a.attributesOrder.push("class"));a.attributes.style||(a.attributes.style={},a.attributesOrder.push("style"))});var w=new m({},p);w.addAttributeFilter("style",function(a){for(var c=a.length,d;c--;)d=a[c],d.attr("style",F(d,d.attr("style"))),"span"==d.name&&d.parent&&!d.attributes.length&&d.unwrap()});w.addAttributeFilter("class",function(a){for(var c=a.length,d,b;c--;)d=a[c],b=d.attr("class"),/^(MsoCommentReference|MsoCommentText|msoDel)$/i.test(b)&&
d.remove(),d.attr("class",null)});w.addNodeFilter("del",function(a){for(var c=a.length;c--;)a[c].remove()});w.addNodeFilter("a",function(a){for(var c=a.length,d,b,e;c--;)d=a[c],b=d.attr("href"),e=d.attr("name"),b&&-1!=b.indexOf("#_msocom_")?d.remove():(b&&0===b.indexOf("file://")&&(b=b.split("#")[1])&&(b="#"+b),b||e?e&&!/^_?(?:toc|edn|ftn)/i.test(e)?d.unwrap():d.attr({href:b,name:e}):d.unwrap())});x=w.parse(x);!1!==v.paste_convert_word_fake_lists&&H(x);z.content=(new l({validate:v.validate},p)).serialize(x)}})}
c.isWordContent=q;return c});D("tinymce/pasteplugin/Quirks",["tinymce/Env","tinymce/util/Tools","tinymce/pasteplugin/WordFilter","tinymce/pasteplugin/Utils"],function(h,m,e,l){return function(a){function d(c){a.on("BeforePastePreProcess",function(a){a.content=c(a.content)})}function q(c){if(!e.isWordContent(c))return c;var d=[];m.each(a.schema.getBlockElements(),function(a,c){d.push(c)});var h=new RegExp("(?:<br>&nbsp;[\\s\\r\\n]+|<br>)*(<\\/?("+d.join("|")+")[^>]*>)(?:<br>&nbsp;[\\s\\r\\n]+|<br>)*",
"g");c=l.filter(c,[[h,"$1"]]);return c=l.filter(c,[[/<br><br>/g,"<BR><BR>"],[/<br>/g," "],[/<BR><BR>/g,"<br>"]])}function r(c){if(e.isWordContent(c))return c;var d=a.settings.paste_webkit_styles;if(!1===a.settings.paste_remove_styles_if_webkit||"all"==d)return c;d&&(d=d.split(/[, ]/));if(d){var h=a.dom,l=a.selection.getNode();c=c.replace(/(<[^>]+) style="([^"]*)"([^>]*>)/gi,function(a,c,e,m){a=h.parseStyle(e,"span");e={};if("none"===d)return c+m;for(var q=0;q<d.length;q++){var p=a[d[q]],r=h.getStyle(l,
d[q],!0);/color/.test(d[q])&&(p=h.toHex(p),r=h.toHex(r));r!=p&&(e[d[q]]=p)}return(e=h.serializeStyle(e,"span"))?c+' style="'+e+'"'+m:c+m})}else c=c.replace(/(<[^>]+) style="([^"]*)"([^>]*>)/gi,"$1$3");return c=c.replace(/(<[^>]+) data-mce-style="([^"]+)"([^>]*>)/gi,function(a,c,d,e){return c+' style="'+d+'"'+e})}h.webkit&&d(r);h.ie&&d(q)}});D("tinymce/pasteplugin/Plugin",["tinymce/PluginManager","tinymce/pasteplugin/Clipboard","tinymce/pasteplugin/WordFilter","tinymce/pasteplugin/Quirks"],function(h,
m,e,l){var a;h.add("paste",function(d){function h(){"text"==c.pasteFormat?(this.active(!1),c.pasteFormat="html"):(c.pasteFormat="text",this.active(!0),a||(d.windowManager.alert("Paste is now in plain text mode. Contents will now be pasted as plain text until you toggle this option off."),a=!0))}var r=this,c,n=d.settings;r.clipboard=c=new m(d);r.quirks=new l(d);r.wordFilter=new e(d);d.settings.paste_as_text&&(r.clipboard.pasteFormat="text");if(n.paste_preprocess)d.on("PastePreProcess",function(a){n.paste_preprocess.call(r,
r,a)});if(n.paste_postprocess)d.on("PastePostProcess",function(a){n.paste_postprocess.call(r,r,a)});d.addCommand("mceInsertClipboardContent",function(a,c){c.content&&r.clipboard.pasteHtml(c.content);c.text&&r.clipboard.pasteText(c.text)});if(d.paste_block_drop)d.on("dragend dragover draggesture dragdrop drop drag",function(a){a.preventDefault();a.stopPropagation()});if(!d.settings.paste_data_images)d.on("drop",function(a){var c=a.dataTransfer;c&&c.files&&0<c.files.length&&a.preventDefault()});d.addButton("pastetext",
{icon:"pastetext",tooltip:"Paste as text",onclick:h,active:"text"==r.clipboard.pasteFormat});d.addMenuItem("pastetext",{text:"Paste as text",selectable:!0,active:c.pasteFormat,onclick:h})})});(function(h){var m,e,l,a;for(m=0;m<h.length;m++){e=B;l=h[m];a=l.split(/[.\/]/);for(var d=0;d<a.length-1;++d)e[a[d]]===G&&(e[a[d]]={}),e=e[a[d]];e[a[a.length-1]]=C[l]}if(B.AMDLC_TESTS){e=B.privateModules||{};for(l in C)e[l]=C[l];for(m=0;m<h.length;m++)delete e[h[m]];B.privateModules=e}})(["tinymce/pasteplugin/Utils"])})(this);
