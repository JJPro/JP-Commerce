var topWin=window.dialogArguments||opener||parent||top,uploader,uploader_init;
function fileQueued(b){jQuery(".media-blank").remove();var a=jQuery("#media-items").children(),c=post_id||0;1==a.length&&a.removeClass("open").find(".slidetoggle").slideUp(200);jQuery('<div class="media-item">').attr("id","media-item-"+b.id).addClass("child-of-"+c).append('<div class="progress"><div class="percent">0%</div><div class="bar"></div></div>',jQuery('<div class="filename original">').text(" "+b.name)).appendTo(jQuery("#media-items"));jQuery("#insert-gallery").prop("disabled",!0)}
function uploadStart(){try{"undefined"!=typeof topWin.tb_remove&&topWin.jQuery("#TB_overlay").unbind("click",topWin.tb_remove)}catch(b){}return!0}function uploadProgress(b,a){var c=jQuery("#media-item-"+a.id);jQuery(".bar",c).width(200*a.loaded/a.size);jQuery(".percent",c).html(a.percent+"%")}
function fileUploading(b,a){104857600<parseInt(b.settings.max_file_size,10)&&104857600<a.size&&setTimeout(function(){3>a.status&&0===a.loaded&&(wpFileError(a,pluploadL10n.big_upload_failed.replace("%1$s",'<a class="uploader-html" href="#">').replace("%2$s","</a>")),b.stop(),b.removeFile(a),b.start())},1E4)}
function updateMediaForm(){var b=jQuery("#media-items").children();1==b.length?(b.addClass("open").find(".slidetoggle").show(),jQuery(".insert-gallery").hide()):1<b.length&&(b.removeClass("open"),jQuery(".insert-gallery").show());0<b.not(".media-blank").length?jQuery(".savebutton").show():jQuery(".savebutton").hide()}
function uploadSuccess(b,a){var c=jQuery("#media-item-"+b.id);a=a.replace(/^<pre>(\d+)<\/pre>$/,"$1");a.match(/media-upload-error|error-div/)?c.html(a):(jQuery(".percent",c).html(pluploadL10n.crunching),prepareMediaItem(b,a),updateMediaForm(),post_id&&c.hasClass("child-of-"+post_id)&&jQuery("#attachments-count").text(1*jQuery("#attachments-count").text()+1))}
function setResize(b){b?window.resize_width&&window.resize_height?uploader.settings.resize={enabled:!0,width:window.resize_width,height:window.resize_height,quality:100}:uploader.settings.multipart_params.image_resize=!0:delete uploader.settings.multipart_params.image_resize}
function prepareMediaItem(b,a){var c="undefined"==typeof shortform?1:2,d=jQuery("#media-item-"+b.id);2==c&&2<shortform&&(c=shortform);try{"undefined"!=typeof topWin.tb_remove&&topWin.jQuery("#TB_overlay").click(topWin.tb_remove)}catch(g){}isNaN(a)||!a?(d.append(a),prepareMediaItemInit(b)):d.load("async-upload.php",{attachment_id:a,fetch:c},function(){prepareMediaItemInit(b);updateMediaForm()})}
function prepareMediaItemInit(b){var a=jQuery("#media-item-"+b.id);jQuery(".thumbnail",a).clone().attr("class","pinkynail toggle").prependTo(a);jQuery(".filename.original",a).replaceWith(jQuery(".filename.new",a));jQuery("a.delete",a).click(function(){jQuery.ajax({url:ajaxurl,type:"post",success:deleteSuccess,error:deleteError,id:b.id,data:{id:this.id.replace(/[^0-9]/g,""),action:"trash-post",_ajax_nonce:this.href.replace(/^.*wpnonce=/,"")}});return!1});jQuery("a.undo",a).click(function(){jQuery.ajax({url:ajaxurl,
type:"post",id:b.id,data:{id:this.id.replace(/[^0-9]/g,""),action:"untrash-post",_ajax_nonce:this.href.replace(/^.*wpnonce=/,"")},success:function(){var a,d=jQuery("#media-item-"+b.id);(a=jQuery("#type-of-"+b.id).val())&&jQuery("#"+a+"-counter").text(jQuery("#"+a+"-counter").text()-0+1);post_id&&d.hasClass("child-of-"+post_id)&&jQuery("#attachments-count").text(jQuery("#attachments-count").text()-0+1);jQuery(".filename .trashnotice",d).remove();jQuery(".filename .title",d).css("font-weight","normal");
jQuery("a.undo",d).addClass("hidden");jQuery(".menu_order_input",d).show();d.css({backgroundColor:"#ceb"}).animate({backgroundColor:"#fff"},{queue:!1,duration:500,complete:function(){jQuery(this).css({backgroundColor:""})}}).removeClass("undo")}});return!1});jQuery("#media-item-"+b.id+".startopen").removeClass("startopen").addClass("open").find("slidetoggle").fadeIn()}function wpQueueError(b){jQuery("#media-upload-error").show().html('<div class="error"><p>'+b+"</p></div>")}
function wpFileError(b,a){itemAjaxError(b.id,a)}function itemAjaxError(b,a){var c=jQuery("#media-item-"+b),d=c.find(".filename").text();c.data("last-err")!=b&&c.html('<div class="error-div"><a class="dismiss" href="#">'+pluploadL10n.dismiss+"</a><strong>"+pluploadL10n.error_uploading.replace("%s",jQuery.trim(d))+"</strong> "+a+"</div>").data("last-err",b)}
function deleteSuccess(b){var a,c;if("-1"==b)return itemAjaxError(this.id,"You do not have permission. Has your session expired?");if("0"==b)return itemAjaxError(this.id,"Could not be deleted. Has it been deleted already?");b=this.id;c=jQuery("#media-item-"+b);(a=jQuery("#type-of-"+b).val())&&jQuery("#"+a+"-counter").text(jQuery("#"+a+"-counter").text()-1);post_id&&c.hasClass("child-of-"+post_id)&&jQuery("#attachments-count").text(jQuery("#attachments-count").text()-1);1==jQuery("form.type-form #media-items").children().length&&
0<jQuery(".hidden","#media-items").length&&(jQuery(".toggle").toggle(),jQuery(".slidetoggle").slideUp(200).siblings().removeClass("hidden"));jQuery(".toggle",c).toggle();jQuery(".slidetoggle",c).slideUp(200).siblings().removeClass("hidden");c.css({backgroundColor:"#faa"}).animate({backgroundColor:"#f4f4f4"},{queue:!1,duration:500}).addClass("undo");jQuery(".filename:empty",c).remove();jQuery(".filename .title",c).css("font-weight","bold");jQuery(".filename",c).append('<span class="trashnotice"> '+
pluploadL10n.deleted+" </span>").siblings("a.toggle").hide();jQuery(".filename",c).append(jQuery("a.undo",c).removeClass("hidden"));jQuery(".menu_order_input",c).hide()}function deleteError(){}function uploadComplete(){jQuery("#insert-gallery").prop("disabled",!1)}
function switchUploader(b){b?(deleteUserSetting("uploader"),jQuery(".media-upload-form").removeClass("html-uploader"),"object"==typeof uploader&&uploader.refresh()):(setUserSetting("uploader","1"),jQuery(".media-upload-form").addClass("html-uploader"))}
function uploadError(b,a,c,d){switch(a){case plupload.FAILED:wpFileError(b,pluploadL10n.upload_failed);break;case plupload.FILE_EXTENSION_ERROR:wpFileError(b,pluploadL10n.invalid_filetype);break;case plupload.FILE_SIZE_ERROR:uploadSizeError(d,b);break;case plupload.IMAGE_FORMAT_ERROR:wpFileError(b,pluploadL10n.not_an_image);break;case plupload.IMAGE_MEMORY_ERROR:wpFileError(b,pluploadL10n.image_memory_exceeded);break;case plupload.IMAGE_DIMENSIONS_ERROR:wpFileError(b,pluploadL10n.image_dimensions_exceeded);
break;case plupload.GENERIC_ERROR:wpQueueError(pluploadL10n.upload_failed);break;case plupload.IO_ERROR:a=parseInt(d.settings.filters.max_file_size,10);104857600<a&&104857600<b.size?wpFileError(b,pluploadL10n.big_upload_failed.replace("%1$s",'<a class="uploader-html" href="#">').replace("%2$s","</a>")):wpQueueError(pluploadL10n.io_error);break;case plupload.HTTP_ERROR:wpQueueError(pluploadL10n.http_error);break;case plupload.INIT_ERROR:jQuery(".media-upload-form").addClass("html-uploader");break;
case plupload.SECURITY_ERROR:wpQueueError(pluploadL10n.security_error);break;default:wpFileError(b,pluploadL10n.default_error)}}
function uploadSizeError(b,a,c){c=c?pluploadL10n.big_upload_queued.replace("%s",a.name)+" "+pluploadL10n.big_upload_failed.replace("%1$s",'<a class="uploader-html" href="#">').replace("%2$s","</a>"):pluploadL10n.file_exceeds_size_limit.replace("%s",a.name);jQuery("#media-items").append('<div id="media-item-'+a.id+'" class="media-item error"><p>'+c+"</p></div>");b.removeFile(a)}
jQuery(document).ready(function(b){b(".media-upload-form").bind("click.uploader",function(a){var c=b(a.target);c.is('input[type="radio"]')?(a=c.closest("tr"),a.hasClass("align")?setUserSetting("align",c.val()):a.hasClass("image-size")&&setUserSetting("imgsize",c.val())):c.is("button.button")?(a=a.target.className||"",(a=a.match(/url([^ '"]+)/))&&a[1]&&(setUserSetting("urlbutton",a[1]),c.siblings(".urlfield").val(c.data("link-url")))):c.is("a.dismiss")?c.parents(".media-item").fadeOut(200,function(){b(this).remove()}):
c.is(".upload-flash-bypass a")||c.is("a.uploader-html")?(b("#media-items, p.submit, span.big-file-warning").css("display","none"),switchUploader(0),a.preventDefault()):c.is(".upload-html-bypass a")?(b("#media-items, p.submit, span.big-file-warning").css("display",""),switchUploader(1),a.preventDefault()):c.is("a.describe-toggle-on")?(c.parent().addClass("open"),c.siblings(".slidetoggle").fadeIn(250,function(){var a=b(window).scrollTop(),c=b(window).height(),f=b(this).offset().top,e=b(this).height();
c&&f&&e&&(e=f+e,c=a+c,e>c&&(e-c<f-a?window.scrollBy(0,e-c+10):window.scrollBy(0,f-a-40)))}),a.preventDefault()):c.is("a.describe-toggle-off")&&(c.siblings(".slidetoggle").fadeOut(250,function(){c.parent().removeClass("open")}),a.preventDefault())});uploader_init=function(){-1!=navigator.userAgent.indexOf("Trident/")||-1!=navigator.userAgent.indexOf("MSIE ")||"flash"!==plupload.predictRuntime(wpUploaderInit)||wpUploaderInit.required_features&&wpUploaderInit.required_features.hasOwnProperty("send_binary_string")||
(wpUploaderInit.required_features=wpUploaderInit.required_features||{},wpUploaderInit.required_features.send_binary_string=!0);uploader=new plupload.Uploader(wpUploaderInit);b("#image_resize").bind("change",function(){var a=b(this).prop("checked");setResize(a);a?setUserSetting("upload_resize","1"):deleteUserSetting("upload_resize")});uploader.bind("Init",function(a){var c=b("#plupload-upload-ui");setResize(getUserSetting("upload_resize",!1));a.features.dragdrop&&!b(document.body).hasClass("mobile")?
(c.addClass("drag-drop"),b("#drag-drop-area").bind("dragover.wp-uploader",function(){c.addClass("drag-over")}).bind("dragleave.wp-uploader, drop.wp-uploader",function(){c.removeClass("drag-over")})):(c.removeClass("drag-drop"),b("#drag-drop-area").unbind(".wp-uploader"));"html4"===a.runtime&&b(".upload-flash-bypass").hide()});uploader.init();uploader.bind("FilesAdded",function(a,c){b("#media-upload-error").empty();uploadStart();plupload.each(c,function(a){fileQueued(a)});a.refresh();a.start()});uploader.bind("UploadFile",
function(a,b){fileUploading(a,b)});uploader.bind("UploadProgress",function(a,b){uploadProgress(a,b)});uploader.bind("Error",function(a,b){uploadError(b.file,b.code,b.message,a);a.refresh()});uploader.bind("FileUploaded",function(a,b,d){uploadSuccess(b,d.response)});uploader.bind("UploadComplete",function(){uploadComplete()})};"object"==typeof wpUploaderInit&&uploader_init()});
