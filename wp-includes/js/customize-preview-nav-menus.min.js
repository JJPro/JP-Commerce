(function(n,g,p){if(p&&p.customize){var d=p.customize,l={},f={},q={renderQueryVar:null,renderNonceValue:null,renderNoncePostKey:null,previewCustomizeNonce:null,requestUri:"/",theme:{active:!1,stylesheet:""},navMenuInstanceArgs:{}};d.MenusCustomizerPreview={init:function(){var b=this,a={};f=g.extend({},q);"undefined"!==typeof _wpCustomizePreviewNavMenusExports&&g.extend(f,_wpCustomizePreviewNavMenusExports);d.each(function(c,d){c.id=d;a[c.id]=!0;b.bindListener(c)});d.preview.bind("setting",function(c){var h,
e;c=c.slice();h=c.shift();c=c.shift();(e=d(h))||(e=d.create(h,c));e.id||(e.id=h);a[e.id]||(a[e.id]=!0,b.bindListener(e)&&e.callbacks.fireWith(e,[e(),null]))})},bindListener:function(b){var a,c;return(a=b.id.match(/^nav_menu\[(-?\d+)]$/))?(b.navMenuId=parseInt(a[1],10),b.bind(this.onChangeNavMenuSetting),!0):(a=b.id.match(/^nav_menu_item\[(-?\d+)]$/))?(b.navMenuItemId=parseInt(a[1],10),b.bind(this.onChangeNavMenuItemSetting),!0):(a=b.id.match(/^nav_menu_locations\[(.+?)]/))?(c=a[1],b.bind(g.bind(function(){this.refreshMenuLocation(c)},
this)),!0):!1},onChangeNavMenuSetting:function(){if(!this.navMenuId)throw Error("Expected navMenuId property to be set.");d.MenusCustomizerPreview.refreshMenu(this.navMenuId)},onChangeNavMenuItemSetting:function(b,a){!a||!a.nav_menu_term_id||b&&a.nav_menu_term_id===b.nav_menu_term_id||d.MenusCustomizerPreview.refreshMenu(a.nav_menu_term_id);b&&b.nav_menu_term_id&&d.MenusCustomizerPreview.refreshMenu(b.nav_menu_term_id)},refreshMenu:function(b){var a=[];d.each(function(c,d){var e=d.match(/^nav_menu_locations\[(.+?)]/);
e&&b===c()&&a.push(e[1])});g.each(f.navMenuInstanceArgs,function(c,d){b!==c.menu&&-1===g.indexOf(a,c.theme_location)||this.refreshMenuInstanceDebounced(d)},this)},refreshMenuLocation:function(b){var a=!1;g.each(f.navMenuInstanceArgs,function(c,d){b===c.theme_location&&(this.refreshMenuInstanceDebounced(d),a=!0)},this);a||d.preview.send("refresh")},refreshMenuInstance:function(b){var a,c,h,e,m,k,l;if(!f.navMenuInstanceArgs[b])throw Error("unknown_instance_number");k=f.navMenuInstanceArgs[b];l="partial-refreshable-nav-menu-"+
String(b);e=n("."+l);g.isNumber(k.menu)?c=k.menu:k.theme_location&&d.has("nav_menu_locations["+k.theme_location+"]")&&(c=d("nav_menu_locations["+k.theme_location+"]").get());c&&k.can_partial_refresh&&0!==e.length?(c=parseInt(c,10),a={nonce:f.previewCustomizeNonce,wp_customize:"on"},f.theme.active||(a.theme=f.theme.stylesheet),a[f.renderQueryVar]="1",h={},d.each(function(b,a){var d=b.get(),e;(e=(e=(e=/^nav_menu_locations\[/.test(a))||a==="nav_menu["+String(c)+"]")||/^nav_menu_item\[/.test(a)&&(!1===
d||c===d.nav_menu_term_id))&&(h[a]=d)}),a.customized=JSON.stringify(h),a[f.renderNoncePostKey]=f.renderNonceValue,m=n.extend({},k),a.wp_nav_menu_args_hash=m.args_hash,delete m.args_hash,a.wp_nav_menu_args=JSON.stringify(m),e.addClass("customize-partial-refreshing"),a=p.ajax.send(null,{data:a,url:f.requestUri}),a.done(function(a){if(!1===a)d.preview.send("refresh");else{var c=e;e=n(a);e.addClass(l);e.addClass("partial-refreshable-nav-menu customize-partial-refreshing");c.replaceWith(e);a={instanceNumber:b,
wpNavArgs:m,wpNavMenuArgs:m,oldContainer:c,newContainer:e};e.removeClass("customize-partial-refreshing");n(document).trigger("customize-preview-menu-refreshed",[a])}})):d.preview.send("refresh")},refreshMenuInstanceDebounced:function(b){l[b]&&clearTimeout(l[b]);l[b]=setTimeout(g.bind(function(){this.refreshMenuInstance(b)},this),200)}};d.bind("preview-ready",function(){d.preview.bind("active",function(){d.MenusCustomizerPreview.init()})})}})(jQuery,_,wp);
